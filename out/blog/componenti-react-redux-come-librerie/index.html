<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8" class="next-head"/><meta property="og:type" content="website" class="next-head"/><meta property="og:image" content="https://www.ingloriouscoderz.it/static/images/backgrounds/metal-800x600.png" class="next-head"/><meta property="og:image:alt" content="Inglorious Coderz" class="next-head"/><meta property="og:image:width" content="800" class="next-head"/><meta property="og:image:height" content="600" class="next-head"/><meta property="og:locale" content="en_US" class="next-head"/><meta property="og:site_name" content="Inglorious Coderz" class="next-head"/><title class="next-head">Componenti react/redux come librerie | Inglorious Coderz</title><meta name="robots" content="index,follow" class="next-head"/><meta name="googlebot" content="index,follow" class="next-head"/><meta name="description" content="Qualche trucchetto per creare una libreria con Redux, violando la Singola Sorgente di Verità." class="next-head"/><meta property="og:url" content="https://www.ingloriouscoderz.it/blog/componenti-react-redux-come-librerie" class="next-head"/><meta property="og:title" content="Componenti react/redux come librerie | Inglorious Coderz" class="next-head"/><meta property="og:description" content="Qualche trucchetto per creare una libreria con Redux, violando la Singola Sorgente di Verità." class="next-head"/><link rel="canonical" href="https://www.ingloriouscoderz.it/blog/componenti-react-redux-come-librerie" class="next-head"/><link rel="preload" href="/_next/static/U8cRU8f7JegK67LboKVwn/pages/post.js" as="script"/><link rel="preload" href="/_next/static/U8cRU8f7JegK67LboKVwn/pages/_app.js" as="script"/><link rel="preload" href="/_next/static/U8cRU8f7JegK67LboKVwn/pages/_error.js" as="script"/><link rel="preload" href="/_next/static/runtime/webpack-347dd6a0495bab5a4caf.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.82aab45b771716fb8e99.js" as="script"/><link rel="preload" href="/_next/static/chunks/styles.273fa001fc5fa7fd2b84.js" as="script"/><link rel="preload" href="/_next/static/runtime/main-dcd3443c392942bb9cfd.js" as="script"/><link rel="stylesheet" href="/_next/static/css/styles.e2a538ab.chunk.css"/><style id="__jsx-2096718123">.button.jsx-2096718123{-webkit-flex:1;-ms-flex:1;flex:1;background-color:rgba(40,44,52,0.5);margin:0.25rem;border:1px solid #429aef;padding:0.25rem 0.5rem;text-transform:uppercase;line-height:1;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}
div.jsx-2096718123{height:100%;}</style><style id="__jsx-2522996044">.toolbar.jsx-2522996044{padding:0.5rem 0;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;}
.toolbar.jsx-2522996044>div.jsx-2522996044{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}</style><style id="__jsx-3278221705">.logo.jsx-3278221705{width:64px;-webkit-perspective:64px;-moz-perspective:64px;-ms-perspective:64px;perspective:64px;margin:0 auto;}
.cube.jsx-3278221705{height:64px;-webkit-transform-style:preserve-3d;-ms-transform-style:preserve-3d;transform-style:preserve-3d;-webkit-transform:scaleY(1.2) translateZ(-64px) rotateX(-0.6981317007977318rad) rotateY(-0.7853981633974483rad);-ms-transform:scaleY(1.2) translateZ(-64px) rotateX(-0.6981317007977318rad) rotateY(-0.7853981633974483rad);transform:scaleY(1.2) translateZ(-64px) rotateX(-0.6981317007977318rad) rotateY(-0.7853981633974483rad);-webkit-transition:ease-out 0.2s;transition:ease-out 0.2s;}
.cube__face.jsx-3278221705{position:absolute;width:100%;height:100%;-webkit-transform-origin:bottom center;-ms-transform-origin:bottom center;transform-origin:bottom center;}
.cube__face.jsx-3278221705>img.jsx-3278221705{position:absolute;}
.cube__face--left.jsx-3278221705{-webkit-transform:rotateY(0deg) translateZ(32px) skew(12deg);-ms-transform:rotateY(0deg) translateZ(32px) skew(12deg);transform:rotateY(0deg) translateZ(32px) skew(12deg);}
.cube__face--right.jsx-3278221705{-webkit-transform:rotateY(90deg) translateZ(32px) skew(-12deg);-ms-transform:rotateY(90deg) translateZ(32px) skew(-12deg);transform:rotateY(90deg) translateZ(32px) skew(-12deg);}
.cube__face--right.jsx-3278221705>.eye.jsx-3278221705{-webkit-transform:rotateY(180deg);-ms-transform:rotateY(180deg);transform:rotateY(180deg);}
.cube__face--left.jsx-3278221705>img.jsx-3278221705:first-of-type{;}
.cube__face--right.jsx-3278221705>img.jsx-3278221705:first-of-type{;}</style><style id="__jsx-2692775195">header.jsx-2692775195{background:black;background-image:url(/_next/static/images/metal-wallpaper-3332ea3aa68955eb3406abac6a06f036.jpg);background-position-x:center;background-attachment:fixed;margin-bottom:1rem;position:-webkit-sticky;position:sticky;top:0;z-index:1000;}
header.jsx-2692775195>h1.jsx-2692775195{font-size:2rem;}
@media (max-width:575.98px){header.jsx-2692775195>h1.jsx-2692775195{font-size:1rem;}}
header.jsx-2692775195>h1.jsx-2692775195 .title.jsx-2692775195{font-family:'Ethnocentric';color:#666;display:grid;justify-items:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;grid-template-columns:4fr 1fr 4fr;}
.shade.jsx-2692775195{position:relative;margin:-1.5rem 0 0;padding:0;display:block;background:#111;width:100%;height:1.5rem;opacity:0.25;text-align:center;}
@media (max-width:575.98px){.shade.jsx-2692775195{margin:-0.75rem 0 0;height:1rem;}}
header.jsx-2692775195>p.jsx-2692775195{text-align:center;margin:0.5rem;}
nav.jsx-2692775195{text-align:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}</style><style id="__jsx-3021175288">article img{background:white;}
article .instagram-media{margin:0 auto 12px !important;}</style><style id="__jsx-2421455553">article.jsx-3765414576>time.jsx-3765414576{display:block;margin-top:-0.5rem;margin-bottom:1rem;color:#9a9a9a;}</style><style id="__jsx-453059934">footer.jsx-453059934{background:black;font-size:small;text-align:center;padding:1rem;}
footer.jsx-453059934 img.jsx-453059934{display:inline-block;margin:0;border-radius:0;vertical-align:middle;}</style><style id="__jsx-135661401">@font-face{font-family:'Ethnocentric';font-display:auto;font-style:normal;font-weight:400;src:url('/static/fonts/ethnocentric_rg.ttf') format('truetype');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6, U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193, U+2212,U+2215,U+FEFF,U+FFFD;}
@font-face{font-family:'Orbitron';font-display:auto;font-style:normal;font-weight:400;src:url('/static/fonts/orbitron.woff2') format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6, U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193, U+2212,U+2215,U+FEFF,U+FFFD;}
@font-face{font-family:'Roboto';font-display:auto;font-style:normal;font-weight:400;src:url('/static/fonts/roboto.woff2') format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6, U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193, U+2212,U+2215,U+FEFF,U+FFFD;}
@font-face{font-family:'Fira Code';font-display:auto;font-style:normal;font-weight:400;src:url('/static/fonts/firacode.woff2') format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6, U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193, U+2212,U+2215,U+FEFF,U+FFFD;}
:focus{outline:none;}
::-moz-focus-inner{border:0;}
html,body,#__next{height:100%;margin:0;}
html{font-family:'Roboto','Ubuntu',sans-serif;font-size:16px;line-height:1.5;color:#bbb;}
body,.layout{background:black;background-image:url(/_next/static/images/metal-wallpaper-3332ea3aa68955eb3406abac6a06f036.jpg);background-position-x:center;background-attachment:fixed;}
 a{color:#429aef;-webkit-text-decoration:none;text-decoration:none;}
a:hover{-webkit-filter:brightness(125%);filter:brightness(125%);}
h1,h2,h3{font-family:'Orbitron';font-weight:normal;color:#98c379;}
h1{font-size:1.5rem;}
h2{font-size:1.2rem;}
p{margin-top:0;}
p:last-child{margin-bottom:0;}
img{display:block;vertical-align:middle;max-width:100%;margin:0 auto;}
table{margin:1em auto;}
th{background-color:rgba(150,150,150,0.33);padding:0.5em;}
td{background-color:rgba(200,200,200,0.33);padding:0.5em;}
input[type='checkbox']{vertical-align:middle;}
pre,code{font-family:'Fira Code';}
pre{white-space:pre-wrap;word-break:break-all;word-wrap:break-word;}
code{font-size:14px;color:#abb2bf;background:#282c34;}
blockquote{margin:0;margin-bottom:1rem;padding:0 1rem;border-left:0.25rem solid #bbb;}
blockquote>p:before{content:'“';font-size:2rem;line-height:0.1rem;margin-right:0.5rem;vertical-align:-0.5rem;}
blockquote>p:last-of-type:after{content:'”';font-size:2rem;line-height:0.1rem;margin-right:0.5rem;vertical-align:-0.5rem;}
.text-right{text-align:right;}
.card{margin-bottom:1rem;padding:1rem;background-color:rgba(40,44,52,0.5);}
.card-1{box-shadow:0 1px 3px rgba(0,0,0,0.12),0 1px 2px rgba(0,0,0,0.24);-webkit-transition:all 0.3s cubic-bezier(0.25,0.8,0.25,1);transition:all 0.3s cubic-bezier(0.25,0.8,0.25,1);}
.card-1:hover{box-shadow:0 14px 28px rgba(0,0,0,0.25), 0 10px 10px rgba(0,0,0,0.22);}
.container-fluid{padding-left:1rem;padding-right:1rem;}
.row>*{height:100%;}
.svg-inline--fa.fa-w-16{width:1em;}
.svg-inline--fa.fa-w-14{width:0.875em;}
.svg-inline--fa{display:inline-block;font-size:inherit;height:1em;overflow:visible;vertical-align:-0.125em;}
.mapboxgl-map{position:relative;overflow:hidden;}
.mapboxgl-marker{position:absolute;}</style><style id="__jsx-1352889155">.layout.jsx-1352889155{max-width:1024px;margin:0 auto;height:100%;display:grid;grid-template-rows:auto auto 1fr auto;}
main.jsx-1352889155{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-flow:column;-ms-flex-flow:column;flex-flow:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}</style><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0"/><link rel="apple-touch-icon" sizes="180x180" href="/static/icons/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/static/icons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/static/icons/favicon-16x16.png"/><link rel="manifest" href="/static/site.webmanifest"/><link rel="mask-icon" href="/static/icons/safari-pinned-tab.svg" color="#000000"/><meta name="msapplication-TileColor" content="#000000"/><meta name="theme-color" content="#000000"/><meta name="google-site-verification" content="RFVNvxmtxJpN5XtPqm_lrA2jrphy-Sn_fy3XyekO-2E"/><meta property="fb:app_id" content="1677017469210661"/><script src="/static/scripts/gh-spa-redirect.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.0/dist/katex.min.css" integrity="sha384-BdGj8xC2eZkQaxoQ8nSLefg4AV4/AwB3Fj+8SUSo7pnKP6Eoy18liIKTPn9oBYNG" crossorigin="anonymous"/></head><body><div id="__next"><div class="jsx-1352889155 jsx-135661401 layout container-fluid"><div class="jsx-2522996044 toolbar"><div class="jsx-2522996044"><a href="https://www.facebook.com/IngloriousCoderz/" target="_blank" rel="noopener noreferrer" aria-label="Facebook" class="jsx-2096718123 button"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="facebook" class="svg-inline--fa fa-facebook fa-w-16 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M504 256C504 119 393 8 256 8S8 119 8 256c0 123.78 90.69 226.38 209.25 245V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14 0 55.52 4.84 55.52 4.84v61h-31.28c-30.8 0-40.41 19.12-40.41 38.73V256h68.78l-11 71.69h-57.78V501C413.31 482.38 504 379.78 504 256z"></path></svg></a><a href="https://www.instagram.com/ingloriouscoderz/" target="_blank" rel="noopener noreferrer" aria-label="Instagram" class="jsx-2096718123 button"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="instagram" class="svg-inline--fa fa-instagram fa-w-14 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M224.1 141c-63.6 0-114.9 51.3-114.9 114.9s51.3 114.9 114.9 114.9S339 319.5 339 255.9 287.7 141 224.1 141zm0 189.6c-41.1 0-74.7-33.5-74.7-74.7s33.5-74.7 74.7-74.7 74.7 33.5 74.7 74.7-33.6 74.7-74.7 74.7zm146.4-194.3c0 14.9-12 26.8-26.8 26.8-14.9 0-26.8-12-26.8-26.8s12-26.8 26.8-26.8 26.8 12 26.8 26.8zm76.1 27.2c-1.7-35.9-9.9-67.7-36.2-93.9-26.2-26.2-58-34.4-93.9-36.2-37-2.1-147.9-2.1-184.9 0-35.8 1.7-67.6 9.9-93.9 36.1s-34.4 58-36.2 93.9c-2.1 37-2.1 147.9 0 184.9 1.7 35.9 9.9 67.7 36.2 93.9s58 34.4 93.9 36.2c37 2.1 147.9 2.1 184.9 0 35.9-1.7 67.7-9.9 93.9-36.2 26.2-26.2 34.4-58 36.2-93.9 2.1-37 2.1-147.8 0-184.8zM398.8 388c-7.8 19.6-22.9 34.7-42.6 42.6-29.5 11.7-99.5 9-132.1 9s-102.7 2.6-132.1-9c-19.6-7.8-34.7-22.9-42.6-42.6-11.7-29.5-9-99.5-9-132.1s-2.6-102.7 9-132.1c7.8-19.6 22.9-34.7 42.6-42.6 29.5-11.7 99.5-9 132.1-9s102.7-2.6 132.1 9c19.6 7.8 34.7 22.9 42.6 42.6 11.7 29.5 9 99.5 9 132.1s2.7 102.7-9 132.1z"></path></svg></a><a href="https://github.com/IngloriousCoderz/" target="_blank" rel="noopener noreferrer" aria-label="Github" class="jsx-2096718123 button"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="github" class="svg-inline--fa fa-github fa-w-16 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg></a><a href="https://www.linkedin.com/company/inglorious-coderz/" target="_blank" rel="noopener noreferrer" aria-label="LinkedIn" class="jsx-2096718123 button"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="linkedin" class="svg-inline--fa fa-linkedin fa-w-14 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"></path></svg></a><a href="https://twitch.tv/ingloriouscoderz" target="_blank" rel="noopener noreferrer" aria-label="Twitch" class="jsx-2096718123 button"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="twitch" class="svg-inline--fa fa-twitch fa-w-16 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M391.17,103.47H352.54v109.7h38.63ZM285,103H246.37V212.75H285ZM120.83,0,24.31,91.42V420.58H140.14V512l96.53-91.42h77.25L487.69,256V0ZM449.07,237.75l-77.22,73.12H294.61l-67.6,64v-64H140.14V36.58H449.07Z"></path></svg></a><a href="https://www.youtube.com/channel/UCBwo1pwwUtGi_BqsDYE03CA" target="_blank" rel="noopener noreferrer" aria-label="YouTube" class="jsx-2096718123 button"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="youtube" class="svg-inline--fa fa-youtube fa-w-18 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path fill="currentColor" d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"></path></svg></a><a href="mailto:antony.mistretta@gmail.com" target="_blank" rel="noopener noreferrer" aria-label="Email" class="jsx-2096718123 button"><svg aria-hidden="true" focusable="false" data-prefix="far" data-icon="envelope" class="svg-inline--fa fa-envelope fa-w-16 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M464 64H48C21.49 64 0 85.49 0 112v288c0 26.51 21.49 48 48 48h416c26.51 0 48-21.49 48-48V112c0-26.51-21.49-48-48-48zm0 48v40.805c-22.422 18.259-58.168 46.651-134.587 106.49-16.841 13.247-50.201 45.072-73.413 44.701-23.208.375-56.579-31.459-73.413-44.701C106.18 199.465 70.425 171.067 48 152.805V112h416zM48 400V214.398c22.914 18.251 55.409 43.862 104.938 82.646 21.857 17.205 60.134 55.186 103.062 54.955 42.717.231 80.509-37.199 103.053-54.947 49.528-38.783 82.032-64.401 104.947-82.653V400H48z"></path></svg></a><a href="tel:+393202357664" target="_blank" rel="noopener noreferrer" aria-label="WhatsApp" class="jsx-2096718123 button"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="whatsapp" class="svg-inline--fa fa-whatsapp fa-w-14 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M380.9 97.1C339 55.1 283.2 32 223.9 32c-122.4 0-222 99.6-222 222 0 39.1 10.2 77.3 29.6 111L0 480l117.7-30.9c32.4 17.7 68.9 27 106.1 27h.1c122.3 0 224.1-99.6 224.1-222 0-59.3-25.2-115-67.1-157zm-157 341.6c-33.2 0-65.7-8.9-94-25.7l-6.7-4-69.8 18.3L72 359.2l-4.4-7c-18.5-29.4-28.2-63.3-28.2-98.2 0-101.7 82.8-184.5 184.6-184.5 49.3 0 95.6 19.2 130.4 54.1 34.8 34.9 56.2 81.2 56.1 130.5 0 101.8-84.9 184.6-186.6 184.6zm101.2-138.2c-5.5-2.8-32.8-16.2-37.9-18-5.1-1.9-8.8-2.8-12.5 2.8-3.7 5.6-14.3 18-17.6 21.8-3.2 3.7-6.5 4.2-12 1.4-32.6-16.3-54-29.1-75.5-66-5.7-9.8 5.7-9.1 16.3-30.3 1.8-3.7.9-6.9-.5-9.7-1.4-2.8-12.5-30.1-17.1-41.2-4.5-10.8-9.1-9.3-12.5-9.5-3.2-.2-6.9-.2-10.6-.2-3.7 0-9.7 1.4-14.8 6.9-5.1 5.6-19.4 19-19.4 46.3 0 27.3 19.9 53.7 22.6 57.4 2.8 3.7 39.1 59.7 94.8 83.8 35.2 15.2 49 16.5 66.6 13.9 10.7-1.6 32.8-13.4 37.4-26.4 4.6-13 4.6-24.1 3.2-26.4-1.3-2.5-5-3.9-10.5-6.6z"></path></svg></a></div><div class="jsx-2522996044"><a class="jsx-2096718123 button" href="/privacy-policy/">Privacy</a></div></div><header class="jsx-2692775195"><h1 class="jsx-2692775195"><a href="/"><div class="jsx-2692775195 title"><div class="jsx-2692775195"><span class="jsx-2692775195">Inglorious</span><span class="jsx-2692775195 shade"> </span></div><div class="jsx-3278221705 logo"><div class="jsx-3278221705 cube"><div class="jsx-3278221705 cube__face cube__face--left"><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA2IDYiPjxwYXRoIGQ9Ik0wIDBoNkw0IDF2NGwyIDFIMGwyLTFWMXoiIGZpbGw9IiM3ZjdmZmYiIGZpbGwtb3BhY2l0eT0iLjUiIHN0cm9rZT0iIzdmN2ZjMCIgc3Ryb2tlLXdpZHRoPSIuMjUiIHN0cm9rZS1vcGFjaXR5PSIuNSIvPjwvc3ZnPg==" alt="I" class="jsx-3278221705"/><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA2IDYiPjxwYXRoIGQ9Ik0wIDBoMWwxLjUuNzVoMkw0IDFIMnoiIGZpbGw9IiMwMGMwYzAiIGZpbGwtb3BhY2l0eT0iLjUiLz48cGF0aCBkPSJNMSAwaDVMNC41Ljc1aC0yeiIgZmlsbD0iIzBmZiIgZmlsbC1vcGFjaXR5PSIuNSIvPjwvc3ZnPg==" alt="left eye" class="jsx-3278221705 eye"/></div><div class="jsx-3278221705 cube__face cube__face--right"><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA2IDYiPjxwYXRoIGQ9Ik0wIDBoNnYyTDQgMUgydjRoMmwyLTF2MkgweiIgZmlsbD0iIzdmN2ZmZiIgZmlsbC1vcGFjaXR5PSIuNSIgc3Ryb2tlPSIjN2Y3ZmMwIiBzdHJva2Utd2lkdGg9Ii4yNSIgc3Ryb2tlLW9wYWNpdHk9Ii41Ii8+PC9zdmc+" alt="C" class="jsx-3278221705"/></div></div></div><div class="jsx-2692775195"><span class="jsx-2692775195">Coderz</span><span class="jsx-2692775195 shade"> </span></div></div></a></h1><nav class="jsx-2692775195"><a class="jsx-2096718123 button" href="/why/">Why</a><a class="jsx-2096718123 button" href="/who/">Who</a><a class="jsx-2096718123 button" href="/what/">What</a><a class="jsx-2096718123 button" href="/how/">How</a><a class="jsx-2096718123 button" href="/when/">When</a><a class="jsx-2096718123 button" href="/where/">Where</a><a class="jsx-2096718123 button" href="/how-much/">How Much</a><a class="jsx-2096718123 button" href="/icy/">Icy</a><a class="jsx-2096718123 button" href="/blog/">Blog</a></nav></header><main class="jsx-1352889155 jsx-135661401"><article class="jsx-3765414576 card card-1"><h1 class="jsx-3765414576">Componenti react/redux come librerie</h1><time dateTime="2016-11-16T00:00:00.000Z" class="jsx-3765414576">11/16/2016</time><div><p>L&#x27;ecosistema creato da Facebook sta tirando fuori un gioiellino dopo l&#x27;altro: dopo <a href="https://facebook.github.io/react/" target="_blank" rel="noopener noreferrer">react</a> e <a href="http://redux.js.org/" target="_blank" rel="noopener noreferrer">redux</a> di recente è anche uscito <a href="https://github.com/facebookincubator/create-react-app" target="_blank" rel="noopener noreferrer">create-react-app</a>, che permette di arrivare da zero ad app funzionante in un unico comando. Ma che succede se vogliamo pubblicare un componente React da usare come libreria per altri progetti? E se lo stato del componente fosse così complesso da richiedere un contenitore di stati come Redux? Queste sono le domande che mi sono dovuto porre quando ho creato <a href="https://github.com/IngloriousCoderz/react-property-grid" target="_blank" rel="noopener noreferrer"><code>react-property-grid</code></a>.</p>
<p>Affrontiamo le domande una per volta.</p>
<p>Si può usare create-react-app per pubblicare librerie invece che app? Nì. Al momento in cui scrivo, <code>create-react-app</code> è pensato per le app e <a href="https://github.com/facebookincubator/create-react-app/issues/423#issuecomment-250752431" target="_blank" rel="noopener noreferrer">non intende gestire la creazione di librerie nel breve tempo</a>.</p>
<p>Tuttavia la comodità di <code>create-react-app</code> rende difficile rinunciarci e fortunatamente gli script che include sono molto ben fatti e documentati, perciò quello che consiglio è di:</p>
<ol>
<li>creare il progetto con <code>create-react-app</code></li>
<li>&quot;espellerlo&quot; con <code>npm run eject</code></li>
<li>modificare il <code>webpack.config.prod.dll</code> in modo che produca una libreria</li>
</ol>
<p>Purtroppo il processo di <code>eject</code>, essendo irreversibile, ci impedisce di rimanere facilmente al passo con versioni future dei <code>react-scripts</code>, ma in assenza di soluzioni migliori al momento il gioco vale la candela.</p>
<p>Il terzo punto consiste nel produrre un file simile a quello che si trova <a href="https://github.com/IngloriousCoderz/react-property-grid/blob/master/config/webpack.config.prod.js" target="_blank" rel="noopener noreferrer">qui</a>, in particolare:</p>
<ul>
<li><code>output</code> specifica un nome di file ben preciso e un nome per la libreria</li>
</ul>
<pre><code class="language-js">output: {
  path: paths.appBuild,
  filename: &#x27;index.js&#x27;,
  library: &#x27;react-property-grid&#x27;,
  libraryTarget: &#x27;umd&#x27;
}
</code></pre>
<ul>
<li><code>externals</code> dichiara tutte le dipendenze che non vogliamo includere nel bundle, ma vogliamo richiamarle come peer dependencies:</li>
</ul>
<pre><code class="language-js">externals: {
  &#x27;json-schema-deref-local&#x27;: &#x27;json-schema-deref-local&#x27;,
  &#x27;jsonpath&#x27;: &#x27;jsonpath&#x27;,
  &#x27;react&#x27;: &#x27;react&#x27;,
  &#x27;react-dom&#x27;: &#x27;react-dom&#x27;,
  &#x27;react-redux&#x27;: &#x27;react-redux&#x27;,
  &#x27;react-sortable-hoc&#x27;: &#x27;react-sortable-hoc&#x27;,
  &#x27;react-throttle&#x27;: &#x27;react-throttle&#x27;,
  &#x27;redux&#x27;: &#x27;redux&#x27;,
  &#x27;tv4&#x27;: &#x27;tv4&#x27;,
  &#x27;uuid&#x27;: &#x27;uuid&#x27;
}
</code></pre>
<ul>
<li>come fatto per la parte JavaScript, anche un eventuale CSS acquista un nome preciso; la parte HTML invece viene spenta:</li>
</ul>
<pre><code class="language-js">plugins: [
  // new HtmlWebpackPlugin({...}),
  ...,
  new ExtractTextPlugin(&#x27;index.css&#x27;)
]
</code></pre>
<ul>
<li>a questo punto senza altre modifiche il progetto viene compilato come un <code>index.js</code> e un <code>index.css</code> nella directory <code>build</code>. Se invece vogliamo modificare la directory di destinazione, possiamo farlo in <code>paths.js</code>:</li>
</ul>
<pre><code class="language-js">module.exports = {
  appBuild: resolveApp(&#x27;dist&#x27;),//resolveApp(&#x27;build&#x27;),
  ...
};
</code></pre>
<ul>
<li>infine modifichiamo il nostro <code>package.json</code> in modo che si comporti come una libreria:</li>
</ul>
<pre><code class="language-js">{
  &quot;name&quot;: &quot;react-property-grid&quot;,
  &quot;version&quot;: &quot;0.1.0&quot;,
  &quot;main&quot;: &quot;dist/index.js&quot;,
  &quot;scripts&quot;: {
    &quot;prepublish&quot;: &quot;npm run build&quot;,
    ...
  },
  ...
}
</code></pre>
<p>Lo script <code>prepublish</code> fa un build appena prima di pubblicare il progetto su npm, pertanto fa in modo che non dobbiamo tenerci nel repository la directory <code>dist</code>. Possiamo quindi aggiungere questa directory nel <code>.gitignore</code> (ma stiamo attenti a non metterla nel <code>.npmignore</code>, altrimenti NPM si terrà solo i sorgenti e non la libreria vera e propria).</p>
<p>E questa era la parte facile.</p>
<p>La parte difficile è stabilire dove tenere lo stato del componente: dato che uno dei punti cardine di redux è la <a href="http://redux.js.org/docs/introduction/ThreePrinciples.html#single-source-of-truth" target="_blank" rel="noopener noreferrer">singola sorgente di verità</a>, verrebbe da tentare di esporre nella libreria un riduttore da agganciare allo store dell&#x27;app che la ospita. Tuttavia, oltre che essere un&#x27;operazione molto macchinosa, non porta alcun vero vantaggio. Anzi, Lo stato di <code>react-property-grid</code> interessa solo a <code>react-property-grid</code>, e l&#x27;app è solo interessata al suo output finale.</p>
<p>La soluzione è una violazione al principio di unica sorgente di verità: la root del componente di libreria avrà il suo store personale. Questo comportamento è descritto anche nel sito di redux come <a href="http://redux.js.org/docs/recipes/IsolatingSubapps.html" target="_blank" rel="noopener noreferrer">Isolating Redux Sub-Apps</a>: in circostanze molto specifiche (come la nostra) è concesso di disporre di più di uno store.</p>
<p>Il trucco consiste nell&#x27;istanziare lo store nel costruttore del componente, in modo che ce ne sia solo uno per ogni istanza del componente. Aggiungo un pezzo:</p>
<pre><code class="language-js">class SubApp extends Component {
  constructor(props) {
    super(props)
    this.store = createStore(reducer)

    this.store.subscribe(() =&gt; {
      const state = this.store.getState()
      props.onChange(state.data)
    })

    this.store.dispatch(init(props.data))
  }

  componentWillUpdate(nextProps) {
    this.store.dispatch(init(nextProps.data))
  }

  render() {
    return (
      &lt;Provider store={this.store}&gt;
        &lt;App /&gt;
      &lt;/Provider&gt;
    )
  }
}
</code></pre>
<p>Come si può notare lo stato viene inizializzato nel costruttore grazie a un apposito actionCreator e viene aggiornato a ogni nuova proprietà (ovviamente si possono limitare gli aggiornamenti con il solito metodo <code>shouldComponentUpdate(nextProps)</code>). Per comunicare con l&#x27;esterno si può aggiungere allo store un listener che chiama una funzione onChange definita altrove.</p>
<p>Infine un&#x27;altra cosa che non viene citata nell&#x27;articolo è il caso in cui la parent app abbia anch&#x27;essa uno store: in questo caso per evitare conflitti suggerisco di aggiungere <a href="https://github.com/emmenko/react-redux-custom-store" target="_blank" rel="noopener noreferrer"><code>react-redux-custom-store</code></a>, che permette di associare un nome univoco a ogni store del sistema.</p>
<p>Se si usa <a href="https://github.com/zalmoxisus/redux-devtools-extension" target="_blank" rel="noopener noreferrer"><code>redux-devtools-extension</code></a> bisogna tenere presente che ora gli store sono due, e si possono selezionare dal menù a tendina in alto a destra con la dicitura &quot;Autoselect instances&quot;, che purtroppo al momento mostra due istanze con lo stesso nome anziché usare il nome custom che abbiamo definito:</p>
<p><img src="/static/images/blog/componenti-react-redux-come-librerie/store-instances.png" alt="store multipli in redux-devtools-extension"/></p>
<p>Speriamo che un giorno Facebook cerchi di rendere la vita più semplice non solo agli sviluppatori di app ma anche ai produttori di librerie. Nel frattempo non possiamo far altro che apprezzare l&#x27;enorme sforzo che già stanno facendo e magari contribuire, documentando best practice o creare noi stessi una <code>create-react-lib</code>!</p>
<pre><code># IceOnFire
</code></pre></div></article></main><footer class="jsx-453059934"><a href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" rel="noopener noreferrer"><img alt="Licenza Creative Commons" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAAAPCAMAAABEF7i9AAAAllBMVEUAAAANDQwNDQ0NDg0ODg4PEA8REREZGRkgICAhISEiIiIkJSMnKCcuMC4xMzEzMzM5Ozk7PTtBQkFCQkJDQ0NERERLTEtVVVVbXltmZmZna2dydnF3d3d9gn2AgICGhoaHh4eIiIiPkI+UmZOZmZmqqqqrsaqzuLK6v7q7u7vFxsXGysbIzMjKzsrMzMzd3d3u7u7///+uXr4hAAAA2klEQVQ4y62T6RKCMAyEIyIq3kc961GBeCN5/5eTalupozOONMMfluVjk1AA50VOSwJR1gKEkpgfIV5rf6bTwMgX5iOsjXhYlwQOmq/UKcwQL5NywKqgNASWMQhTYt28552arzIV/FK2AE+bBVzBkcIpcR5kcUK8mvd8Us8fl/Hru2+CBi4hzeRWpj3ZM/cR92eTUNn0uxpvC/QxIZsHGY+Je3ZCKHZIdsI3wczQE5QEMM9n2LvRuGPN0Ab+NkPsNxxvOapsDXDUcvAf5mvZKN6wXvakuD7LjusO1DVRlsjT/rIAAAAASUVORK5CYII=" class="jsx-453059934"/></a> INGLORIOUS CODERZ DI MISTRETTA MATTEO ANTONY | 39 Via Val Della Torre, 10149 Torino (TO) | VAT Code IT11524720015 | Tax Code MSTMTN82R17H501A</footer></div></div><script>__NEXT_DATA__ = {"props":{"pageProps":{"post":{"data":{"title":"Componenti react/redux come librerie","description":"Qualche trucchetto per creare una libreria con Redux, violando la Singola Sorgente di Verità.","author":"IceOnFire","_entry":"posts/blog/2016-11-16-componenti-react-redux-come-librerie.md","page":"post","name":"componenti-react-redux-come-librerie","category":"blog","date":"2016-11-16T00:00:00.000Z","url":"/blog/componenti-react-redux-come-librerie"},"content":{"type":"root","children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"L'ecosistema creato da Facebook sta tirando fuori un gioiellino dopo l'altro: dopo "},{"type":"element","tagName":"a","properties":{"href":"https://facebook.github.io/react/"},"children":[{"type":"text","value":"react"}]},{"type":"text","value":" e "},{"type":"element","tagName":"a","properties":{"href":"http://redux.js.org/"},"children":[{"type":"text","value":"redux"}]},{"type":"text","value":" di recente è anche uscito "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/facebookincubator/create-react-app"},"children":[{"type":"text","value":"create-react-app"}]},{"type":"text","value":", che permette di arrivare da zero ad app funzionante in un unico comando. Ma che succede se vogliamo pubblicare un componente React da usare come libreria per altri progetti? E se lo stato del componente fosse così complesso da richiedere un contenitore di stati come Redux? Queste sono le domande che mi sono dovuto porre quando ho creato "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/IngloriousCoderz/react-property-grid"},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"react-property-grid"}]}]},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Affrontiamo le domande una per volta."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Si può usare create-react-app per pubblicare librerie invece che app? Nì. Al momento in cui scrivo, "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"create-react-app"}]},{"type":"text","value":" è pensato per le app e "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/facebookincubator/create-react-app/issues/423#issuecomment-250752431"},"children":[{"type":"text","value":"non intende gestire la creazione di librerie nel breve tempo"}]},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Tuttavia la comodità di "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"create-react-app"}]},{"type":"text","value":" rende difficile rinunciarci e fortunatamente gli script che include sono molto ben fatti e documentati, perciò quello che consiglio è di:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"creare il progetto con "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"create-react-app"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\"espellerlo\" con "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"npm run eject"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"modificare il "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"webpack.config.prod.dll"}]},{"type":"text","value":" in modo che produca una libreria"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Purtroppo il processo di "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"eject"}]},{"type":"text","value":", essendo irreversibile, ci impedisce di rimanere facilmente al passo con versioni future dei "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"react-scripts"}]},{"type":"text","value":", ma in assenza di soluzioni migliori al momento il gioco vale la candela."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Il terzo punto consiste nel produrre un file simile a quello che si trova "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/IngloriousCoderz/react-property-grid/blob/master/config/webpack.config.prod.js"},"children":[{"type":"text","value":"qui"}]},{"type":"text","value":", in particolare:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"output"}]},{"type":"text","value":" specifica un nome di file ben preciso e un nome per la libreria"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-js"]},"children":[{"type":"text","value":"output: {\n  path: paths.appBuild,\n  filename: 'index.js',\n  library: 'react-property-grid',\n  libraryTarget: 'umd'\n}\n"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"externals"}]},{"type":"text","value":" dichiara tutte le dipendenze che non vogliamo includere nel bundle, ma vogliamo richiamarle come peer dependencies:"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-js"]},"children":[{"type":"text","value":"externals: {\n  'json-schema-deref-local': 'json-schema-deref-local',\n  'jsonpath': 'jsonpath',\n  'react': 'react',\n  'react-dom': 'react-dom',\n  'react-redux': 'react-redux',\n  'react-sortable-hoc': 'react-sortable-hoc',\n  'react-throttle': 'react-throttle',\n  'redux': 'redux',\n  'tv4': 'tv4',\n  'uuid': 'uuid'\n}\n"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"come fatto per la parte JavaScript, anche un eventuale CSS acquista un nome preciso; la parte HTML invece viene spenta:"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-js"]},"children":[{"type":"text","value":"plugins: [\n  // new HtmlWebpackPlugin({...}),\n  ...,\n  new ExtractTextPlugin('index.css')\n]\n"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"a questo punto senza altre modifiche il progetto viene compilato come un "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"index.js"}]},{"type":"text","value":" e un "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"index.css"}]},{"type":"text","value":" nella directory "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"build"}]},{"type":"text","value":". Se invece vogliamo modificare la directory di destinazione, possiamo farlo in "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"paths.js"}]},{"type":"text","value":":"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-js"]},"children":[{"type":"text","value":"module.exports = {\n  appBuild: resolveApp('dist'),//resolveApp('build'),\n  ...\n};\n"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"infine modifichiamo il nostro "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"package.json"}]},{"type":"text","value":" in modo che si comporti come una libreria:"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-js"]},"children":[{"type":"text","value":"{\n  \"name\": \"react-property-grid\",\n  \"version\": \"0.1.0\",\n  \"main\": \"dist/index.js\",\n  \"scripts\": {\n    \"prepublish\": \"npm run build\",\n    ...\n  },\n  ...\n}\n"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Lo script "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"prepublish"}]},{"type":"text","value":" fa un build appena prima di pubblicare il progetto su npm, pertanto fa in modo che non dobbiamo tenerci nel repository la directory "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"dist"}]},{"type":"text","value":". Possiamo quindi aggiungere questa directory nel "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":".gitignore"}]},{"type":"text","value":" (ma stiamo attenti a non metterla nel "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":".npmignore"}]},{"type":"text","value":", altrimenti NPM si terrà solo i sorgenti e non la libreria vera e propria)."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"E questa era la parte facile."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"La parte difficile è stabilire dove tenere lo stato del componente: dato che uno dei punti cardine di redux è la "},{"type":"element","tagName":"a","properties":{"href":"http://redux.js.org/docs/introduction/ThreePrinciples.html#single-source-of-truth"},"children":[{"type":"text","value":"singola sorgente di verità"}]},{"type":"text","value":", verrebbe da tentare di esporre nella libreria un riduttore da agganciare allo store dell'app che la ospita. Tuttavia, oltre che essere un'operazione molto macchinosa, non porta alcun vero vantaggio. Anzi, Lo stato di "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"react-property-grid"}]},{"type":"text","value":" interessa solo a "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"react-property-grid"}]},{"type":"text","value":", e l'app è solo interessata al suo output finale."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"La soluzione è una violazione al principio di unica sorgente di verità: la root del componente di libreria avrà il suo store personale. Questo comportamento è descritto anche nel sito di redux come "},{"type":"element","tagName":"a","properties":{"href":"http://redux.js.org/docs/recipes/IsolatingSubapps.html"},"children":[{"type":"text","value":"Isolating Redux Sub-Apps"}]},{"type":"text","value":": in circostanze molto specifiche (come la nostra) è concesso di disporre di più di uno store."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Il trucco consiste nell'istanziare lo store nel costruttore del componente, in modo che ce ne sia solo uno per ogni istanza del componente. Aggiungo un pezzo:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-js"]},"children":[{"type":"text","value":"class SubApp extends Component {\n  constructor(props) {\n    super(props)\n    this.store = createStore(reducer)\n\n    this.store.subscribe(() =\u003e {\n      const state = this.store.getState()\n      props.onChange(state.data)\n    })\n\n    this.store.dispatch(init(props.data))\n  }\n\n  componentWillUpdate(nextProps) {\n    this.store.dispatch(init(nextProps.data))\n  }\n\n  render() {\n    return (\n      \u003cProvider store={this.store}\u003e\n        \u003cApp /\u003e\n      \u003c/Provider\u003e\n    )\n  }\n}\n"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Come si può notare lo stato viene inizializzato nel costruttore grazie a un apposito actionCreator e viene aggiornato a ogni nuova proprietà (ovviamente si possono limitare gli aggiornamenti con il solito metodo "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"shouldComponentUpdate(nextProps)"}]},{"type":"text","value":"). Per comunicare con l'esterno si può aggiungere allo store un listener che chiama una funzione onChange definita altrove."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Infine un'altra cosa che non viene citata nell'articolo è il caso in cui la parent app abbia anch'essa uno store: in questo caso per evitare conflitti suggerisco di aggiungere "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/emmenko/react-redux-custom-store"},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"react-redux-custom-store"}]}]},{"type":"text","value":", che permette di associare un nome univoco a ogni store del sistema."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Se si usa "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/zalmoxisus/redux-devtools-extension"},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"redux-devtools-extension"}]}]},{"type":"text","value":" bisogna tenere presente che ora gli store sono due, e si possono selezionare dal menù a tendina in alto a destra con la dicitura \"Autoselect instances\", che purtroppo al momento mostra due istanze con lo stesso nome anziché usare il nome custom che abbiamo definito:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"img","properties":{"src":"/static/images/blog/componenti-react-redux-come-librerie/store-instances.png","alt":"store multipli in redux-devtools-extension"},"children":[]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Speriamo che un giorno Facebook cerchi di rendere la vita più semplice non solo agli sviluppatori di app ma anche ai produttori di librerie. Nel frattempo non possiamo far altro che apprezzare l'enorme sforzo che già stanno facendo e magari contribuire, documentando best practice o creare noi stessi una "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"create-react-lib"}]},{"type":"text","value":"!"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"# IceOnFire\n"}]}]}],"data":{"quirksMode":false}},"raw":"\nL'ecosistema creato da Facebook sta tirando fuori un gioiellino dopo l'altro: dopo [react](https://facebook.github.io/react/) e [redux](http://redux.js.org/) di recente è anche uscito [create-react-app](https://github.com/facebookincubator/create-react-app), che permette di arrivare da zero ad app funzionante in un unico comando. Ma che succede se vogliamo pubblicare un componente React da usare come libreria per altri progetti? E se lo stato del componente fosse così complesso da richiedere un contenitore di stati come Redux? Queste sono le domande che mi sono dovuto porre quando ho creato [`react-property-grid`](https://github.com/IngloriousCoderz/react-property-grid).\n\nAffrontiamo le domande una per volta.\n\nSi può usare create-react-app per pubblicare librerie invece che app? Nì. Al momento in cui scrivo, `create-react-app` è pensato per le app e [non intende gestire la creazione di librerie nel breve tempo](https://github.com/facebookincubator/create-react-app/issues/423#issuecomment-250752431).\n\nTuttavia la comodità di `create-react-app` rende difficile rinunciarci e fortunatamente gli script che include sono molto ben fatti e documentati, perciò quello che consiglio è di:\n\n1. creare il progetto con `create-react-app`\n2. \"espellerlo\" con `npm run eject`\n3. modificare il `webpack.config.prod.dll` in modo che produca una libreria\n\nPurtroppo il processo di `eject`, essendo irreversibile, ci impedisce di rimanere facilmente al passo con versioni future dei `react-scripts`, ma in assenza di soluzioni migliori al momento il gioco vale la candela.\n\nIl terzo punto consiste nel produrre un file simile a quello che si trova [qui](https://github.com/IngloriousCoderz/react-property-grid/blob/master/config/webpack.config.prod.js), in particolare:\n\n- `output` specifica un nome di file ben preciso e un nome per la libreria\n\n```js\noutput: {\n  path: paths.appBuild,\n  filename: 'index.js',\n  library: 'react-property-grid',\n  libraryTarget: 'umd'\n}\n```\n\n- `externals` dichiara tutte le dipendenze che non vogliamo includere nel bundle, ma vogliamo richiamarle come peer dependencies:\n\n```js\nexternals: {\n  'json-schema-deref-local': 'json-schema-deref-local',\n  'jsonpath': 'jsonpath',\n  'react': 'react',\n  'react-dom': 'react-dom',\n  'react-redux': 'react-redux',\n  'react-sortable-hoc': 'react-sortable-hoc',\n  'react-throttle': 'react-throttle',\n  'redux': 'redux',\n  'tv4': 'tv4',\n  'uuid': 'uuid'\n}\n```\n\n- come fatto per la parte JavaScript, anche un eventuale CSS acquista un nome preciso; la parte HTML invece viene spenta:\n\n```js\nplugins: [\n  // new HtmlWebpackPlugin({...}),\n  ...,\n  new ExtractTextPlugin('index.css')\n]\n```\n\n- a questo punto senza altre modifiche il progetto viene compilato come un `index.js` e un `index.css` nella directory `build`. Se invece vogliamo modificare la directory di destinazione, possiamo farlo in `paths.js`:\n\n```js\nmodule.exports = {\n  appBuild: resolveApp('dist'),//resolveApp('build'),\n  ...\n};\n```\n\n- infine modifichiamo il nostro `package.json` in modo che si comporti come una libreria:\n\n```js\n{\n  \"name\": \"react-property-grid\",\n  \"version\": \"0.1.0\",\n  \"main\": \"dist/index.js\",\n  \"scripts\": {\n    \"prepublish\": \"npm run build\",\n    ...\n  },\n  ...\n}\n```\n\nLo script `prepublish` fa un build appena prima di pubblicare il progetto su npm, pertanto fa in modo che non dobbiamo tenerci nel repository la directory `dist`. Possiamo quindi aggiungere questa directory nel `.gitignore` (ma stiamo attenti a non metterla nel `.npmignore`, altrimenti NPM si terrà solo i sorgenti e non la libreria vera e propria).\n\nE questa era la parte facile.\n\nLa parte difficile è stabilire dove tenere lo stato del componente: dato che uno dei punti cardine di redux è la [singola sorgente di verità](http://redux.js.org/docs/introduction/ThreePrinciples.html#single-source-of-truth), verrebbe da tentare di esporre nella libreria un riduttore da agganciare allo store dell'app che la ospita. Tuttavia, oltre che essere un'operazione molto macchinosa, non porta alcun vero vantaggio. Anzi, Lo stato di `react-property-grid` interessa solo a `react-property-grid`, e l'app è solo interessata al suo output finale.\n\nLa soluzione è una violazione al principio di unica sorgente di verità: la root del componente di libreria avrà il suo store personale. Questo comportamento è descritto anche nel sito di redux come [Isolating Redux Sub-Apps](http://redux.js.org/docs/recipes/IsolatingSubapps.html): in circostanze molto specifiche (come la nostra) è concesso di disporre di più di uno store.\n\nIl trucco consiste nell'istanziare lo store nel costruttore del componente, in modo che ce ne sia solo uno per ogni istanza del componente. Aggiungo un pezzo:\n\n```js\nclass SubApp extends Component {\n  constructor(props) {\n    super(props)\n    this.store = createStore(reducer)\n\n    this.store.subscribe(() =\u003e {\n      const state = this.store.getState()\n      props.onChange(state.data)\n    })\n\n    this.store.dispatch(init(props.data))\n  }\n\n  componentWillUpdate(nextProps) {\n    this.store.dispatch(init(nextProps.data))\n  }\n\n  render() {\n    return (\n      \u003cProvider store={this.store}\u003e\n        \u003cApp /\u003e\n      \u003c/Provider\u003e\n    )\n  }\n}\n```\n\nCome si può notare lo stato viene inizializzato nel costruttore grazie a un apposito actionCreator e viene aggiornato a ogni nuova proprietà (ovviamente si possono limitare gli aggiornamenti con il solito metodo `shouldComponentUpdate(nextProps)`). Per comunicare con l'esterno si può aggiungere allo store un listener che chiama una funzione onChange definita altrove.\n\nInfine un'altra cosa che non viene citata nell'articolo è il caso in cui la parent app abbia anch'essa uno store: in questo caso per evitare conflitti suggerisco di aggiungere [`react-redux-custom-store`](https://github.com/emmenko/react-redux-custom-store), che permette di associare un nome univoco a ogni store del sistema.\n\nSe si usa [`redux-devtools-extension`](https://github.com/zalmoxisus/redux-devtools-extension) bisogna tenere presente che ora gli store sono due, e si possono selezionare dal menù a tendina in alto a destra con la dicitura \"Autoselect instances\", che purtroppo al momento mostra due istanze con lo stesso nome anziché usare il nome custom che abbiamo definito:\n\n![store multipli in redux-devtools-extension](/static/images/blog/componenti-react-redux-come-librerie/store-instances.png)\n\nSperiamo che un giorno Facebook cerchi di rendere la vita più semplice non solo agli sviluppatori di app ma anche ai produttori di librerie. Nel frattempo non possiamo far altro che apprezzare l'enorme sforzo che già stanno facendo e magari contribuire, documentando best practice o creare noi stessi una `create-react-lib`!\n\n    # IceOnFire\n"},"_entriesMap":{"/blog":{"pathname":"/blog"},"/how-much":{"pathname":"/how-much"},"/how":{"pathname":"/how"},"/icy":{"pathname":"/icy"},"/privacy-policy":{"pathname":"/privacy-policy"},"/what/code":{"pathname":"/what/code"},"/what/community":{"pathname":"/what/community"},"/what":{"pathname":"/what"},"/what/speak/conferences":{"pathname":"/what/speak/conferences"},"/what/speak":{"pathname":"/what/speak"},"/what/volunteer":{"pathname":"/what/volunteer"},"/when":{"pathname":"/when"},"/where":{"pathname":"/where"},"/who/consultant":{"pathname":"/who/consultant"},"/who":{"pathname":"/who"},"/who/mentor":{"pathname":"/who/mentor"},"/who/teacher":{"pathname":"/who/teacher"},"/who/tech-lead":{"pathname":"/who/tech-lead"},"/why":{"pathname":"/why"},"/404":{"pathname":"/_error"},"/":{"pathname":"/"},"/blog/hello-world":{"pathname":"/post","query":{"_entry":"posts/blog/2016-02-21-hello-world.md"}},"/blog/il-vaso-di-piva":{"pathname":"/post","query":{"_entry":"posts/blog/2016-05-11-il-vaso-di-piva.md"}},"/blog/resistere-alla-tentazione-del-procedurale-in-redux":{"pathname":"/post","query":{"_entry":"posts/blog/2016-07-21-resistere-alla-tentazione-del-procedurale-in-redux.md"}},"/blog/pokemon-go-e-la-teoria-degli-effetti-collaterali":{"pathname":"/post","query":{"_entry":"posts/blog/2016-07-22-pokemon-go-e-la-teoria-degli-effetti-collaterali.md"}},"/blog/componenti-react-redux-come-librerie":{"pathname":"/post","query":{"_entry":"posts/blog/2016-11-16-componenti-react-redux-come-librerie.md"}},"/blog/migliorare-il-codice-con-il-currying":{"pathname":"/post","query":{"_entry":"posts/blog/2018-02-08-migliorare-il-codice-con-il-currying.md"}},"/blog/loopback-porting-di-spring-boot":{"pathname":"/post","query":{"_entry":"posts/blog/2018-10-23-loopback-porting-di-spring-boot.md"}},"/blog/oracles-in-quantum-algorithms":{"pathname":"/post","query":{"_entry":"posts/blog/2020-04-25-oracles-in-quantum-algorithms.md"}},"/blog/reverse-engineering-quantum-circuits":{"pathname":"/post","query":{"_entry":"posts/blog/2020-05-01-reverse-engineering-quantum-circuits.md"}},"/blog/programmiamo-un-calcolatore-quantistico-in-python":{"pathname":"/post","query":{"_entry":"posts/blog/2021-03-11-programmiamo-un-calcolatore-quantistico-in-python.md"}}}}},"page":"/post","query":{"_entry":"posts/blog/2016-11-16-componenti-react-redux-come-librerie.md"},"buildId":"U8cRU8f7JegK67LboKVwn","nextExport":true};__NEXT_LOADED_PAGES__=[];__NEXT_REGISTER_PAGE=function(r,f){__NEXT_LOADED_PAGES__.push([r, f])}</script><script async="" id="__NEXT_PAGE__/post" src="/_next/static/U8cRU8f7JegK67LboKVwn/pages/post.js"></script><script async="" id="__NEXT_PAGE__/_app" src="/_next/static/U8cRU8f7JegK67LboKVwn/pages/_app.js"></script><script async="" id="__NEXT_PAGE__/_error" src="/_next/static/U8cRU8f7JegK67LboKVwn/pages/_error.js"></script><script src="/_next/static/runtime/webpack-347dd6a0495bab5a4caf.js" async=""></script><script src="/_next/static/chunks/commons.82aab45b771716fb8e99.js" async=""></script><script src="/_next/static/chunks/styles.273fa001fc5fa7fd2b84.js" async=""></script><script src="/_next/static/runtime/main-dcd3443c392942bb9cfd.js" async=""></script></body></html>