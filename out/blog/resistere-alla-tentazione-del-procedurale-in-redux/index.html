<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8" class="next-head"/><meta property="og:type" content="website" class="next-head"/><meta property="og:image" content="https://www.ingloriouscoderz.it/static/images/backgrounds/metal-800x600.png" class="next-head"/><meta property="og:image:alt" content="Inglorious Coderz" class="next-head"/><meta property="og:image:width" content="800" class="next-head"/><meta property="og:image:height" content="600" class="next-head"/><meta property="og:locale" content="en_US" class="next-head"/><meta property="og:site_name" content="Inglorious Coderz" class="next-head"/><title class="next-head">Resistere alla tentazione del procedurale in Redux | Inglorious Coderz</title><meta name="robots" content="index,follow" class="next-head"/><meta name="googlebot" content="index,follow" class="next-head"/><meta name="description" content="Non è facile disimparare, ma si può e si deve." class="next-head"/><meta property="og:url" content="https://www.ingloriouscoderz.it/blog/resistere-alla-tentazione-del-procedurale-in-redux" class="next-head"/><meta property="og:title" content="Resistere alla tentazione del procedurale in Redux | Inglorious Coderz" class="next-head"/><meta property="og:description" content="Non è facile disimparare, ma si può e si deve." class="next-head"/><link rel="canonical" href="https://www.ingloriouscoderz.it/blog/resistere-alla-tentazione-del-procedurale-in-redux" class="next-head"/><link rel="preload" href="/_next/static/YSv1CL~PH91TiYR88ZznB/pages/post.js" as="script"/><link rel="preload" href="/_next/static/YSv1CL~PH91TiYR88ZznB/pages/_app.js" as="script"/><link rel="preload" href="/_next/static/YSv1CL~PH91TiYR88ZznB/pages/_error.js" as="script"/><link rel="preload" href="/_next/static/runtime/webpack-ee26f9a1faa4b683cb3b.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.dc7beb26727ddc746607.js" as="script"/><link rel="preload" href="/_next/static/chunks/styles.303c31ef574394add10b.js" as="script"/><link rel="preload" href="/_next/static/runtime/main-a06af596bb1ebd76eb1e.js" as="script"/><link rel="stylesheet" href="/_next/static/css/styles.3f2e4ddc.chunk.css"/><style id="__jsx-2096718123">.button.jsx-2096718123{-webkit-flex:1;-ms-flex:1;flex:1;background-color:rgba(40,44,52,0.5);margin:0.25rem;border:1px solid #429aef;padding:0.25rem 0.5rem;text-transform:uppercase;line-height:1;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}
div.jsx-2096718123{height:100%;}</style><style id="__jsx-2522996044">.toolbar.jsx-2522996044{padding:0.5rem 0;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;}
.toolbar.jsx-2522996044>div.jsx-2522996044{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}</style><style id="__jsx-3278221705">.logo.jsx-3278221705{width:64px;-webkit-perspective:64px;-moz-perspective:64px;-ms-perspective:64px;perspective:64px;margin:0 auto;}
.cube.jsx-3278221705{height:64px;-webkit-transform-style:preserve-3d;-ms-transform-style:preserve-3d;transform-style:preserve-3d;-webkit-transform:scaleY(1.2) translateZ(-64px) rotateX(-0.6981317007977318rad) rotateY(-0.7853981633974483rad);-ms-transform:scaleY(1.2) translateZ(-64px) rotateX(-0.6981317007977318rad) rotateY(-0.7853981633974483rad);transform:scaleY(1.2) translateZ(-64px) rotateX(-0.6981317007977318rad) rotateY(-0.7853981633974483rad);-webkit-transition:ease-out 0.2s;transition:ease-out 0.2s;}
.cube__face.jsx-3278221705{position:absolute;width:100%;height:100%;-webkit-transform-origin:bottom center;-ms-transform-origin:bottom center;transform-origin:bottom center;}
.cube__face.jsx-3278221705>img.jsx-3278221705{position:absolute;}
.cube__face--left.jsx-3278221705{-webkit-transform:rotateY(0deg) translateZ(32px) skew(12deg);-ms-transform:rotateY(0deg) translateZ(32px) skew(12deg);transform:rotateY(0deg) translateZ(32px) skew(12deg);}
.cube__face--right.jsx-3278221705{-webkit-transform:rotateY(90deg) translateZ(32px) skew(-12deg);-ms-transform:rotateY(90deg) translateZ(32px) skew(-12deg);transform:rotateY(90deg) translateZ(32px) skew(-12deg);}
.cube__face--right.jsx-3278221705>.eye.jsx-3278221705{-webkit-transform:rotateY(180deg);-ms-transform:rotateY(180deg);transform:rotateY(180deg);}
.cube__face--left.jsx-3278221705>img.jsx-3278221705:first-of-type{;}
.cube__face--right.jsx-3278221705>img.jsx-3278221705:first-of-type{;}</style><style id="__jsx-2692775195">header.jsx-2692775195{background:black;background-image:url(/_next/static/images/metal-wallpaper-3332ea3aa68955eb3406abac6a06f036.jpg);background-position-x:center;background-attachment:fixed;margin-bottom:1rem;position:-webkit-sticky;position:sticky;top:0;z-index:1000;}
header.jsx-2692775195>h1.jsx-2692775195{font-size:2rem;}
@media (max-width:575.98px){header.jsx-2692775195>h1.jsx-2692775195{font-size:1rem;}}
header.jsx-2692775195>h1.jsx-2692775195 .title.jsx-2692775195{font-family:'Ethnocentric';color:#666;display:grid;justify-items:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;grid-template-columns:4fr 1fr 4fr;}
.shade.jsx-2692775195{position:relative;margin:-1.5rem 0 0;padding:0;display:block;background:#111;width:100%;height:1.5rem;opacity:0.25;text-align:center;}
@media (max-width:575.98px){.shade.jsx-2692775195{margin:-0.75rem 0 0;height:1rem;}}
header.jsx-2692775195>p.jsx-2692775195{text-align:center;margin:0.5rem;}
nav.jsx-2692775195{text-align:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}</style><style id="__jsx-2421455553">article.jsx-2421455553>time.jsx-2421455553{display:block;margin-top:-0.5rem;margin-bottom:1rem;color:#9a9a9a;}</style><style id="__jsx-453059934">footer.jsx-453059934{background:black;font-size:small;text-align:center;padding:1rem;}
footer.jsx-453059934 img.jsx-453059934{display:inline-block;margin:0;border-radius:0;vertical-align:middle;}</style><style id="__jsx-417973436">@font-face{font-family:'Ethnocentric';font-display:auto;font-style:normal;font-weight:400;src:url('/static/fonts/ethnocentric_rg.ttf') format('truetype');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6, U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193, U+2212,U+2215,U+FEFF,U+FFFD;}
@font-face{font-family:'Orbitron';font-display:auto;font-style:normal;font-weight:400;src:url('/static/fonts/orbitron.woff2') format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6, U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193, U+2212,U+2215,U+FEFF,U+FFFD;}
@font-face{font-family:'Roboto';font-display:auto;font-style:normal;font-weight:400;src:url('/static/fonts/roboto.woff2') format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6, U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193, U+2212,U+2215,U+FEFF,U+FFFD;}
@font-face{font-family:'Fira Code';font-display:auto;font-style:normal;font-weight:400;src:url('/static/fonts/firacode.woff2') format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6, U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193, U+2212,U+2215,U+FEFF,U+FFFD;}
:focus{outline:none;}
::-moz-focus-inner{border:0;}
html,body,#__next{height:100%;margin:0;}
html{font-family:'Roboto','Ubuntu',sans-serif;font-size:16px;line-height:1.5;color:#bbb;}
body,.layout{background:black;background-image:url(/_next/static/images/metal-wallpaper-3332ea3aa68955eb3406abac6a06f036.jpg);background-position-x:center;background-attachment:fixed;}
 a{color:#429aef;-webkit-text-decoration:none;text-decoration:none;}
a:hover{-webkit-filter:brightness(125%);filter:brightness(125%);}
h1,h2,h3{font-family:'Orbitron';font-weight:normal;color:#98c379;}
h1{font-size:1.5rem;}
h2{font-size:1.2rem;}
p{margin-top:0;}
p:last-child{margin-bottom:0;}
img{display:block;vertical-align:middle;max-width:100%;margin:0 auto;}
input[type='checkbox']{vertical-align:middle;}
pre,code{font-family:'Fira Code';}
pre{white-space:pre-wrap;word-break:break-all;word-wrap:break-word;}
code{font-size:14px;color:#abb2bf;background:#282c34;}
blockquote{margin:0;margin-bottom:1rem;padding:0 1rem;border-left:0.25rem solid #bbb;}
blockquote>p:before{content:'“';font-size:2rem;line-height:0.1rem;margin-right:0.5rem;vertical-align:-0.5rem;}
blockquote>p:last-of-type:after{content:'”';font-size:2rem;line-height:0.1rem;margin-right:0.5rem;vertical-align:-0.5rem;}
.text-right{text-align:right;}
.card{margin-bottom:1rem;padding:1rem;background-color:rgba(40,44,52,0.5);}
.card-1{box-shadow:0 1px 3px rgba(0,0,0,0.12),0 1px 2px rgba(0,0,0,0.24);-webkit-transition:all 0.3s cubic-bezier(0.25,0.8,0.25,1);transition:all 0.3s cubic-bezier(0.25,0.8,0.25,1);}
.card-1:hover{box-shadow:0 14px 28px rgba(0,0,0,0.25), 0 10px 10px rgba(0,0,0,0.22);}
.container-fluid{padding-left:1rem;padding-right:1rem;}
.row>*{height:100%;}
.svg-inline--fa.fa-w-16{width:1em;}
.svg-inline--fa.fa-w-14{width:0.875em;}
.svg-inline--fa{display:inline-block;font-size:inherit;height:1em;overflow:visible;vertical-align:-0.125em;}
.mapboxgl-map{position:relative;}
.mapboxgl-marker{position:absolute;}</style><style id="__jsx-1352889155">.layout.jsx-1352889155{max-width:1024px;margin:0 auto;height:100%;display:grid;grid-template-rows:auto auto 1fr auto;}
main.jsx-1352889155{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-flow:column;-ms-flex-flow:column;flex-flow:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}</style><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0"/><link rel="apple-touch-icon" sizes="180x180" href="/static/icons/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/static/icons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/static/icons/favicon-16x16.png"/><link rel="manifest" href="/static/site.webmanifest"/><link rel="mask-icon" href="/static/icons/safari-pinned-tab.svg" color="#000000"/><meta name="msapplication-TileColor" content="#000000"/><meta name="theme-color" content="#000000"/><meta name="google-site-verification" content="RFVNvxmtxJpN5XtPqm_lrA2jrphy-Sn_fy3XyekO-2E"/><meta property="fb:app_id" content="1677017469210661"/><script src="/static/scripts/gh-spa-redirect.js"></script></head><body><div id="__next"><div class="jsx-1352889155 jsx-417973436 layout container-fluid"><div class="jsx-2522996044 toolbar"><div class="jsx-2522996044"><a href="https://www.facebook.com/IngloriousCoderz/" target="_blank" rel="noopener noreferrer" aria-label="Facebook" class="jsx-2096718123 button"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="facebook" class="svg-inline--fa fa-facebook fa-w-16 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M504 256C504 119 393 8 256 8S8 119 8 256c0 123.78 90.69 226.38 209.25 245V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14 0 55.52 4.84 55.52 4.84v61h-31.28c-30.8 0-40.41 19.12-40.41 38.73V256h68.78l-11 71.69h-57.78V501C413.31 482.38 504 379.78 504 256z"></path></svg></a><a href="https://www.instagram.com/ingloriouscoderz/" target="_blank" rel="noopener noreferrer" aria-label="Instagram" class="jsx-2096718123 button"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="instagram" class="svg-inline--fa fa-instagram fa-w-14 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M224.1 141c-63.6 0-114.9 51.3-114.9 114.9s51.3 114.9 114.9 114.9S339 319.5 339 255.9 287.7 141 224.1 141zm0 189.6c-41.1 0-74.7-33.5-74.7-74.7s33.5-74.7 74.7-74.7 74.7 33.5 74.7 74.7-33.6 74.7-74.7 74.7zm146.4-194.3c0 14.9-12 26.8-26.8 26.8-14.9 0-26.8-12-26.8-26.8s12-26.8 26.8-26.8 26.8 12 26.8 26.8zm76.1 27.2c-1.7-35.9-9.9-67.7-36.2-93.9-26.2-26.2-58-34.4-93.9-36.2-37-2.1-147.9-2.1-184.9 0-35.8 1.7-67.6 9.9-93.9 36.1s-34.4 58-36.2 93.9c-2.1 37-2.1 147.9 0 184.9 1.7 35.9 9.9 67.7 36.2 93.9s58 34.4 93.9 36.2c37 2.1 147.9 2.1 184.9 0 35.9-1.7 67.7-9.9 93.9-36.2 26.2-26.2 34.4-58 36.2-93.9 2.1-37 2.1-147.8 0-184.8zM398.8 388c-7.8 19.6-22.9 34.7-42.6 42.6-29.5 11.7-99.5 9-132.1 9s-102.7 2.6-132.1-9c-19.6-7.8-34.7-22.9-42.6-42.6-11.7-29.5-9-99.5-9-132.1s-2.6-102.7 9-132.1c7.8-19.6 22.9-34.7 42.6-42.6 29.5-11.7 99.5-9 132.1-9s102.7-2.6 132.1 9c19.6 7.8 34.7 22.9 42.6 42.6 11.7 29.5 9 99.5 9 132.1s2.7 102.7-9 132.1z"></path></svg></a><a href="https://github.com/IngloriousCoderz/" target="_blank" rel="noopener noreferrer" aria-label="Github" class="jsx-2096718123 button"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="github" class="svg-inline--fa fa-github fa-w-16 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg></a><a href="https://www.linkedin.com/company/inglorious-coderz/" target="_blank" rel="noopener noreferrer" aria-label="LinkedIn" class="jsx-2096718123 button"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="linkedin" class="svg-inline--fa fa-linkedin fa-w-14 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"></path></svg></a><a href="mailto:antony.mistretta@gmail.com" target="_blank" rel="noopener noreferrer" aria-label="Email" class="jsx-2096718123 button"><svg aria-hidden="true" focusable="false" data-prefix="far" data-icon="envelope" class="svg-inline--fa fa-envelope fa-w-16 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M464 64H48C21.49 64 0 85.49 0 112v288c0 26.51 21.49 48 48 48h416c26.51 0 48-21.49 48-48V112c0-26.51-21.49-48-48-48zm0 48v40.805c-22.422 18.259-58.168 46.651-134.587 106.49-16.841 13.247-50.201 45.072-73.413 44.701-23.208.375-56.579-31.459-73.413-44.701C106.18 199.465 70.425 171.067 48 152.805V112h416zM48 400V214.398c22.914 18.251 55.409 43.862 104.938 82.646 21.857 17.205 60.134 55.186 103.062 54.955 42.717.231 80.509-37.199 103.053-54.947 49.528-38.783 82.032-64.401 104.947-82.653V400H48z"></path></svg></a><a href="tel:+393202357664" target="_blank" rel="noopener noreferrer" aria-label="WhatsApp" class="jsx-2096718123 button"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="whatsapp" class="svg-inline--fa fa-whatsapp fa-w-14 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M380.9 97.1C339 55.1 283.2 32 223.9 32c-122.4 0-222 99.6-222 222 0 39.1 10.2 77.3 29.6 111L0 480l117.7-30.9c32.4 17.7 68.9 27 106.1 27h.1c122.3 0 224.1-99.6 224.1-222 0-59.3-25.2-115-67.1-157zm-157 341.6c-33.2 0-65.7-8.9-94-25.7l-6.7-4-69.8 18.3L72 359.2l-4.4-7c-18.5-29.4-28.2-63.3-28.2-98.2 0-101.7 82.8-184.5 184.6-184.5 49.3 0 95.6 19.2 130.4 54.1 34.8 34.9 56.2 81.2 56.1 130.5 0 101.8-84.9 184.6-186.6 184.6zm101.2-138.2c-5.5-2.8-32.8-16.2-37.9-18-5.1-1.9-8.8-2.8-12.5 2.8-3.7 5.6-14.3 18-17.6 21.8-3.2 3.7-6.5 4.2-12 1.4-32.6-16.3-54-29.1-75.5-66-5.7-9.8 5.7-9.1 16.3-30.3 1.8-3.7.9-6.9-.5-9.7-1.4-2.8-12.5-30.1-17.1-41.2-4.5-10.8-9.1-9.3-12.5-9.5-3.2-.2-6.9-.2-10.6-.2-3.7 0-9.7 1.4-14.8 6.9-5.1 5.6-19.4 19-19.4 46.3 0 27.3 19.9 53.7 22.6 57.4 2.8 3.7 39.1 59.7 94.8 83.8 35.2 15.2 49 16.5 66.6 13.9 10.7-1.6 32.8-13.4 37.4-26.4 4.6-13 4.6-24.1 3.2-26.4-1.3-2.5-5-3.9-10.5-6.6z"></path></svg></a></div><div class="jsx-2522996044"><a class="jsx-2096718123 button" href="/privacy-policy/">Privacy</a></div></div><header class="jsx-2692775195"><h1 class="jsx-2692775195"><a href="/"><div class="jsx-2692775195 title"><div class="jsx-2692775195"><span class="jsx-2692775195">Inglorious</span><span class="jsx-2692775195 shade"> </span></div><div class="jsx-3278221705 logo"><div class="jsx-3278221705 cube"><div class="jsx-3278221705 cube__face cube__face--left"><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA2IDYiPjxwYXRoIGQ9Ik0wIDBoNkw0IDF2NGwyIDFIMGwyLTFWMXoiIGZpbGw9IiM3ZjdmZmYiIGZpbGwtb3BhY2l0eT0iLjUiIHN0cm9rZT0iIzdmN2ZjMCIgc3Ryb2tlLXdpZHRoPSIuMjUiIHN0cm9rZS1vcGFjaXR5PSIuNSIvPjwvc3ZnPg==" alt="I" class="jsx-3278221705"/><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA2IDYiPjxwYXRoIGQ9Ik0wIDBoMWwxLjUuNzVoMkw0IDFIMnoiIGZpbGw9IiMwMGMwYzAiIGZpbGwtb3BhY2l0eT0iLjUiLz48cGF0aCBkPSJNMSAwaDVMNC41Ljc1aC0yeiIgZmlsbD0iIzBmZiIgZmlsbC1vcGFjaXR5PSIuNSIvPjwvc3ZnPg==" alt="left eye" class="jsx-3278221705 eye"/></div><div class="jsx-3278221705 cube__face cube__face--right"><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA2IDYiPjxwYXRoIGQ9Ik0wIDBoNnYyTDQgMUgydjRoMmwyLTF2MkgweiIgZmlsbD0iIzdmN2ZmZiIgZmlsbC1vcGFjaXR5PSIuNSIgc3Ryb2tlPSIjN2Y3ZmMwIiBzdHJva2Utd2lkdGg9Ii4yNSIgc3Ryb2tlLW9wYWNpdHk9Ii41Ii8+PC9zdmc+" alt="C" class="jsx-3278221705"/></div></div></div><div class="jsx-2692775195"><span class="jsx-2692775195">Coderz</span><span class="jsx-2692775195 shade"> </span></div></div></a></h1><nav class="jsx-2692775195"><a class="jsx-2096718123 button" href="/why/">Why</a><a class="jsx-2096718123 button" href="/who/">Who</a><a class="jsx-2096718123 button" href="/what/">What</a><a class="jsx-2096718123 button" href="/how/">How</a><a class="jsx-2096718123 button" href="/when/">When</a><a class="jsx-2096718123 button" href="/where/">Where</a><a class="jsx-2096718123 button" href="/how-much/">How Much</a><a class="jsx-2096718123 button" href="/icy/">Icy</a><a class="jsx-2096718123 button" href="/blog/">Blog</a></nav></header><main class="jsx-1352889155 jsx-417973436"><article class="jsx-2421455553 card card-1"><h1 class="jsx-2421455553">Resistere alla tentazione del procedurale in Redux</h1><time dateTime="2016-07-21T00:00:00.000Z" class="jsx-2421455553">7/21/2016</time><div><p>Proveniendo da un contesto procedurale e orientato agli oggetti, un approccio
funzionale e dichiarativo come quello di <a href="http://redux.js.org/" target="_blank" rel="noopener noreferrer">redux</a> richiede un salto mentale non indifferente. Realizzare applicazioni è molto semplice, almeno finché non si devono gestire un&#x27;infinità di effetti collaterali e chiamate asincrone che si innescano a catena. È lì che l&#x27;approccio più intrigante risulta quello procedurale. Tuttavia dobbiamo essere coraggiosi e cercare l&#x27;approccio più semplice ed elegante, non quello più comodo.</p>
<p>Esempio pratico: <em>Master-Detail</em>.</p>
<p>Supponiamo di avere dei componenti griglia che sanno mostrare dati recuperati da remoto con una query. Questa query è dinamica, può cambiare a seconda di variabili che le arrivano dall&#x27;esterno.</p>
<p>Supponiamo ora di dover mostrare una prima griglia che non dipende da alcuna variabile. Questa griglia deve poi auto-selezionarsi la prima riga, e questo comporta il caricamento di una seconda griglia i cui dati dipendono dalla riga selezionata (dalle variabili da essa prodotte, per la precisione). Il procedimento può andare avanti con un&#x27;ulteriore selezione automatica della prima riga nella seconda griglia e conseguente caricamento di una terza, e così via. La selezione di una riga può ovviamente essere effettuata anche da parte dell&#x27;utente, che innescherà un nuovo effetto a catena sulla griglia corrente e su tutte quelle dipendenti.</p>
<p>La prima soluzione che sono riuscito a ottenere è trasferendo tutto il potere alle saghe di <a href="http://yelouafi.github.io/redux-saga/" target="_blank" rel="noopener noreferrer">redux-saga</a> (ma i thunk di <a href="https://github.com/gaearon/redux-thunk" target="_blank" rel="noopener noreferrer">redux-thunk</a> avrebbero sortito lo stesso effetto).</p>
<p>Appena lo store è creato possiamo dispatchare una action di inizializzazione per la prima griglia, quella che non dipende da nessuna variabile:</p>
<pre><code class="language-js">store.dispatch(initGrid(&#x27;FirstGrid&#x27;))
</code></pre>
<p>La saga che accoglierà la action di inizializzazione sarà pressappoco questa:</p>
<pre><code class="language-js">function* initGrid(action) {
  const {
    payload: { id, variables },
  } = action
  const query = computeNewQuery(id, variables)

  try {
    const data = yield call(fetchData, id, query)
    yield put(receiveData(id, data))
    yield put(selectRow(id, 0))
  } catch ({ message }) {
    yield put(receiveError(id, message))
  }
}
</code></pre>
<p>La nuova query viene calcolata al volo (ho omesso i dettagli per chiarezza) e viene usata per recuperare i nuovi dati da passare alla griglia chiamando direttamente un&#x27;altra saga chiamata <code>fetchData</code>. Una volta ottenuti i dati viene aggiornata la griglia corrente e viene selezionata la prima riga, e la selezione è il dispatch di una action a un&#x27;altra saga:</p>
<pre><code class="language-js">function* selectRow(action) {
  const {
    payload: { id, selectedRow },
  } = action
  const newVars = computeNewVariables(id, selectedRow)

  yield put(updateSelectedRow(id, selectedRow))
  yield grids.map(grid =&gt; {
    if (grid.dependsOn(updatedVariables)) {
      return fork(initGrid, {
        payload: { id, variables: newVars },
      })
    }
  })
}
</code></pre>
<p>Questo approccio funziona, e pare anche abbastanza pulito. Le saghe in questa implementazione possono essere viste come degli agenti esterni (forse qualcosa di simile agli <a href="http://jamesknelson.com/join-the-dark-side-of-the-flux-responding-to-actions-with-actors/" target="_blank" rel="noopener noreferrer">attori</a>?) oppure, in modo più pittoresco, come aerei che volano a bassa quota sull&#x27;applicazione sganciando action per aggiornare lo store.</p>
<p>Ci sono però alcuni code smell più o meno evidenti:</p>
<ol>
<li>I riduttori non hanno logica, vengono interpellati solo per popolarsi con dati recuperati o calcolati dalle saghe</li>
<li>Nelle saghe invece è nascosta tanta, tanta logica procedurale, compresa la scelta di quali griglie devono essere aggiornate o addirittura quale griglia inizializzare per prima, e scriverci sopra degli unit test non è così banale (sicuramente più semplice che farlo con i thunk, per cui se la strada scelta è questa almeno scegliete il male minore)</li>
<li>C&#x27;è una dipendenza ciclica fra le due saghe, perché quando inizializzo una griglia devo selezionare la prima riga e quando seleziono la prima riga devo inizializzare le griglie dipendenti</li>
<li>Nella saga di <code>selectRow</code> viene chiamata la saga <code>initGrid</code> sfruttando una finta action: questo perché le saghe per contratto devono accettare una action se vogliono essere usate in un <a href="http://yelouafi.github.io/redux-saga/docs/advanced/Concurrency.html" target="_blank" rel="noopener noreferrer">takeEvery</a></li>
</ol>
<p>Il tutto nasce dal presupposto che le griglie debbano essere piuttosto stupide, e sappiano visualizzare i dati recuperati altrove (dalle saghe) piuttosto che effettuare loro stesse le query. Ma riguardando più volte al microscopio i <a href="https://egghead.io/courses/getting-started-with-redux" target="_blank" rel="noopener noreferrer">video tutorial</a> di Dan Abramov, in particolare il <a href="https://egghead.io/courses/building-react-applications-with-idiomatic-redux" target="_blank" rel="noopener noreferrer">secondo</a>, nonché le discussioni su Github relative a <a href="https://github.com/reactjs/redux/issues/1171" target="_blank" rel="noopener noreferrer">come strutturare un&#x27;applicazione Redux</a> e a <a href="https://github.com/reactjs/redux/issues/749" target="_blank" rel="noopener noreferrer">come modificare lo stato di riduttori interdipendenti</a>, mi sono convinto che un&#x27;altra soluzione sia possibile, e anche più efficace.</p>
<p>La soluzione in parole povere è la seguente:</p>
<p>La query calcolata è parte integrante dello stato delle griglie (ma forse potrebbe anche essere implementata come un <a href="https://github.com/reactjs/reselect" target="_blank" rel="noopener noreferrer">selettore memoizzato</a>):</p>
<pre><code class="language-js">function query = (state, action) =&gt; {
  const { type, payload } = action

  switch (type) {
    case UPDATE_LIVE_QUERY:
      return computeNewQuery(payload)
    default:
      return state
  }
}
</code></pre>
<p>Le griglie, esattamente come nei video tutorial, sono suddivise in <a href="https://medium.com/@dan_abramov/smart-and-dumb-components-7ca2f9a7c7d0#.jqqae1xb5" target="_blank" rel="noopener noreferrer">componenti presentazionali e componenti contenitori</a>, e i contenitori sono in grado di chiamare la saga <code>fetchData</code> per conto loro nei metodi <code>componentDidMount</code> e <code>componentDidUpdate</code>:</p>
<pre><code class="language-js">class GridContainer extends Component {
  fetchData() {
    const { id, canFetchData, requestData } = this.props

    if (canFetchData) {
      requestData(id)
    }
  }

  componentDidMount() {
    this.fetchData()
  }

  componentDidUpdate(prevProps) {
    if (this.props.liveQuery !== prevProps.liveQuery) {
      this.fetchData()
    }
  }

  render() {
    const { id, canFetchData, requestData, ...rest } = this.props
    return &lt;Grid id={id} {...rest} /&gt;
  }
}

connect(
  mapStateToProps,
  { requestData, selectRow },
)(GridContainer)
</code></pre>
<p>Come si può notare, nel metodo <code>componentDidUpdate</code> la chiamata a <code>fetchData</code> deve essere fatta solo se la query è cambiata rispetto a prima. Questo significa che bisogna prestare particolare attenzione nel riduttore a non fornire una copia della query ma la query stessa se il dispatch di una action non l&#x27;ha cambiata. A questo scopo potrebbe essere molto utile una libreria come <a href="https://facebook.github.io/immutable-js/" target="_blank" rel="noopener noreferrer">Immutable</a>.</p>
<p>Inoltre nel metodo <code>fetchData</code> viene passata una proprietà chiamata <code>canFetchData</code>: questa non è altro che un selettore che verifica che la query corrente abbia tutte le informazioni necessarie per essere eseguita (cioè non dipenda da alcuna variabile o le variabili da cui dipende ci siano tutte). Questo approccio, che mi piace chiamare <em>ragionare a compartimenti stagni</em>, è semplicemente la base di una programmazione modulare.</p>
<p>Il pezzo difficile è nel <code>rootReducer</code>: quando viene selezionata una riga, questo deve calcolare le nuove variabili, aggiornarle nella porzione di stato dedicata, e poi usare le variabili per aggiornare la query alle griglie (<em>TUTTE</em> le variabili e <em>TUTTE</em> le griglie, è questo che lo rende più dichiarativo e fail-safe). Perché implementare questa logica proprio nella root? Perché è l&#x27;<a href="https://en.wikipedia.org/wiki/GRASP_(object-oriented_design#Information_expert)" target="_blank" rel="noopener noreferrer">Information Expert</a> della situazione:</p>
<pre><code class="language-js">const rootReducer = (state, action) =&gt; {
  const { type, payload } = action
  switch (type) {
    case &#x27;@@INIT&#x27;:
      return {
        ...state,
        viewers: viewers(state.grids, computeNewQuery(state.variables)),
      }
    case SELECT_ROW:
      const newVars = computeNewVariables(payload.id, payload.row)
      let newState = {
        ...state,
        grids: grids(state.grids, action),
        variables: variables(state.variables, updateVariables(newVars)),
      }
      return {
        ...newState,
        grids: grids(newState.grids, updateQuery(newState.variables)),
      }
    default:
      return state
  }
}
</code></pre>
<p>Alcune cose da notare qui:</p>
<ol>
<li>Stiamo usando la action di inizializzazione di Redux per cominciare a &quot;svegliare&quot; le griglie; forse non è molto ortodosso, avremmo potuto dispatchare una nostra action come fatto per le saghe</li>
<li>La selezione della riga consiste nella chiamata consecutiva ai reducer sottostanti. Questo è l&#x27;unico aspetto un po&#x27; procedurale, perché non possiamo fare tutto in un colpo solo ma dobbiamo aspettare prima che lo stato abbia tutte le variabili in posizione per poterle usare sulle griglie</li>
<li>I riduttori vengono chiamati con delle sotto-action dedicate, <code>updateVariables</code> e <code>updateQuery</code>, che non compariranno mai nel log di <a href="https://github.com/gaearon/redux-devtools" target="_blank" rel="noopener noreferrer">Redux-DevTools</a>. Quello che prima mi sembrava una bestemmia ora mi sembra la cosa più naturale del mondo dato che in fondo è la stessa cosa che scriverei se dovessi chiamare una <a href="https://it.wikipedia.org/wiki/Fa%C3%A7ade_pattern" target="_blank" rel="noopener noreferrer">façade</a> che chiama a sua volta dei sotto-componenti. L&#x27;unica cosa da non fare assolutamente è rendere due reducer interdipendenti, ma un reducer padre può e deve manipolare lo stato dei reducer figli.</li>
</ol>
<p>A questo punto possiamo completamente fare a meno della saga <code>initGrid</code>: l&#x27;inizializzazione parte dalle stesse griglie, che si aggiorneranno automaticamente nel momento in cui la query dovesse cambiare. Abbiamo spostato la logica degli effetti collaterali dentro un componente React e la logica applicativa dentro ai riduttori. Il middleware delle saghe deve solo rimanere in ascolto di richieste di <code>fetchData</code>.</p>
<p>Per dubbi, domande, obiezioni o sdegno non esitate a contattarmi. Un giorno magari implementerò anche un meccanismo di commenti, nel frattempo insultatemi in privato :)</p>
<pre><code># IceOnFire
</code></pre></div></article></main><footer class="jsx-453059934"><a href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" rel="noopener noreferrer"><img alt="Licenza Creative Commons" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAAAPCAMAAABEF7i9AAAAllBMVEUAAAANDQwNDQ0NDg0ODg4PEA8REREZGRkgICAhISEiIiIkJSMnKCcuMC4xMzEzMzM5Ozk7PTtBQkFCQkJDQ0NERERLTEtVVVVbXltmZmZna2dydnF3d3d9gn2AgICGhoaHh4eIiIiPkI+UmZOZmZmqqqqrsaqzuLK6v7q7u7vFxsXGysbIzMjKzsrMzMzd3d3u7u7///+uXr4hAAAA2klEQVQ4y62T6RKCMAyEIyIq3kc961GBeCN5/5eTalupozOONMMfluVjk1AA50VOSwJR1gKEkpgfIV5rf6bTwMgX5iOsjXhYlwQOmq/UKcwQL5NywKqgNASWMQhTYt28552arzIV/FK2AE+bBVzBkcIpcR5kcUK8mvd8Us8fl/Hru2+CBi4hzeRWpj3ZM/cR92eTUNn0uxpvC/QxIZsHGY+Je3ZCKHZIdsI3wczQE5QEMM9n2LvRuGPN0Ab+NkPsNxxvOapsDXDUcvAf5mvZKN6wXvakuD7LjusO1DVRlsjT/rIAAAAASUVORK5CYII=" class="jsx-453059934"/></a> INGLORIOUS CODERZ DI MISTRETTA MATTEO ANTONY | 39 Via Val Della Torre, 10149 Torino (TO) | VAT Code IT11524720015 | Tax Code MSTMTN82R17H501A</footer></div></div><script>__NEXT_DATA__ = {"props":{"pageProps":{"post":{"data":{"title":"Resistere alla tentazione del procedurale in Redux","description":"Non è facile disimparare, ma si può e si deve.","author":"IceOnFire","_entry":"posts/blog/2016-07-21-resistere-alla-tentazione-del-procedurale-in-redux.md","page":"post","name":"resistere-alla-tentazione-del-procedurale-in-redux","category":"blog","date":"2016-07-21T00:00:00.000Z","url":"/blog/resistere-alla-tentazione-del-procedurale-in-redux"},"content":{"type":"root","children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Proveniendo da un contesto procedurale e orientato agli oggetti, un approccio\nfunzionale e dichiarativo come quello di "},{"type":"element","tagName":"a","properties":{"href":"http://redux.js.org/"},"children":[{"type":"text","value":"redux"}]},{"type":"text","value":" richiede un salto mentale non indifferente. Realizzare applicazioni è molto semplice, almeno finché non si devono gestire un'infinità di effetti collaterali e chiamate asincrone che si innescano a catena. È lì che l'approccio più intrigante risulta quello procedurale. Tuttavia dobbiamo essere coraggiosi e cercare l'approccio più semplice ed elegante, non quello più comodo."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Esempio pratico: "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"Master-Detail"}]},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Supponiamo di avere dei componenti griglia che sanno mostrare dati recuperati da remoto con una query. Questa query è dinamica, può cambiare a seconda di variabili che le arrivano dall'esterno."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Supponiamo ora di dover mostrare una prima griglia che non dipende da alcuna variabile. Questa griglia deve poi auto-selezionarsi la prima riga, e questo comporta il caricamento di una seconda griglia i cui dati dipendono dalla riga selezionata (dalle variabili da essa prodotte, per la precisione). Il procedimento può andare avanti con un'ulteriore selezione automatica della prima riga nella seconda griglia e conseguente caricamento di una terza, e così via. La selezione di una riga può ovviamente essere effettuata anche da parte dell'utente, che innescherà un nuovo effetto a catena sulla griglia corrente e su tutte quelle dipendenti."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"La prima soluzione che sono riuscito a ottenere è trasferendo tutto il potere alle saghe di "},{"type":"element","tagName":"a","properties":{"href":"http://yelouafi.github.io/redux-saga/"},"children":[{"type":"text","value":"redux-saga"}]},{"type":"text","value":" (ma i thunk di "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/gaearon/redux-thunk"},"children":[{"type":"text","value":"redux-thunk"}]},{"type":"text","value":" avrebbero sortito lo stesso effetto)."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Appena lo store è creato possiamo dispatchare una action di inizializzazione per la prima griglia, quella che non dipende da nessuna variabile:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-js"]},"children":[{"type":"text","value":"store.dispatch(initGrid('FirstGrid'))\n"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"La saga che accoglierà la action di inizializzazione sarà pressappoco questa:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-js"]},"children":[{"type":"text","value":"function* initGrid(action) {\n  const {\n    payload: { id, variables },\n  } = action\n  const query = computeNewQuery(id, variables)\n\n  try {\n    const data = yield call(fetchData, id, query)\n    yield put(receiveData(id, data))\n    yield put(selectRow(id, 0))\n  } catch ({ message }) {\n    yield put(receiveError(id, message))\n  }\n}\n"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"La nuova query viene calcolata al volo (ho omesso i dettagli per chiarezza) e viene usata per recuperare i nuovi dati da passare alla griglia chiamando direttamente un'altra saga chiamata "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"fetchData"}]},{"type":"text","value":". Una volta ottenuti i dati viene aggiornata la griglia corrente e viene selezionata la prima riga, e la selezione è il dispatch di una action a un'altra saga:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-js"]},"children":[{"type":"text","value":"function* selectRow(action) {\n  const {\n    payload: { id, selectedRow },\n  } = action\n  const newVars = computeNewVariables(id, selectedRow)\n\n  yield put(updateSelectedRow(id, selectedRow))\n  yield grids.map(grid =\u003e {\n    if (grid.dependsOn(updatedVariables)) {\n      return fork(initGrid, {\n        payload: { id, variables: newVars },\n      })\n    }\n  })\n}\n"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Questo approccio funziona, e pare anche abbastanza pulito. Le saghe in questa implementazione possono essere viste come degli agenti esterni (forse qualcosa di simile agli "},{"type":"element","tagName":"a","properties":{"href":"http://jamesknelson.com/join-the-dark-side-of-the-flux-responding-to-actions-with-actors/"},"children":[{"type":"text","value":"attori"}]},{"type":"text","value":"?) oppure, in modo più pittoresco, come aerei che volano a bassa quota sull'applicazione sganciando action per aggiornare lo store."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Ci sono però alcuni code smell più o meno evidenti:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"I riduttori non hanno logica, vengono interpellati solo per popolarsi con dati recuperati o calcolati dalle saghe"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Nelle saghe invece è nascosta tanta, tanta logica procedurale, compresa la scelta di quali griglie devono essere aggiornate o addirittura quale griglia inizializzare per prima, e scriverci sopra degli unit test non è così banale (sicuramente più semplice che farlo con i thunk, per cui se la strada scelta è questa almeno scegliete il male minore)"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"C'è una dipendenza ciclica fra le due saghe, perché quando inizializzo una griglia devo selezionare la prima riga e quando seleziono la prima riga devo inizializzare le griglie dipendenti"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Nella saga di "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"selectRow"}]},{"type":"text","value":" viene chiamata la saga "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"initGrid"}]},{"type":"text","value":" sfruttando una finta action: questo perché le saghe per contratto devono accettare una action se vogliono essere usate in un "},{"type":"element","tagName":"a","properties":{"href":"http://yelouafi.github.io/redux-saga/docs/advanced/Concurrency.html"},"children":[{"type":"text","value":"takeEvery"}]}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Il tutto nasce dal presupposto che le griglie debbano essere piuttosto stupide, e sappiano visualizzare i dati recuperati altrove (dalle saghe) piuttosto che effettuare loro stesse le query. Ma riguardando più volte al microscopio i "},{"type":"element","tagName":"a","properties":{"href":"https://egghead.io/courses/getting-started-with-redux"},"children":[{"type":"text","value":"video tutorial"}]},{"type":"text","value":" di Dan Abramov, in particolare il "},{"type":"element","tagName":"a","properties":{"href":"https://egghead.io/courses/building-react-applications-with-idiomatic-redux"},"children":[{"type":"text","value":"secondo"}]},{"type":"text","value":", nonché le discussioni su Github relative a "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/reactjs/redux/issues/1171"},"children":[{"type":"text","value":"come strutturare un'applicazione Redux"}]},{"type":"text","value":" e a "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/reactjs/redux/issues/749"},"children":[{"type":"text","value":"come modificare lo stato di riduttori interdipendenti"}]},{"type":"text","value":", mi sono convinto che un'altra soluzione sia possibile, e anche più efficace."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"La soluzione in parole povere è la seguente:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"La query calcolata è parte integrante dello stato delle griglie (ma forse potrebbe anche essere implementata come un "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/reactjs/reselect"},"children":[{"type":"text","value":"selettore memoizzato"}]},{"type":"text","value":"):"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-js"]},"children":[{"type":"text","value":"function query = (state, action) =\u003e {\n  const { type, payload } = action\n\n  switch (type) {\n    case UPDATE_LIVE_QUERY:\n      return computeNewQuery(payload)\n    default:\n      return state\n  }\n}\n"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Le griglie, esattamente come nei video tutorial, sono suddivise in "},{"type":"element","tagName":"a","properties":{"href":"https://medium.com/@dan_abramov/smart-and-dumb-components-7ca2f9a7c7d0#.jqqae1xb5"},"children":[{"type":"text","value":"componenti presentazionali e componenti contenitori"}]},{"type":"text","value":", e i contenitori sono in grado di chiamare la saga "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"fetchData"}]},{"type":"text","value":" per conto loro nei metodi "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"componentDidMount"}]},{"type":"text","value":" e "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"componentDidUpdate"}]},{"type":"text","value":":"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-js"]},"children":[{"type":"text","value":"class GridContainer extends Component {\n  fetchData() {\n    const { id, canFetchData, requestData } = this.props\n\n    if (canFetchData) {\n      requestData(id)\n    }\n  }\n\n  componentDidMount() {\n    this.fetchData()\n  }\n\n  componentDidUpdate(prevProps) {\n    if (this.props.liveQuery !== prevProps.liveQuery) {\n      this.fetchData()\n    }\n  }\n\n  render() {\n    const { id, canFetchData, requestData, ...rest } = this.props\n    return \u003cGrid id={id} {...rest} /\u003e\n  }\n}\n\nconnect(\n  mapStateToProps,\n  { requestData, selectRow },\n)(GridContainer)\n"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Come si può notare, nel metodo "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"componentDidUpdate"}]},{"type":"text","value":" la chiamata a "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"fetchData"}]},{"type":"text","value":" deve essere fatta solo se la query è cambiata rispetto a prima. Questo significa che bisogna prestare particolare attenzione nel riduttore a non fornire una copia della query ma la query stessa se il dispatch di una action non l'ha cambiata. A questo scopo potrebbe essere molto utile una libreria come "},{"type":"element","tagName":"a","properties":{"href":"https://facebook.github.io/immutable-js/"},"children":[{"type":"text","value":"Immutable"}]},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Inoltre nel metodo "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"fetchData"}]},{"type":"text","value":" viene passata una proprietà chiamata "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"canFetchData"}]},{"type":"text","value":": questa non è altro che un selettore che verifica che la query corrente abbia tutte le informazioni necessarie per essere eseguita (cioè non dipenda da alcuna variabile o le variabili da cui dipende ci siano tutte). Questo approccio, che mi piace chiamare "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"ragionare a compartimenti stagni"}]},{"type":"text","value":", è semplicemente la base di una programmazione modulare."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Il pezzo difficile è nel "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"rootReducer"}]},{"type":"text","value":": quando viene selezionata una riga, questo deve calcolare le nuove variabili, aggiornarle nella porzione di stato dedicata, e poi usare le variabili per aggiornare la query alle griglie ("},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"TUTTE"}]},{"type":"text","value":" le variabili e "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"TUTTE"}]},{"type":"text","value":" le griglie, è questo che lo rende più dichiarativo e fail-safe). Perché implementare questa logica proprio nella root? Perché è l'"},{"type":"element","tagName":"a","properties":{"href":"https://en.wikipedia.org/wiki/GRASP_(object-oriented_design#Information_expert)"},"children":[{"type":"text","value":"Information Expert"}]},{"type":"text","value":" della situazione:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-js"]},"children":[{"type":"text","value":"const rootReducer = (state, action) =\u003e {\n  const { type, payload } = action\n  switch (type) {\n    case '@@INIT':\n      return {\n        ...state,\n        viewers: viewers(state.grids, computeNewQuery(state.variables)),\n      }\n    case SELECT_ROW:\n      const newVars = computeNewVariables(payload.id, payload.row)\n      let newState = {\n        ...state,\n        grids: grids(state.grids, action),\n        variables: variables(state.variables, updateVariables(newVars)),\n      }\n      return {\n        ...newState,\n        grids: grids(newState.grids, updateQuery(newState.variables)),\n      }\n    default:\n      return state\n  }\n}\n"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Alcune cose da notare qui:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Stiamo usando la action di inizializzazione di Redux per cominciare a \"svegliare\" le griglie; forse non è molto ortodosso, avremmo potuto dispatchare una nostra action come fatto per le saghe"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"La selezione della riga consiste nella chiamata consecutiva ai reducer sottostanti. Questo è l'unico aspetto un po' procedurale, perché non possiamo fare tutto in un colpo solo ma dobbiamo aspettare prima che lo stato abbia tutte le variabili in posizione per poterle usare sulle griglie"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"I riduttori vengono chiamati con delle sotto-action dedicate, "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"updateVariables"}]},{"type":"text","value":" e "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"updateQuery"}]},{"type":"text","value":", che non compariranno mai nel log di "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/gaearon/redux-devtools"},"children":[{"type":"text","value":"Redux-DevTools"}]},{"type":"text","value":". Quello che prima mi sembrava una bestemmia ora mi sembra la cosa più naturale del mondo dato che in fondo è la stessa cosa che scriverei se dovessi chiamare una "},{"type":"element","tagName":"a","properties":{"href":"https://it.wikipedia.org/wiki/Fa%C3%A7ade_pattern"},"children":[{"type":"text","value":"façade"}]},{"type":"text","value":" che chiama a sua volta dei sotto-componenti. L'unica cosa da non fare assolutamente è rendere due reducer interdipendenti, ma un reducer padre può e deve manipolare lo stato dei reducer figli."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"A questo punto possiamo completamente fare a meno della saga "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"initGrid"}]},{"type":"text","value":": l'inizializzazione parte dalle stesse griglie, che si aggiorneranno automaticamente nel momento in cui la query dovesse cambiare. Abbiamo spostato la logica degli effetti collaterali dentro un componente React e la logica applicativa dentro ai riduttori. Il middleware delle saghe deve solo rimanere in ascolto di richieste di "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"fetchData"}]},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Per dubbi, domande, obiezioni o sdegno non esitate a contattarmi. Un giorno magari implementerò anche un meccanismo di commenti, nel frattempo insultatemi in privato :)"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"# IceOnFire\n"}]}]}],"data":{"quirksMode":false}},"raw":"\nProveniendo da un contesto procedurale e orientato agli oggetti, un approccio\nfunzionale e dichiarativo come quello di [redux](http://redux.js.org/) richiede un salto mentale non indifferente. Realizzare applicazioni è molto semplice, almeno finché non si devono gestire un'infinità di effetti collaterali e chiamate asincrone che si innescano a catena. È lì che l'approccio più intrigante risulta quello procedurale. Tuttavia dobbiamo essere coraggiosi e cercare l'approccio più semplice ed elegante, non quello più comodo.\n\nEsempio pratico: _Master-Detail_.\n\nSupponiamo di avere dei componenti griglia che sanno mostrare dati recuperati da remoto con una query. Questa query è dinamica, può cambiare a seconda di variabili che le arrivano dall'esterno.\n\nSupponiamo ora di dover mostrare una prima griglia che non dipende da alcuna variabile. Questa griglia deve poi auto-selezionarsi la prima riga, e questo comporta il caricamento di una seconda griglia i cui dati dipendono dalla riga selezionata (dalle variabili da essa prodotte, per la precisione). Il procedimento può andare avanti con un'ulteriore selezione automatica della prima riga nella seconda griglia e conseguente caricamento di una terza, e così via. La selezione di una riga può ovviamente essere effettuata anche da parte dell'utente, che innescherà un nuovo effetto a catena sulla griglia corrente e su tutte quelle dipendenti.\n\nLa prima soluzione che sono riuscito a ottenere è trasferendo tutto il potere alle saghe di [redux-saga](http://yelouafi.github.io/redux-saga/) (ma i thunk di [redux-thunk](https://github.com/gaearon/redux-thunk) avrebbero sortito lo stesso effetto).\n\nAppena lo store è creato possiamo dispatchare una action di inizializzazione per la prima griglia, quella che non dipende da nessuna variabile:\n\n```js\nstore.dispatch(initGrid('FirstGrid'))\n```\n\nLa saga che accoglierà la action di inizializzazione sarà pressappoco questa:\n\n```js\nfunction* initGrid(action) {\n  const {\n    payload: { id, variables },\n  } = action\n  const query = computeNewQuery(id, variables)\n\n  try {\n    const data = yield call(fetchData, id, query)\n    yield put(receiveData(id, data))\n    yield put(selectRow(id, 0))\n  } catch ({ message }) {\n    yield put(receiveError(id, message))\n  }\n}\n```\n\nLa nuova query viene calcolata al volo (ho omesso i dettagli per chiarezza) e viene usata per recuperare i nuovi dati da passare alla griglia chiamando direttamente un'altra saga chiamata `fetchData`. Una volta ottenuti i dati viene aggiornata la griglia corrente e viene selezionata la prima riga, e la selezione è il dispatch di una action a un'altra saga:\n\n```js\nfunction* selectRow(action) {\n  const {\n    payload: { id, selectedRow },\n  } = action\n  const newVars = computeNewVariables(id, selectedRow)\n\n  yield put(updateSelectedRow(id, selectedRow))\n  yield grids.map(grid =\u003e {\n    if (grid.dependsOn(updatedVariables)) {\n      return fork(initGrid, {\n        payload: { id, variables: newVars },\n      })\n    }\n  })\n}\n```\n\nQuesto approccio funziona, e pare anche abbastanza pulito. Le saghe in questa implementazione possono essere viste come degli agenti esterni (forse qualcosa di simile agli [attori](http://jamesknelson.com/join-the-dark-side-of-the-flux-responding-to-actions-with-actors/)?) oppure, in modo più pittoresco, come aerei che volano a bassa quota sull'applicazione sganciando action per aggiornare lo store.\n\nCi sono però alcuni code smell più o meno evidenti:\n\n1. I riduttori non hanno logica, vengono interpellati solo per popolarsi con dati recuperati o calcolati dalle saghe\n2. Nelle saghe invece è nascosta tanta, tanta logica procedurale, compresa la scelta di quali griglie devono essere aggiornate o addirittura quale griglia inizializzare per prima, e scriverci sopra degli unit test non è così banale (sicuramente più semplice che farlo con i thunk, per cui se la strada scelta è questa almeno scegliete il male minore)\n3. C'è una dipendenza ciclica fra le due saghe, perché quando inizializzo una griglia devo selezionare la prima riga e quando seleziono la prima riga devo inizializzare le griglie dipendenti\n4. Nella saga di `selectRow` viene chiamata la saga `initGrid` sfruttando una finta action: questo perché le saghe per contratto devono accettare una action se vogliono essere usate in un [takeEvery](http://yelouafi.github.io/redux-saga/docs/advanced/Concurrency.html)\n\nIl tutto nasce dal presupposto che le griglie debbano essere piuttosto stupide, e sappiano visualizzare i dati recuperati altrove (dalle saghe) piuttosto che effettuare loro stesse le query. Ma riguardando più volte al microscopio i [video tutorial](https://egghead.io/courses/getting-started-with-redux) di Dan Abramov, in particolare il [secondo](https://egghead.io/courses/building-react-applications-with-idiomatic-redux), nonché le discussioni su Github relative a [come strutturare un'applicazione Redux](https://github.com/reactjs/redux/issues/1171) e a [come modificare lo stato di riduttori interdipendenti](https://github.com/reactjs/redux/issues/749), mi sono convinto che un'altra soluzione sia possibile, e anche più efficace.\n\nLa soluzione in parole povere è la seguente:\n\nLa query calcolata è parte integrante dello stato delle griglie (ma forse potrebbe anche essere implementata come un [selettore memoizzato](https://github.com/reactjs/reselect)):\n\n```js\nfunction query = (state, action) =\u003e {\n  const { type, payload } = action\n\n  switch (type) {\n    case UPDATE_LIVE_QUERY:\n      return computeNewQuery(payload)\n    default:\n      return state\n  }\n}\n```\n\nLe griglie, esattamente come nei video tutorial, sono suddivise in [componenti presentazionali e componenti contenitori](https://medium.com/@dan_abramov/smart-and-dumb-components-7ca2f9a7c7d0#.jqqae1xb5), e i contenitori sono in grado di chiamare la saga `fetchData` per conto loro nei metodi `componentDidMount` e `componentDidUpdate`:\n\n```js\nclass GridContainer extends Component {\n  fetchData() {\n    const { id, canFetchData, requestData } = this.props\n\n    if (canFetchData) {\n      requestData(id)\n    }\n  }\n\n  componentDidMount() {\n    this.fetchData()\n  }\n\n  componentDidUpdate(prevProps) {\n    if (this.props.liveQuery !== prevProps.liveQuery) {\n      this.fetchData()\n    }\n  }\n\n  render() {\n    const { id, canFetchData, requestData, ...rest } = this.props\n    return \u003cGrid id={id} {...rest} /\u003e\n  }\n}\n\nconnect(\n  mapStateToProps,\n  { requestData, selectRow },\n)(GridContainer)\n```\n\nCome si può notare, nel metodo `componentDidUpdate` la chiamata a `fetchData` deve essere fatta solo se la query è cambiata rispetto a prima. Questo significa che bisogna prestare particolare attenzione nel riduttore a non fornire una copia della query ma la query stessa se il dispatch di una action non l'ha cambiata. A questo scopo potrebbe essere molto utile una libreria come [Immutable](https://facebook.github.io/immutable-js/).\n\nInoltre nel metodo `fetchData` viene passata una proprietà chiamata `canFetchData`: questa non è altro che un selettore che verifica che la query corrente abbia tutte le informazioni necessarie per essere eseguita (cioè non dipenda da alcuna variabile o le variabili da cui dipende ci siano tutte). Questo approccio, che mi piace chiamare _ragionare a compartimenti stagni_, è semplicemente la base di una programmazione modulare.\n\nIl pezzo difficile è nel `rootReducer`: quando viene selezionata una riga, questo deve calcolare le nuove variabili, aggiornarle nella porzione di stato dedicata, e poi usare le variabili per aggiornare la query alle griglie (_TUTTE_ le variabili e _TUTTE_ le griglie, è questo che lo rende più dichiarativo e fail-safe). Perché implementare questa logica proprio nella root? Perché è l'[Information Expert](\u003chttps://en.wikipedia.org/wiki/GRASP_(object-oriented_design#Information_expert)\u003e) della situazione:\n\n```js\nconst rootReducer = (state, action) =\u003e {\n  const { type, payload } = action\n  switch (type) {\n    case '@@INIT':\n      return {\n        ...state,\n        viewers: viewers(state.grids, computeNewQuery(state.variables)),\n      }\n    case SELECT_ROW:\n      const newVars = computeNewVariables(payload.id, payload.row)\n      let newState = {\n        ...state,\n        grids: grids(state.grids, action),\n        variables: variables(state.variables, updateVariables(newVars)),\n      }\n      return {\n        ...newState,\n        grids: grids(newState.grids, updateQuery(newState.variables)),\n      }\n    default:\n      return state\n  }\n}\n```\n\nAlcune cose da notare qui:\n\n1. Stiamo usando la action di inizializzazione di Redux per cominciare a \"svegliare\" le griglie; forse non è molto ortodosso, avremmo potuto dispatchare una nostra action come fatto per le saghe\n2. La selezione della riga consiste nella chiamata consecutiva ai reducer sottostanti. Questo è l'unico aspetto un po' procedurale, perché non possiamo fare tutto in un colpo solo ma dobbiamo aspettare prima che lo stato abbia tutte le variabili in posizione per poterle usare sulle griglie\n3. I riduttori vengono chiamati con delle sotto-action dedicate, `updateVariables` e `updateQuery`, che non compariranno mai nel log di [Redux-DevTools](https://github.com/gaearon/redux-devtools). Quello che prima mi sembrava una bestemmia ora mi sembra la cosa più naturale del mondo dato che in fondo è la stessa cosa che scriverei se dovessi chiamare una [façade](https://it.wikipedia.org/wiki/Fa%C3%A7ade_pattern) che chiama a sua volta dei sotto-componenti. L'unica cosa da non fare assolutamente è rendere due reducer interdipendenti, ma un reducer padre può e deve manipolare lo stato dei reducer figli.\n\nA questo punto possiamo completamente fare a meno della saga `initGrid`: l'inizializzazione parte dalle stesse griglie, che si aggiorneranno automaticamente nel momento in cui la query dovesse cambiare. Abbiamo spostato la logica degli effetti collaterali dentro un componente React e la logica applicativa dentro ai riduttori. Il middleware delle saghe deve solo rimanere in ascolto di richieste di `fetchData`.\n\nPer dubbi, domande, obiezioni o sdegno non esitate a contattarmi. Un giorno magari implementerò anche un meccanismo di commenti, nel frattempo insultatemi in privato :)\n\n    # IceOnFire\n"},"_entries":[{"data":{"title":"Hello world!","description":"La nostra prima impronta sul web.","author":"IceOnFire","_entry":"posts/blog/2016-02-21-hello-world.md","page":"post","name":"hello-world","category":"blog","date":"2016-02-21T00:00:00.000Z","url":"/blog/hello-world"},"content":{"type":"root","children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Ciao mondo! Questo è il nostro primo vagito nel mondo dell'interwebz :)"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-javascript"]},"children":[{"type":"text","value":"function sayHello(who) {\n  console.log('Hello ' + who + '!')\n}\nsayHello('world')\n"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"# IceOnFire\n"}]}]}],"data":{"quirksMode":false}},"raw":"\r\nCiao mondo! Questo è il nostro primo vagito nel mondo dell'interwebz :)\r\n\r\n```javascript\r\nfunction sayHello(who) {\r\n  console.log('Hello ' + who + '!')\r\n}\r\nsayHello('world')\r\n```\r\n\r\n    # IceOnFire\r\n"},{"data":{"title":"Il Vaso di PIVA","description":"Il primo impatto che abbiamo avuto aprendo una partita IVA.","author":"IceOnFire","_entry":"posts/blog/2016-05-11-il-vaso-di-piva.md","page":"post","name":"il-vaso-di-piva","category":"blog","date":"2016-05-11T00:00:00.000Z","url":"/blog/il-vaso-di-piva"},"content":{"type":"root","children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Ottimo, il primo post in un blog tecnologico non parla di tecnologia ma di Fisco."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Ebbene sì, dopo almeno due anni di titubanze alla fine mi sono deciso ad aprirmi la "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"partita IVA"}]},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"L'ho fatto perché mi arrivano continuamente richieste di progettini che potrei realizzare nel tempo libero, e stavolta rischio di superare il massimale consentito dalla Collaborazione Occasionale (che quest'anno è anche diminuito ed è pure soggetto a limitazioni ridicole, ma sorvoliamo)."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Non l'ho fatto prima perché, diciamocela tutta, ho sempre avuto il terrore di scoperchiare un "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"vaso di Pandora"}]},{"type":"text","value":" che già da lontano non aveva un bell'aspetto. Il lavoro dipendente per uno sviluppatore ha un grosso vantaggio, soprattutto in Italia: a meno che non fai qualche danno davvero grave hai lo stipendio assicurato e pochi oneri burocratici, pertanto (salvo complicazioni ulteriori) puoi concentrare la maggior parte dei tuoi sforzi sul codice."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Ora che ho fatto davvero il grande passo posso dire con tutta serenità che, se siamo messi così al primo mese, figuriamoci più avanti! So che per i più dirò cose ormai ovvie, ma per me è tutto nuovo. Le mie prime esperienze sono state le seguenti:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"La categorizzazione che mi pertiene maggiormente è quella di "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"software house"}]},{"type":"text","value":". Dato che ormai sono un'azienda che produce software, però, mi viene sconsigliato di fare consulenze e formazione, o comunque devo cercare di farle in misura inferiore ai redditi da codice, altrimenti il Fisco si arrabbia. La mia libertà espressiva quindi viene limitata da un sistema che non riesce a ragionare per sfumature ma solo a cluster."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Dato che la tassazione è proporzionale al reddito, in teoria dovrei spendere il più possibile per diminuire la differenza fra ricavi e costi. Mi è stato spiegato che chi non ha da spendere in genere si scarica dalle tasse il carburante usato in vacanza, cene al ristorante con la moglie, mobilio per uso domestico e quant'altro. È disonesto ma lo Stato si prende fino al 48% di quello che guadagni, per cui se vuoi sopravvivere "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"il sistema ti costringe a essere disonesto"}]},{"type":"text","value":". Fortunatamente il mio reddito principale è lo stipendio fisso, quindi posso permettermi di farmi derubare senza bisogno di controbilanciare rubando a mia volta."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Mi è stato spiegato che dal momento in cui apri la partita IVA hai gli occhi del Fisco puntati addosso: ti controllano il conto in banca, spiano i tuoi movimenti, si fidano più di un crotalo incazzato che di te. "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Ogni prelievo è sospetto"}]},{"type":"text","value":", perché potrebbe servire a pagare qualcuno in nero, per cui è passibile di accertamenti. Secondo questa logica, lo Stato vuole farmi andare in paranoia se voglio ordinare una pizza a domicilio."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Sulla carta carburante di un mio amico un distributore appose erroneamente un timbro con la data sbagliata. Per tornare in regola, il mio amico dovette usare una carta carburante nuova di zecca e chiedere a un distributore di fiducia di apporre tuti i timbri insieme in una volta sola. Morale della favola: per i burocrati del Fisco a volte un documento falsificato è "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"legalmente più valido"}]},{"type":"text","value":" di un documento autentico che presenta un errore. Corollario: non mi farò la carta carburante."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"A pochi giorni dall'apertura della partita IVA, un nugolo di "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"aziende sciacalle"}]},{"type":"text","value":" ha mandato missive promozionali in cui mi \"invitano\" ad acquistare la licenza del loro software gestionale o a farmi promuovere sul loro portale web. Le virgolette sono dovute al modo in cui reclamizzano il servizio: a parte poche eccezioni, ogni lettera non era altro che un cedolino postale, con tanto di scadenza ravvicinatissima per aumentare il senso di urgenza (e frasi tipo \"IL VERSAMENTO È DA EFFETTUARSI ENTRO IL\"), una causale generica in cui l'unica parola di senso compiuto è \"ISCRIZIONE\", riferimenti all'iscrizione alla Camera di Commercio e solo in caratteri minuscoli a margine del foglio si nota la vera causale, che in genere comprende la parola \"proposta\". In sostanza non è una truffa ma una \"comunicazione ingannevole\", ovvero un tentativo di "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"circonvenzione di incapace"}]},{"type":"text","value":". Sto parlando con voi, "},{"type":"element","tagName":"a","properties":{"href":"http://www.casellariounicotelematicoimprese.com/"},"children":[{"type":"text","value":"http://www.casellariounicotelematicoimprese.com/"}]},{"type":"text","value":", "},{"type":"element","tagName":"a","properties":{"href":"http://www.portaleimprese.org"},"children":[{"type":"text","value":"http://www.portaleimprese.org"}]},{"type":"text","value":", "},{"type":"element","tagName":"a","properties":{"href":"http://www.softeasy.it/"},"children":[{"type":"text","value":"http://www.softeasy.it/"}]},{"type":"text","value":", Diope srls (di cui non si trova neanche un'informazione sul web), ma soprattutto "},{"type":"element","tagName":"a","properties":{"href":"http://www.infoaziendeitaliane.it"},"children":[{"type":"text","value":"http://www.infoaziendeitaliane.it"}]},{"type":"text","value":": non so come facciate a dormire tranquilli la notte, sapendo che mangiate alle spalle di persone troppo distratte o ignoranti per capire i vostri giochetti. E lo Stato Italiano vi riconosce come legali."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Seguiranno altri succosi sviluppi, ad esempio dal prossimo anno sarò soggetto agli Studi di Settore (e quindi già pregusto un tizio che mi fa: \"Non è possibile che tu guadagni così poco/tanto con le tante/poche risorse che hai!\"). Per ora mi tengo in gola il chi me l'ha fatto fare e vado avanti, voglio vedere quanto c'è da scavare dentro al vaso."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"# IceOnFire\n"}]}]}],"data":{"quirksMode":false}},"raw":"\nOttimo, il primo post in un blog tecnologico non parla di tecnologia ma di Fisco.\n\nEbbene sì, dopo almeno due anni di titubanze alla fine mi sono deciso ad aprirmi la **partita IVA**.\n\nL'ho fatto perché mi arrivano continuamente richieste di progettini che potrei realizzare nel tempo libero, e stavolta rischio di superare il massimale consentito dalla Collaborazione Occasionale (che quest'anno è anche diminuito ed è pure soggetto a limitazioni ridicole, ma sorvoliamo).\n\nNon l'ho fatto prima perché, diciamocela tutta, ho sempre avuto il terrore di scoperchiare un **vaso di Pandora** che già da lontano non aveva un bell'aspetto. Il lavoro dipendente per uno sviluppatore ha un grosso vantaggio, soprattutto in Italia: a meno che non fai qualche danno davvero grave hai lo stipendio assicurato e pochi oneri burocratici, pertanto (salvo complicazioni ulteriori) puoi concentrare la maggior parte dei tuoi sforzi sul codice.\n\nOra che ho fatto davvero il grande passo posso dire con tutta serenità che, se siamo messi così al primo mese, figuriamoci più avanti! So che per i più dirò cose ormai ovvie, ma per me è tutto nuovo. Le mie prime esperienze sono state le seguenti:\n\n1. La categorizzazione che mi pertiene maggiormente è quella di **software house**. Dato che ormai sono un'azienda che produce software, però, mi viene sconsigliato di fare consulenze e formazione, o comunque devo cercare di farle in misura inferiore ai redditi da codice, altrimenti il Fisco si arrabbia. La mia libertà espressiva quindi viene limitata da un sistema che non riesce a ragionare per sfumature ma solo a cluster.\n2. Dato che la tassazione è proporzionale al reddito, in teoria dovrei spendere il più possibile per diminuire la differenza fra ricavi e costi. Mi è stato spiegato che chi non ha da spendere in genere si scarica dalle tasse il carburante usato in vacanza, cene al ristorante con la moglie, mobilio per uso domestico e quant'altro. È disonesto ma lo Stato si prende fino al 48% di quello che guadagni, per cui se vuoi sopravvivere **il sistema ti costringe a essere disonesto**. Fortunatamente il mio reddito principale è lo stipendio fisso, quindi posso permettermi di farmi derubare senza bisogno di controbilanciare rubando a mia volta.\n3. Mi è stato spiegato che dal momento in cui apri la partita IVA hai gli occhi del Fisco puntati addosso: ti controllano il conto in banca, spiano i tuoi movimenti, si fidano più di un crotalo incazzato che di te. **Ogni prelievo è sospetto**, perché potrebbe servire a pagare qualcuno in nero, per cui è passibile di accertamenti. Secondo questa logica, lo Stato vuole farmi andare in paranoia se voglio ordinare una pizza a domicilio.\n4. Sulla carta carburante di un mio amico un distributore appose erroneamente un timbro con la data sbagliata. Per tornare in regola, il mio amico dovette usare una carta carburante nuova di zecca e chiedere a un distributore di fiducia di apporre tuti i timbri insieme in una volta sola. Morale della favola: per i burocrati del Fisco a volte un documento falsificato è **legalmente più valido** di un documento autentico che presenta un errore. Corollario: non mi farò la carta carburante.\n5. A pochi giorni dall'apertura della partita IVA, un nugolo di **aziende sciacalle** ha mandato missive promozionali in cui mi \"invitano\" ad acquistare la licenza del loro software gestionale o a farmi promuovere sul loro portale web. Le virgolette sono dovute al modo in cui reclamizzano il servizio: a parte poche eccezioni, ogni lettera non era altro che un cedolino postale, con tanto di scadenza ravvicinatissima per aumentare il senso di urgenza (e frasi tipo \"IL VERSAMENTO È DA EFFETTUARSI ENTRO IL\"), una causale generica in cui l'unica parola di senso compiuto è \"ISCRIZIONE\", riferimenti all'iscrizione alla Camera di Commercio e solo in caratteri minuscoli a margine del foglio si nota la vera causale, che in genere comprende la parola \"proposta\". In sostanza non è una truffa ma una \"comunicazione ingannevole\", ovvero un tentativo di **circonvenzione di incapace**. Sto parlando con voi, http://www.casellariounicotelematicoimprese.com/, http://www.portaleimprese.org, http://www.softeasy.it/, Diope srls (di cui non si trova neanche un'informazione sul web), ma soprattutto http://www.infoaziendeitaliane.it: non so come facciate a dormire tranquilli la notte, sapendo che mangiate alle spalle di persone troppo distratte o ignoranti per capire i vostri giochetti. E lo Stato Italiano vi riconosce come legali.\n\nSeguiranno altri succosi sviluppi, ad esempio dal prossimo anno sarò soggetto agli Studi di Settore (e quindi già pregusto un tizio che mi fa: \"Non è possibile che tu guadagni così poco/tanto con le tante/poche risorse che hai!\"). Per ora mi tengo in gola il chi me l'ha fatto fare e vado avanti, voglio vedere quanto c'è da scavare dentro al vaso.\n\n    # IceOnFire\n"},{"data":{"title":"Resistere alla tentazione del procedurale in Redux","description":"Non è facile disimparare, ma si può e si deve.","author":"IceOnFire","_entry":"posts/blog/2016-07-21-resistere-alla-tentazione-del-procedurale-in-redux.md","page":"post","name":"resistere-alla-tentazione-del-procedurale-in-redux","category":"blog","date":"2016-07-21T00:00:00.000Z","url":"/blog/resistere-alla-tentazione-del-procedurale-in-redux"},"content":{"type":"root","children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Proveniendo da un contesto procedurale e orientato agli oggetti, un approccio\nfunzionale e dichiarativo come quello di "},{"type":"element","tagName":"a","properties":{"href":"http://redux.js.org/"},"children":[{"type":"text","value":"redux"}]},{"type":"text","value":" richiede un salto mentale non indifferente. Realizzare applicazioni è molto semplice, almeno finché non si devono gestire un'infinità di effetti collaterali e chiamate asincrone che si innescano a catena. È lì che l'approccio più intrigante risulta quello procedurale. Tuttavia dobbiamo essere coraggiosi e cercare l'approccio più semplice ed elegante, non quello più comodo."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Esempio pratico: "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"Master-Detail"}]},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Supponiamo di avere dei componenti griglia che sanno mostrare dati recuperati da remoto con una query. Questa query è dinamica, può cambiare a seconda di variabili che le arrivano dall'esterno."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Supponiamo ora di dover mostrare una prima griglia che non dipende da alcuna variabile. Questa griglia deve poi auto-selezionarsi la prima riga, e questo comporta il caricamento di una seconda griglia i cui dati dipendono dalla riga selezionata (dalle variabili da essa prodotte, per la precisione). Il procedimento può andare avanti con un'ulteriore selezione automatica della prima riga nella seconda griglia e conseguente caricamento di una terza, e così via. La selezione di una riga può ovviamente essere effettuata anche da parte dell'utente, che innescherà un nuovo effetto a catena sulla griglia corrente e su tutte quelle dipendenti."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"La prima soluzione che sono riuscito a ottenere è trasferendo tutto il potere alle saghe di "},{"type":"element","tagName":"a","properties":{"href":"http://yelouafi.github.io/redux-saga/"},"children":[{"type":"text","value":"redux-saga"}]},{"type":"text","value":" (ma i thunk di "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/gaearon/redux-thunk"},"children":[{"type":"text","value":"redux-thunk"}]},{"type":"text","value":" avrebbero sortito lo stesso effetto)."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Appena lo store è creato possiamo dispatchare una action di inizializzazione per la prima griglia, quella che non dipende da nessuna variabile:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-js"]},"children":[{"type":"text","value":"store.dispatch(initGrid('FirstGrid'))\n"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"La saga che accoglierà la action di inizializzazione sarà pressappoco questa:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-js"]},"children":[{"type":"text","value":"function* initGrid(action) {\n  const {\n    payload: { id, variables },\n  } = action\n  const query = computeNewQuery(id, variables)\n\n  try {\n    const data = yield call(fetchData, id, query)\n    yield put(receiveData(id, data))\n    yield put(selectRow(id, 0))\n  } catch ({ message }) {\n    yield put(receiveError(id, message))\n  }\n}\n"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"La nuova query viene calcolata al volo (ho omesso i dettagli per chiarezza) e viene usata per recuperare i nuovi dati da passare alla griglia chiamando direttamente un'altra saga chiamata "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"fetchData"}]},{"type":"text","value":". Una volta ottenuti i dati viene aggiornata la griglia corrente e viene selezionata la prima riga, e la selezione è il dispatch di una action a un'altra saga:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-js"]},"children":[{"type":"text","value":"function* selectRow(action) {\n  const {\n    payload: { id, selectedRow },\n  } = action\n  const newVars = computeNewVariables(id, selectedRow)\n\n  yield put(updateSelectedRow(id, selectedRow))\n  yield grids.map(grid =\u003e {\n    if (grid.dependsOn(updatedVariables)) {\n      return fork(initGrid, {\n        payload: { id, variables: newVars },\n      })\n    }\n  })\n}\n"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Questo approccio funziona, e pare anche abbastanza pulito. Le saghe in questa implementazione possono essere viste come degli agenti esterni (forse qualcosa di simile agli "},{"type":"element","tagName":"a","properties":{"href":"http://jamesknelson.com/join-the-dark-side-of-the-flux-responding-to-actions-with-actors/"},"children":[{"type":"text","value":"attori"}]},{"type":"text","value":"?) oppure, in modo più pittoresco, come aerei che volano a bassa quota sull'applicazione sganciando action per aggiornare lo store."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Ci sono però alcuni code smell più o meno evidenti:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"I riduttori non hanno logica, vengono interpellati solo per popolarsi con dati recuperati o calcolati dalle saghe"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Nelle saghe invece è nascosta tanta, tanta logica procedurale, compresa la scelta di quali griglie devono essere aggiornate o addirittura quale griglia inizializzare per prima, e scriverci sopra degli unit test non è così banale (sicuramente più semplice che farlo con i thunk, per cui se la strada scelta è questa almeno scegliete il male minore)"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"C'è una dipendenza ciclica fra le due saghe, perché quando inizializzo una griglia devo selezionare la prima riga e quando seleziono la prima riga devo inizializzare le griglie dipendenti"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Nella saga di "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"selectRow"}]},{"type":"text","value":" viene chiamata la saga "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"initGrid"}]},{"type":"text","value":" sfruttando una finta action: questo perché le saghe per contratto devono accettare una action se vogliono essere usate in un "},{"type":"element","tagName":"a","properties":{"href":"http://yelouafi.github.io/redux-saga/docs/advanced/Concurrency.html"},"children":[{"type":"text","value":"takeEvery"}]}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Il tutto nasce dal presupposto che le griglie debbano essere piuttosto stupide, e sappiano visualizzare i dati recuperati altrove (dalle saghe) piuttosto che effettuare loro stesse le query. Ma riguardando più volte al microscopio i "},{"type":"element","tagName":"a","properties":{"href":"https://egghead.io/courses/getting-started-with-redux"},"children":[{"type":"text","value":"video tutorial"}]},{"type":"text","value":" di Dan Abramov, in particolare il "},{"type":"element","tagName":"a","properties":{"href":"https://egghead.io/courses/building-react-applications-with-idiomatic-redux"},"children":[{"type":"text","value":"secondo"}]},{"type":"text","value":", nonché le discussioni su Github relative a "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/reactjs/redux/issues/1171"},"children":[{"type":"text","value":"come strutturare un'applicazione Redux"}]},{"type":"text","value":" e a "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/reactjs/redux/issues/749"},"children":[{"type":"text","value":"come modificare lo stato di riduttori interdipendenti"}]},{"type":"text","value":", mi sono convinto che un'altra soluzione sia possibile, e anche più efficace."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"La soluzione in parole povere è la seguente:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"La query calcolata è parte integrante dello stato delle griglie (ma forse potrebbe anche essere implementata come un "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/reactjs/reselect"},"children":[{"type":"text","value":"selettore memoizzato"}]},{"type":"text","value":"):"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-js"]},"children":[{"type":"text","value":"function query = (state, action) =\u003e {\n  const { type, payload } = action\n\n  switch (type) {\n    case UPDATE_LIVE_QUERY:\n      return computeNewQuery(payload)\n    default:\n      return state\n  }\n}\n"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Le griglie, esattamente come nei video tutorial, sono suddivise in "},{"type":"element","tagName":"a","properties":{"href":"https://medium.com/@dan_abramov/smart-and-dumb-components-7ca2f9a7c7d0#.jqqae1xb5"},"children":[{"type":"text","value":"componenti presentazionali e componenti contenitori"}]},{"type":"text","value":", e i contenitori sono in grado di chiamare la saga "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"fetchData"}]},{"type":"text","value":" per conto loro nei metodi "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"componentDidMount"}]},{"type":"text","value":" e "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"componentDidUpdate"}]},{"type":"text","value":":"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-js"]},"children":[{"type":"text","value":"class GridContainer extends Component {\n  fetchData() {\n    const { id, canFetchData, requestData } = this.props\n\n    if (canFetchData) {\n      requestData(id)\n    }\n  }\n\n  componentDidMount() {\n    this.fetchData()\n  }\n\n  componentDidUpdate(prevProps) {\n    if (this.props.liveQuery !== prevProps.liveQuery) {\n      this.fetchData()\n    }\n  }\n\n  render() {\n    const { id, canFetchData, requestData, ...rest } = this.props\n    return \u003cGrid id={id} {...rest} /\u003e\n  }\n}\n\nconnect(\n  mapStateToProps,\n  { requestData, selectRow },\n)(GridContainer)\n"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Come si può notare, nel metodo "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"componentDidUpdate"}]},{"type":"text","value":" la chiamata a "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"fetchData"}]},{"type":"text","value":" deve essere fatta solo se la query è cambiata rispetto a prima. Questo significa che bisogna prestare particolare attenzione nel riduttore a non fornire una copia della query ma la query stessa se il dispatch di una action non l'ha cambiata. A questo scopo potrebbe essere molto utile una libreria come "},{"type":"element","tagName":"a","properties":{"href":"https://facebook.github.io/immutable-js/"},"children":[{"type":"text","value":"Immutable"}]},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Inoltre nel metodo "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"fetchData"}]},{"type":"text","value":" viene passata una proprietà chiamata "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"canFetchData"}]},{"type":"text","value":": questa non è altro che un selettore che verifica che la query corrente abbia tutte le informazioni necessarie per essere eseguita (cioè non dipenda da alcuna variabile o le variabili da cui dipende ci siano tutte). Questo approccio, che mi piace chiamare "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"ragionare a compartimenti stagni"}]},{"type":"text","value":", è semplicemente la base di una programmazione modulare."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Il pezzo difficile è nel "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"rootReducer"}]},{"type":"text","value":": quando viene selezionata una riga, questo deve calcolare le nuove variabili, aggiornarle nella porzione di stato dedicata, e poi usare le variabili per aggiornare la query alle griglie ("},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"TUTTE"}]},{"type":"text","value":" le variabili e "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"TUTTE"}]},{"type":"text","value":" le griglie, è questo che lo rende più dichiarativo e fail-safe). Perché implementare questa logica proprio nella root? Perché è l'"},{"type":"element","tagName":"a","properties":{"href":"https://en.wikipedia.org/wiki/GRASP_(object-oriented_design#Information_expert)"},"children":[{"type":"text","value":"Information Expert"}]},{"type":"text","value":" della situazione:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-js"]},"children":[{"type":"text","value":"const rootReducer = (state, action) =\u003e {\n  const { type, payload } = action\n  switch (type) {\n    case '@@INIT':\n      return {\n        ...state,\n        viewers: viewers(state.grids, computeNewQuery(state.variables)),\n      }\n    case SELECT_ROW:\n      const newVars = computeNewVariables(payload.id, payload.row)\n      let newState = {\n        ...state,\n        grids: grids(state.grids, action),\n        variables: variables(state.variables, updateVariables(newVars)),\n      }\n      return {\n        ...newState,\n        grids: grids(newState.grids, updateQuery(newState.variables)),\n      }\n    default:\n      return state\n  }\n}\n"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Alcune cose da notare qui:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Stiamo usando la action di inizializzazione di Redux per cominciare a \"svegliare\" le griglie; forse non è molto ortodosso, avremmo potuto dispatchare una nostra action come fatto per le saghe"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"La selezione della riga consiste nella chiamata consecutiva ai reducer sottostanti. Questo è l'unico aspetto un po' procedurale, perché non possiamo fare tutto in un colpo solo ma dobbiamo aspettare prima che lo stato abbia tutte le variabili in posizione per poterle usare sulle griglie"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"I riduttori vengono chiamati con delle sotto-action dedicate, "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"updateVariables"}]},{"type":"text","value":" e "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"updateQuery"}]},{"type":"text","value":", che non compariranno mai nel log di "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/gaearon/redux-devtools"},"children":[{"type":"text","value":"Redux-DevTools"}]},{"type":"text","value":". Quello che prima mi sembrava una bestemmia ora mi sembra la cosa più naturale del mondo dato che in fondo è la stessa cosa che scriverei se dovessi chiamare una "},{"type":"element","tagName":"a","properties":{"href":"https://it.wikipedia.org/wiki/Fa%C3%A7ade_pattern"},"children":[{"type":"text","value":"façade"}]},{"type":"text","value":" che chiama a sua volta dei sotto-componenti. L'unica cosa da non fare assolutamente è rendere due reducer interdipendenti, ma un reducer padre può e deve manipolare lo stato dei reducer figli."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"A questo punto possiamo completamente fare a meno della saga "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"initGrid"}]},{"type":"text","value":": l'inizializzazione parte dalle stesse griglie, che si aggiorneranno automaticamente nel momento in cui la query dovesse cambiare. Abbiamo spostato la logica degli effetti collaterali dentro un componente React e la logica applicativa dentro ai riduttori. Il middleware delle saghe deve solo rimanere in ascolto di richieste di "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"fetchData"}]},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Per dubbi, domande, obiezioni o sdegno non esitate a contattarmi. Un giorno magari implementerò anche un meccanismo di commenti, nel frattempo insultatemi in privato :)"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"# IceOnFire\n"}]}]}],"data":{"quirksMode":false}},"raw":"\nProveniendo da un contesto procedurale e orientato agli oggetti, un approccio\nfunzionale e dichiarativo come quello di [redux](http://redux.js.org/) richiede un salto mentale non indifferente. Realizzare applicazioni è molto semplice, almeno finché non si devono gestire un'infinità di effetti collaterali e chiamate asincrone che si innescano a catena. È lì che l'approccio più intrigante risulta quello procedurale. Tuttavia dobbiamo essere coraggiosi e cercare l'approccio più semplice ed elegante, non quello più comodo.\n\nEsempio pratico: _Master-Detail_.\n\nSupponiamo di avere dei componenti griglia che sanno mostrare dati recuperati da remoto con una query. Questa query è dinamica, può cambiare a seconda di variabili che le arrivano dall'esterno.\n\nSupponiamo ora di dover mostrare una prima griglia che non dipende da alcuna variabile. Questa griglia deve poi auto-selezionarsi la prima riga, e questo comporta il caricamento di una seconda griglia i cui dati dipendono dalla riga selezionata (dalle variabili da essa prodotte, per la precisione). Il procedimento può andare avanti con un'ulteriore selezione automatica della prima riga nella seconda griglia e conseguente caricamento di una terza, e così via. La selezione di una riga può ovviamente essere effettuata anche da parte dell'utente, che innescherà un nuovo effetto a catena sulla griglia corrente e su tutte quelle dipendenti.\n\nLa prima soluzione che sono riuscito a ottenere è trasferendo tutto il potere alle saghe di [redux-saga](http://yelouafi.github.io/redux-saga/) (ma i thunk di [redux-thunk](https://github.com/gaearon/redux-thunk) avrebbero sortito lo stesso effetto).\n\nAppena lo store è creato possiamo dispatchare una action di inizializzazione per la prima griglia, quella che non dipende da nessuna variabile:\n\n```js\nstore.dispatch(initGrid('FirstGrid'))\n```\n\nLa saga che accoglierà la action di inizializzazione sarà pressappoco questa:\n\n```js\nfunction* initGrid(action) {\n  const {\n    payload: { id, variables },\n  } = action\n  const query = computeNewQuery(id, variables)\n\n  try {\n    const data = yield call(fetchData, id, query)\n    yield put(receiveData(id, data))\n    yield put(selectRow(id, 0))\n  } catch ({ message }) {\n    yield put(receiveError(id, message))\n  }\n}\n```\n\nLa nuova query viene calcolata al volo (ho omesso i dettagli per chiarezza) e viene usata per recuperare i nuovi dati da passare alla griglia chiamando direttamente un'altra saga chiamata `fetchData`. Una volta ottenuti i dati viene aggiornata la griglia corrente e viene selezionata la prima riga, e la selezione è il dispatch di una action a un'altra saga:\n\n```js\nfunction* selectRow(action) {\n  const {\n    payload: { id, selectedRow },\n  } = action\n  const newVars = computeNewVariables(id, selectedRow)\n\n  yield put(updateSelectedRow(id, selectedRow))\n  yield grids.map(grid =\u003e {\n    if (grid.dependsOn(updatedVariables)) {\n      return fork(initGrid, {\n        payload: { id, variables: newVars },\n      })\n    }\n  })\n}\n```\n\nQuesto approccio funziona, e pare anche abbastanza pulito. Le saghe in questa implementazione possono essere viste come degli agenti esterni (forse qualcosa di simile agli [attori](http://jamesknelson.com/join-the-dark-side-of-the-flux-responding-to-actions-with-actors/)?) oppure, in modo più pittoresco, come aerei che volano a bassa quota sull'applicazione sganciando action per aggiornare lo store.\n\nCi sono però alcuni code smell più o meno evidenti:\n\n1. I riduttori non hanno logica, vengono interpellati solo per popolarsi con dati recuperati o calcolati dalle saghe\n2. Nelle saghe invece è nascosta tanta, tanta logica procedurale, compresa la scelta di quali griglie devono essere aggiornate o addirittura quale griglia inizializzare per prima, e scriverci sopra degli unit test non è così banale (sicuramente più semplice che farlo con i thunk, per cui se la strada scelta è questa almeno scegliete il male minore)\n3. C'è una dipendenza ciclica fra le due saghe, perché quando inizializzo una griglia devo selezionare la prima riga e quando seleziono la prima riga devo inizializzare le griglie dipendenti\n4. Nella saga di `selectRow` viene chiamata la saga `initGrid` sfruttando una finta action: questo perché le saghe per contratto devono accettare una action se vogliono essere usate in un [takeEvery](http://yelouafi.github.io/redux-saga/docs/advanced/Concurrency.html)\n\nIl tutto nasce dal presupposto che le griglie debbano essere piuttosto stupide, e sappiano visualizzare i dati recuperati altrove (dalle saghe) piuttosto che effettuare loro stesse le query. Ma riguardando più volte al microscopio i [video tutorial](https://egghead.io/courses/getting-started-with-redux) di Dan Abramov, in particolare il [secondo](https://egghead.io/courses/building-react-applications-with-idiomatic-redux), nonché le discussioni su Github relative a [come strutturare un'applicazione Redux](https://github.com/reactjs/redux/issues/1171) e a [come modificare lo stato di riduttori interdipendenti](https://github.com/reactjs/redux/issues/749), mi sono convinto che un'altra soluzione sia possibile, e anche più efficace.\n\nLa soluzione in parole povere è la seguente:\n\nLa query calcolata è parte integrante dello stato delle griglie (ma forse potrebbe anche essere implementata come un [selettore memoizzato](https://github.com/reactjs/reselect)):\n\n```js\nfunction query = (state, action) =\u003e {\n  const { type, payload } = action\n\n  switch (type) {\n    case UPDATE_LIVE_QUERY:\n      return computeNewQuery(payload)\n    default:\n      return state\n  }\n}\n```\n\nLe griglie, esattamente come nei video tutorial, sono suddivise in [componenti presentazionali e componenti contenitori](https://medium.com/@dan_abramov/smart-and-dumb-components-7ca2f9a7c7d0#.jqqae1xb5), e i contenitori sono in grado di chiamare la saga `fetchData` per conto loro nei metodi `componentDidMount` e `componentDidUpdate`:\n\n```js\nclass GridContainer extends Component {\n  fetchData() {\n    const { id, canFetchData, requestData } = this.props\n\n    if (canFetchData) {\n      requestData(id)\n    }\n  }\n\n  componentDidMount() {\n    this.fetchData()\n  }\n\n  componentDidUpdate(prevProps) {\n    if (this.props.liveQuery !== prevProps.liveQuery) {\n      this.fetchData()\n    }\n  }\n\n  render() {\n    const { id, canFetchData, requestData, ...rest } = this.props\n    return \u003cGrid id={id} {...rest} /\u003e\n  }\n}\n\nconnect(\n  mapStateToProps,\n  { requestData, selectRow },\n)(GridContainer)\n```\n\nCome si può notare, nel metodo `componentDidUpdate` la chiamata a `fetchData` deve essere fatta solo se la query è cambiata rispetto a prima. Questo significa che bisogna prestare particolare attenzione nel riduttore a non fornire una copia della query ma la query stessa se il dispatch di una action non l'ha cambiata. A questo scopo potrebbe essere molto utile una libreria come [Immutable](https://facebook.github.io/immutable-js/).\n\nInoltre nel metodo `fetchData` viene passata una proprietà chiamata `canFetchData`: questa non è altro che un selettore che verifica che la query corrente abbia tutte le informazioni necessarie per essere eseguita (cioè non dipenda da alcuna variabile o le variabili da cui dipende ci siano tutte). Questo approccio, che mi piace chiamare _ragionare a compartimenti stagni_, è semplicemente la base di una programmazione modulare.\n\nIl pezzo difficile è nel `rootReducer`: quando viene selezionata una riga, questo deve calcolare le nuove variabili, aggiornarle nella porzione di stato dedicata, e poi usare le variabili per aggiornare la query alle griglie (_TUTTE_ le variabili e _TUTTE_ le griglie, è questo che lo rende più dichiarativo e fail-safe). Perché implementare questa logica proprio nella root? Perché è l'[Information Expert](\u003chttps://en.wikipedia.org/wiki/GRASP_(object-oriented_design#Information_expert)\u003e) della situazione:\n\n```js\nconst rootReducer = (state, action) =\u003e {\n  const { type, payload } = action\n  switch (type) {\n    case '@@INIT':\n      return {\n        ...state,\n        viewers: viewers(state.grids, computeNewQuery(state.variables)),\n      }\n    case SELECT_ROW:\n      const newVars = computeNewVariables(payload.id, payload.row)\n      let newState = {\n        ...state,\n        grids: grids(state.grids, action),\n        variables: variables(state.variables, updateVariables(newVars)),\n      }\n      return {\n        ...newState,\n        grids: grids(newState.grids, updateQuery(newState.variables)),\n      }\n    default:\n      return state\n  }\n}\n```\n\nAlcune cose da notare qui:\n\n1. Stiamo usando la action di inizializzazione di Redux per cominciare a \"svegliare\" le griglie; forse non è molto ortodosso, avremmo potuto dispatchare una nostra action come fatto per le saghe\n2. La selezione della riga consiste nella chiamata consecutiva ai reducer sottostanti. Questo è l'unico aspetto un po' procedurale, perché non possiamo fare tutto in un colpo solo ma dobbiamo aspettare prima che lo stato abbia tutte le variabili in posizione per poterle usare sulle griglie\n3. I riduttori vengono chiamati con delle sotto-action dedicate, `updateVariables` e `updateQuery`, che non compariranno mai nel log di [Redux-DevTools](https://github.com/gaearon/redux-devtools). Quello che prima mi sembrava una bestemmia ora mi sembra la cosa più naturale del mondo dato che in fondo è la stessa cosa che scriverei se dovessi chiamare una [façade](https://it.wikipedia.org/wiki/Fa%C3%A7ade_pattern) che chiama a sua volta dei sotto-componenti. L'unica cosa da non fare assolutamente è rendere due reducer interdipendenti, ma un reducer padre può e deve manipolare lo stato dei reducer figli.\n\nA questo punto possiamo completamente fare a meno della saga `initGrid`: l'inizializzazione parte dalle stesse griglie, che si aggiorneranno automaticamente nel momento in cui la query dovesse cambiare. Abbiamo spostato la logica degli effetti collaterali dentro un componente React e la logica applicativa dentro ai riduttori. Il middleware delle saghe deve solo rimanere in ascolto di richieste di `fetchData`.\n\nPer dubbi, domande, obiezioni o sdegno non esitate a contattarmi. Un giorno magari implementerò anche un meccanismo di commenti, nel frattempo insultatemi in privato :)\n\n    # IceOnFire\n"},{"data":{"title":"Pokémon Go e la Teoria degli Effetti Collaterali","description":"Il segreto per una startup di successo sta nel pianificare tutte le conseguenze?","author":"IceOnFire","_entry":"posts/blog/2016-07-22-pokemon-go-e-la-teoria-degli-effetti-collaterali.md","page":"post","name":"pokemon-go-e-la-teoria-degli-effetti-collaterali","category":"blog","date":"2016-07-22T00:00:00.000Z","url":"/blog/pokemon-go-e-la-teoria-degli-effetti-collaterali"},"content":{"type":"root","children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Ne parlano bene, ne parlano male, per una volta voglio parlarne anch'io. Senza nessuna autorevolezza in merito, s'intende. Ma per virtù della Teoria degli Effetti Collaterali™ l'app di Pokémon Go si è rivelata fin da subito un successo planetario e anche meritato."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Che cos'è la Teoria degli Effetti Collaterali? Niente, me la sono inventata sul momento per descrivere un fenomeno sicuramente già analizzato e approfondito da esperti di sociologia e di marketing, ma che qui ripropongo come fosse una mia idea originale da rivendere al baretto sotto casa."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Voglio creare un'app ludica che consenta a tutto il mondo di conoscere nuove persone, fare amicizia, magari trovare l'anima gemella. La realizzo, funziona bene, la sponsorizzo usando una tecnica un po' aggressiva di spammaggio, ma alla fine ottengo una buona base di utenti."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"La chiamo Badoo."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Le regole sono:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Voglio garantire l'anonimato per dare agli utenti piena libertà di esprimersi."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Voglio che gli utenti interagiscano mettendo like alle foto, chattando ed esprimendo in modo anonimo il proprio apprezzamento su di una persona, non si sa mai che qualcuno si trovi corrisposto."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"La voglio mantenere gratuita, ma con contenuti premium sfruttando il senso di urgenza dell'utente nel momento in cui gli serve una funzionalità e non ce l'ha (in fondo non faccio beneficienza)."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Risultato: riporto qui i primi due commenti che ho trovato sul "},{"type":"element","tagName":"a","properties":{"href":"https://play.google.com/store/apps/details?id=com.badoo.mobile"},"children":[{"type":"text","value":"Play Store"}]},{"type":"text","value":":"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"blockquote","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Rubbish"}]},{"type":"text","value":" Full of gay/cross dressing males with female profiles reported to site creators and also blocked and reported ids through normal means yet the profile still exists, seems like creators not bothered. Can't even add my work or education due to not being a Facebook user what a joke."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Useless, can hardly chat with anyone unless you purchase credits."}]},{"type":"text","value":" Shouldn't matter much in reality because it's probably mostly bots. \"still the same in most recent update\""}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Che è successo?"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"L'anonimato garantisce libertà di espressione nel bene e nel male: ben presto l'app si è riempita di persone con problemi relazionali e di autostima che stalkerano il sesso opposto, promettono foto osé in cambio di una ricarica telefonica, offrono prestazioni sessuali a pagamento e così via."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Ad eccezione della chat, le foto così come i match e i like sono tutti mezzi di comunicazione legati all'apparenza. Non usi l'app per conoscere gente interessante, ma per vedere qualche bel(la) manzo/a."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Certi modelli di freemium sono deleteri perché, come nei videogiochi pay-per-win, l'utente si sente preso in giro in quanto scopre molto presto che non può fare davvero niente di interessante se non paga, e che tutto il contenuto gratuito iniziale serviva solo ad attirarlo nella trappola."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Assumendo che l'intento iniziale di Badoo fosse il nobile fine di mettere in comunicazione la gente, un buon progetto si è trasformato in un cattivo prodotto per via dell'uso che ne fanno gli utenti. Questo io lo chiamo Effetto Collaterale."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Come non citare Facebook. Facebook è riuscito a limitare di molto questi effetti collaterali, aggiungendo fin da subito meccanismi che limitano drasticamente l'anonimato: se per privacy non hai voluto indicare il tuo vero nome e cognome, quantomeno hai una lista di amici che ti fanno da referenza. Chiunque è libero di rifiutare la tua richiesta di contatto se pensa di non conoscerti nella vita reale o se il tuo profilo non promette nulla di buono."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Una situazione analoga l'abbiamo avuta nel mondo della realtà virtuale. Chi si ricorda di Second Life? Quel meraviglioso mondo virtuale nel quale puoi interagire con gli altri utenti tramite il tuo avatar super-personalizzabile e puoi costruire quello che vuoi o comprarlo con una moneta virtuale (che si può cambiare in denaro vero). L'avevo provato qualche anno fa. Beh, dopo un po' che giravo fra le varie isole ho notato che si stava instaurando una gerarchia basata sull'apparenza (il mio avatar poco personalizzato era chiaramente appartenente a un \"niubbo\"); c'era un notevole mercato di vestiti e accessori virtuali, tra cui una vasta gamma di falli da aggiungere al proprio avatar e di script di sesso simulato da comprare. NEXT."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Molto tempo dopo ho sentito parlare di Minecraft. Altro mondo virtuale, meccanismo di costruzione basato sui mattoncini un po' come il Lego: difficilmente si pensa al sesso quando il mondo e gli avatar sono fatti a cubetti. Effetto collaterale: proprio come il Lego, un gioco che pare per bambini è diventato un culto anche fra i grandi, alcuni dei quali hanno realizzato opere monumentali davvero stupende."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Non so se i creatori del gioco avessero pensato in anticipo a quali avrebbero potuto essere le conseguenze, tuttavia questo tipo di fenomeni mi fa pensare che quando si vuole ottenere qualcosa, soprattutto nel mondo delle app e del mercato consumer in generale, si deve prestare molta attenzione se non proprio "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"pianificare accuratamente gli effetti collaterali"}]},{"type":"text","value":", in modo non solo da controllarne alcuni ma anche di favorirne altri. Vuoi ottenere "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"X"}]},{"type":"text","value":"? Non creare un'app per ottenere "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"X"}]},{"type":"text","value":", crea un'app con cui ottieni "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"Y"}]},{"type":"text","value":" e che come effetto collaterale ti faccia ottenere anche "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"X"}]},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Voglio creare un'app ludica che consenta a tutto il mondo di conoscere nuove persone, fare amicizia, magari trovare l'anima gemella. La realizzo, funziona bene, è un'app che sfrutta il GPS del telefonino per farmi uscire di casa a conquistare punti nevralgici per la mia fazione."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"La chiamo Ingress."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Non funziona, non se la fila nessuno. Allora faccio una partnership con Nintendo e la chiamo Pokémon Go. Due soli avatar disponibili molto poco sessuati (un ragazzino e una ragazzina ben coperti), tanti piccoli mostriciattoli colorati da catturare che sono la gioia dei più piccini e forniscono l'elemento nostalgia ai più grandicelli. L'account rimane anonimo, ma stavolta ci metti la faccia. E una faccia che pregusta la cattura di un pupazzetto per strada in fondo è una bella faccia, spensierata e soprattutto innocua."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"E di lì a poco, in mezzo alle cronache di gente così fissata o distratta da farsi male (ma questo succedeva già ai tempi degli SMS), si leggono anche storie di amicizie nate cercando Pokémon in giro, di ragazzi che si staccano dalla console per passare molto più tempo a giocare fuori e socializzare, di gente che trova il pretesto per fare un po' di movimento e tenersi in forma, di bambini autistici che riescono ad avere interazioni con altri bambini. Non male come Effetto Collaterale™, eh?"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"# IceOnFire\n"}]}]}],"data":{"quirksMode":false}},"raw":"\nNe parlano bene, ne parlano male, per una volta voglio parlarne anch'io. Senza nessuna autorevolezza in merito, s'intende. Ma per virtù della Teoria degli Effetti Collaterali\u0026trade; l'app di Pokémon Go si è rivelata fin da subito un successo planetario e anche meritato.\n\nChe cos'è la Teoria degli Effetti Collaterali? Niente, me la sono inventata sul momento per descrivere un fenomeno sicuramente già analizzato e approfondito da esperti di sociologia e di marketing, ma che qui ripropongo come fosse una mia idea originale da rivendere al baretto sotto casa.\n\nVoglio creare un'app ludica che consenta a tutto il mondo di conoscere nuove persone, fare amicizia, magari trovare l'anima gemella. La realizzo, funziona bene, la sponsorizzo usando una tecnica un po' aggressiva di spammaggio, ma alla fine ottengo una buona base di utenti.\n\nLa chiamo Badoo.\n\nLe regole sono:\n\n1. Voglio garantire l'anonimato per dare agli utenti piena libertà di esprimersi.\n2. Voglio che gli utenti interagiscano mettendo like alle foto, chattando ed esprimendo in modo anonimo il proprio apprezzamento su di una persona, non si sa mai che qualcuno si trovi corrisposto.\n3. La voglio mantenere gratuita, ma con contenuti premium sfruttando il senso di urgenza dell'utente nel momento in cui gli serve una funzionalità e non ce l'ha (in fondo non faccio beneficienza).\n\nRisultato: riporto qui i primi due commenti che ho trovato sul [Play Store](https://play.google.com/store/apps/details?id=com.badoo.mobile):\n\n\u003e **Rubbish** Full of gay/cross dressing males with female profiles reported to site creators and also blocked and reported ids through normal means yet the profile still exists, seems like creators not bothered. Can't even add my work or education due to not being a Facebook user what a joke.\n\n\u003e **Useless, can hardly chat with anyone unless you purchase credits.** Shouldn't matter much in reality because it's probably mostly bots. \"still the same in most recent update\"\n\nChe è successo?\n\n1. L'anonimato garantisce libertà di espressione nel bene e nel male: ben presto l'app si è riempita di persone con problemi relazionali e di autostima che stalkerano il sesso opposto, promettono foto osé in cambio di una ricarica telefonica, offrono prestazioni sessuali a pagamento e così via.\n2. Ad eccezione della chat, le foto così come i match e i like sono tutti mezzi di comunicazione legati all'apparenza. Non usi l'app per conoscere gente interessante, ma per vedere qualche bel(la) manzo/a.\n3. Certi modelli di freemium sono deleteri perché, come nei videogiochi pay-per-win, l'utente si sente preso in giro in quanto scopre molto presto che non può fare davvero niente di interessante se non paga, e che tutto il contenuto gratuito iniziale serviva solo ad attirarlo nella trappola.\n\nAssumendo che l'intento iniziale di Badoo fosse il nobile fine di mettere in comunicazione la gente, un buon progetto si è trasformato in un cattivo prodotto per via dell'uso che ne fanno gli utenti. Questo io lo chiamo Effetto Collaterale.\n\nCome non citare Facebook. Facebook è riuscito a limitare di molto questi effetti collaterali, aggiungendo fin da subito meccanismi che limitano drasticamente l'anonimato: se per privacy non hai voluto indicare il tuo vero nome e cognome, quantomeno hai una lista di amici che ti fanno da referenza. Chiunque è libero di rifiutare la tua richiesta di contatto se pensa di non conoscerti nella vita reale o se il tuo profilo non promette nulla di buono.\n\nUna situazione analoga l'abbiamo avuta nel mondo della realtà virtuale. Chi si ricorda di Second Life? Quel meraviglioso mondo virtuale nel quale puoi interagire con gli altri utenti tramite il tuo avatar super-personalizzabile e puoi costruire quello che vuoi o comprarlo con una moneta virtuale (che si può cambiare in denaro vero). L'avevo provato qualche anno fa. Beh, dopo un po' che giravo fra le varie isole ho notato che si stava instaurando una gerarchia basata sull'apparenza (il mio avatar poco personalizzato era chiaramente appartenente a un \"niubbo\"); c'era un notevole mercato di vestiti e accessori virtuali, tra cui una vasta gamma di falli da aggiungere al proprio avatar e di script di sesso simulato da comprare. NEXT.\n\nMolto tempo dopo ho sentito parlare di Minecraft. Altro mondo virtuale, meccanismo di costruzione basato sui mattoncini un po' come il Lego: difficilmente si pensa al sesso quando il mondo e gli avatar sono fatti a cubetti. Effetto collaterale: proprio come il Lego, un gioco che pare per bambini è diventato un culto anche fra i grandi, alcuni dei quali hanno realizzato opere monumentali davvero stupende.\n\nNon so se i creatori del gioco avessero pensato in anticipo a quali avrebbero potuto essere le conseguenze, tuttavia questo tipo di fenomeni mi fa pensare che quando si vuole ottenere qualcosa, soprattutto nel mondo delle app e del mercato consumer in generale, si deve prestare molta attenzione se non proprio **pianificare accuratamente gli effetti collaterali**, in modo non solo da controllarne alcuni ma anche di favorirne altri. Vuoi ottenere `X`? Non creare un'app per ottenere `X`, crea un'app con cui ottieni `Y` e che come effetto collaterale ti faccia ottenere anche `X`.\n\nVoglio creare un'app ludica che consenta a tutto il mondo di conoscere nuove persone, fare amicizia, magari trovare l'anima gemella. La realizzo, funziona bene, è un'app che sfrutta il GPS del telefonino per farmi uscire di casa a conquistare punti nevralgici per la mia fazione.\n\nLa chiamo Ingress.\n\nNon funziona, non se la fila nessuno. Allora faccio una partnership con Nintendo e la chiamo Pokémon Go. Due soli avatar disponibili molto poco sessuati (un ragazzino e una ragazzina ben coperti), tanti piccoli mostriciattoli colorati da catturare che sono la gioia dei più piccini e forniscono l'elemento nostalgia ai più grandicelli. L'account rimane anonimo, ma stavolta ci metti la faccia. E una faccia che pregusta la cattura di un pupazzetto per strada in fondo è una bella faccia, spensierata e soprattutto innocua.\n\nE di lì a poco, in mezzo alle cronache di gente così fissata o distratta da farsi male (ma questo succedeva già ai tempi degli SMS), si leggono anche storie di amicizie nate cercando Pokémon in giro, di ragazzi che si staccano dalla console per passare molto più tempo a giocare fuori e socializzare, di gente che trova il pretesto per fare un po' di movimento e tenersi in forma, di bambini autistici che riescono ad avere interazioni con altri bambini. Non male come Effetto Collaterale\u0026trade;, eh?\n\n    # IceOnFire\n"},{"data":{"title":"Componenti react/redux come librerie","description":"Qualche trucchetto per creare una libreria con Redux, violando la Singola Sorgente di Verità.","author":"IceOnFire","_entry":"posts/blog/2016-11-16-componenti-react-redux-come-librerie.md","page":"post","name":"componenti-react-redux-come-librerie","category":"blog","date":"2016-11-16T00:00:00.000Z","url":"/blog/componenti-react-redux-come-librerie"},"content":{"type":"root","children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"L'ecosistema creato da Facebook sta tirando fuori un gioiellino dopo l'altro: dopo "},{"type":"element","tagName":"a","properties":{"href":"https://facebook.github.io/react/"},"children":[{"type":"text","value":"react"}]},{"type":"text","value":" e "},{"type":"element","tagName":"a","properties":{"href":"http://redux.js.org/"},"children":[{"type":"text","value":"redux"}]},{"type":"text","value":" di recente è anche uscito "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/facebookincubator/create-react-app"},"children":[{"type":"text","value":"create-react-app"}]},{"type":"text","value":", che permette di arrivare da zero ad app funzionante in un unico comando. Ma che succede se vogliamo pubblicare un componente React da usare come libreria per altri progetti? E se lo stato del componente fosse così complesso da richiedere un contenitore di stati come Redux? Queste sono le domande che mi sono dovuto porre quando ho creato "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/IngloriousCoderz/react-property-grid"},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"react-property-grid"}]}]},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Affrontiamo le domande una per volta."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Si può usare create-react-app per pubblicare librerie invece che app? Nì. Al momento in cui scrivo, "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"create-react-app"}]},{"type":"text","value":" è pensato per le app e "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/facebookincubator/create-react-app/issues/423#issuecomment-250752431"},"children":[{"type":"text","value":"non intende gestire la creazione di librerie nel breve tempo"}]},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Tuttavia la comodità di "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"create-react-app"}]},{"type":"text","value":" rende difficile rinunciarci e fortunatamente gli script che include sono molto ben fatti e documentati, perciò quello che consiglio è di:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"creare il progetto con "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"create-react-app"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\"espellerlo\" con "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"npm run eject"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"modificare il "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"webpack.config.prod.dll"}]},{"type":"text","value":" in modo che produca una libreria"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Purtroppo il processo di "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"eject"}]},{"type":"text","value":", essendo irreversibile, ci impedisce di rimanere facilmente al passo con versioni future dei "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"react-scripts"}]},{"type":"text","value":", ma in assenza di soluzioni migliori al momento il gioco vale la candela."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Il terzo punto consiste nel produrre un file simile a quello che si trova "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/IngloriousCoderz/react-property-grid/blob/master/config/webpack.config.prod.js"},"children":[{"type":"text","value":"qui"}]},{"type":"text","value":", in particolare:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"output"}]},{"type":"text","value":" specifica un nome di file ben preciso e un nome per la libreria"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-js"]},"children":[{"type":"text","value":"output: {\n  path: paths.appBuild,\n  filename: 'index.js',\n  library: 'react-property-grid',\n  libraryTarget: 'umd'\n}\n"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"externals"}]},{"type":"text","value":" dichiara tutte le dipendenze che non vogliamo includere nel bundle, ma vogliamo richiamarle come peer dependencies:"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-js"]},"children":[{"type":"text","value":"externals: {\n  'json-schema-deref-local': 'json-schema-deref-local',\n  'jsonpath': 'jsonpath',\n  'react': 'react',\n  'react-dom': 'react-dom',\n  'react-redux': 'react-redux',\n  'react-sortable-hoc': 'react-sortable-hoc',\n  'react-throttle': 'react-throttle',\n  'redux': 'redux',\n  'tv4': 'tv4',\n  'uuid': 'uuid'\n}\n"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"come fatto per la parte JavaScript, anche un eventuale CSS acquista un nome preciso; la parte HTML invece viene spenta:"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-js"]},"children":[{"type":"text","value":"plugins: [\n  // new HtmlWebpackPlugin({...}),\n  ...,\n  new ExtractTextPlugin('index.css')\n]\n"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"a questo punto senza altre modifiche il progetto viene compilato come un "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"index.js"}]},{"type":"text","value":" e un "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"index.css"}]},{"type":"text","value":" nella directory "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"build"}]},{"type":"text","value":". Se invece vogliamo modificare la directory di destinazione, possiamo farlo in "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"paths.js"}]},{"type":"text","value":":"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-js"]},"children":[{"type":"text","value":"module.exports = {\n  appBuild: resolveApp('dist'),//resolveApp('build'),\n  ...\n};\n"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"infine modifichiamo il nostro "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"package.json"}]},{"type":"text","value":" in modo che si comporti come una libreria:"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-js"]},"children":[{"type":"text","value":"{\n  \"name\": \"react-property-grid\",\n  \"version\": \"0.1.0\",\n  \"main\": \"dist/index.js\",\n  \"scripts\": {\n    \"prepublish\": \"npm run build\",\n    ...\n  },\n  ...\n}\n"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Lo script "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"prepublish"}]},{"type":"text","value":" fa un build appena prima di pubblicare il progetto su npm, pertanto fa in modo che non dobbiamo tenerci nel repository la directory "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"dist"}]},{"type":"text","value":". Possiamo quindi aggiungere questa directory nel "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":".gitignore"}]},{"type":"text","value":" (ma stiamo attenti a non metterla nel "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":".npmignore"}]},{"type":"text","value":", altrimenti NPM si terrà solo i sorgenti e non la libreria vera e propria)."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"E questa era la parte facile."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"La parte difficile è stabilire dove tenere lo stato del componente: dato che uno dei punti cardine di redux è la "},{"type":"element","tagName":"a","properties":{"href":"http://redux.js.org/docs/introduction/ThreePrinciples.html#single-source-of-truth"},"children":[{"type":"text","value":"singola sorgente di verità"}]},{"type":"text","value":", verrebbe da tentare di esporre nella libreria un riduttore da agganciare allo store dell'app che la ospita. Tuttavia, oltre che essere un'operazione molto macchinosa, non porta alcun vero vantaggio. Anzi, Lo stato di "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"react-property-grid"}]},{"type":"text","value":" interessa solo a "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"react-property-grid"}]},{"type":"text","value":", e l'app è solo interessata al suo output finale."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"La soluzione è una violazione al principio di unica sorgente di verità: la root del componente di libreria avrà il suo store personale. Questo comportamento è descritto anche nel sito di redux come "},{"type":"element","tagName":"a","properties":{"href":"http://redux.js.org/docs/recipes/IsolatingSubapps.html"},"children":[{"type":"text","value":"Isolating Redux Sub-Apps"}]},{"type":"text","value":": in circostanze molto specifiche (come la nostra) è concesso di disporre di più di uno store."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Il trucco consiste nell'istanziare lo store nel costruttore del componente, in modo che ce ne sia solo uno per ogni istanza del componente. Aggiungo un pezzo:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-js"]},"children":[{"type":"text","value":"class SubApp extends Component {\n  constructor(props) {\n    super(props)\n    this.store = createStore(reducer)\n\n    this.store.subscribe(() =\u003e {\n      const state = this.store.getState()\n      props.onChange(state.data)\n    })\n\n    this.store.dispatch(init(props.data))\n  }\n\n  componentWillUpdate(nextProps) {\n    this.store.dispatch(init(nextProps.data))\n  }\n\n  render() {\n    return (\n      \u003cProvider store={this.store}\u003e\n        \u003cApp /\u003e\n      \u003c/Provider\u003e\n    )\n  }\n}\n"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Come si può notare lo stato viene inizializzato nel costruttore grazie a un apposito actionCreator e viene aggiornato a ogni nuova proprietà (ovviamente si possono limitare gli aggiornamenti con il solito metodo "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"shouldComponentUpdate(nextProps)"}]},{"type":"text","value":"). Per comunicare con l'esterno si può aggiungere allo store un listener che chiama una funzione onChange definita altrove."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Infine un'altra cosa che non viene citata nell'articolo è il caso in cui la parent app abbia anch'essa uno store: in questo caso per evitare conflitti suggerisco di aggiungere "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/emmenko/react-redux-custom-store"},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"react-redux-custom-store"}]}]},{"type":"text","value":", che permette di associare un nome univoco a ogni store del sistema."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Se si usa "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/zalmoxisus/redux-devtools-extension"},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"redux-devtools-extension"}]}]},{"type":"text","value":" bisogna tenere presente che ora gli store sono due, e si possono selezionare dal menù a tendina in alto a destra con la dicitura \"Autoselect instances\", che purtroppo al momento mostra due istanze con lo stesso nome anziché usare il nome custom che abbiamo definito:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"img","properties":{"src":"/static/images/blog/store-instances.png","alt":"store multipli in redux-devtools-extension"},"children":[]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Speriamo che un giorno Facebook cerchi di rendere la vita più semplice non solo agli sviluppatori di app ma anche ai produttori di librerie. Nel frattempo non possiamo far altro che apprezzare l'enorme sforzo che già stanno facendo e magari contribuire, documentando best practice o creare noi stessi una "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"create-react-lib"}]},{"type":"text","value":"!"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"# IceOnFire\n"}]}]}],"data":{"quirksMode":false}},"raw":"\nL'ecosistema creato da Facebook sta tirando fuori un gioiellino dopo l'altro: dopo [react](https://facebook.github.io/react/) e [redux](http://redux.js.org/) di recente è anche uscito [create-react-app](https://github.com/facebookincubator/create-react-app), che permette di arrivare da zero ad app funzionante in un unico comando. Ma che succede se vogliamo pubblicare un componente React da usare come libreria per altri progetti? E se lo stato del componente fosse così complesso da richiedere un contenitore di stati come Redux? Queste sono le domande che mi sono dovuto porre quando ho creato [`react-property-grid`](https://github.com/IngloriousCoderz/react-property-grid).\n\nAffrontiamo le domande una per volta.\n\nSi può usare create-react-app per pubblicare librerie invece che app? Nì. Al momento in cui scrivo, `create-react-app` è pensato per le app e [non intende gestire la creazione di librerie nel breve tempo](https://github.com/facebookincubator/create-react-app/issues/423#issuecomment-250752431).\n\nTuttavia la comodità di `create-react-app` rende difficile rinunciarci e fortunatamente gli script che include sono molto ben fatti e documentati, perciò quello che consiglio è di:\n\n1. creare il progetto con `create-react-app`\n2. \"espellerlo\" con `npm run eject`\n3. modificare il `webpack.config.prod.dll` in modo che produca una libreria\n\nPurtroppo il processo di `eject`, essendo irreversibile, ci impedisce di rimanere facilmente al passo con versioni future dei `react-scripts`, ma in assenza di soluzioni migliori al momento il gioco vale la candela.\n\nIl terzo punto consiste nel produrre un file simile a quello che si trova [qui](https://github.com/IngloriousCoderz/react-property-grid/blob/master/config/webpack.config.prod.js), in particolare:\n\n- `output` specifica un nome di file ben preciso e un nome per la libreria\n\n```js\noutput: {\n  path: paths.appBuild,\n  filename: 'index.js',\n  library: 'react-property-grid',\n  libraryTarget: 'umd'\n}\n```\n\n- `externals` dichiara tutte le dipendenze che non vogliamo includere nel bundle, ma vogliamo richiamarle come peer dependencies:\n\n```js\nexternals: {\n  'json-schema-deref-local': 'json-schema-deref-local',\n  'jsonpath': 'jsonpath',\n  'react': 'react',\n  'react-dom': 'react-dom',\n  'react-redux': 'react-redux',\n  'react-sortable-hoc': 'react-sortable-hoc',\n  'react-throttle': 'react-throttle',\n  'redux': 'redux',\n  'tv4': 'tv4',\n  'uuid': 'uuid'\n}\n```\n\n- come fatto per la parte JavaScript, anche un eventuale CSS acquista un nome preciso; la parte HTML invece viene spenta:\n\n```js\nplugins: [\n  // new HtmlWebpackPlugin({...}),\n  ...,\n  new ExtractTextPlugin('index.css')\n]\n```\n\n- a questo punto senza altre modifiche il progetto viene compilato come un `index.js` e un `index.css` nella directory `build`. Se invece vogliamo modificare la directory di destinazione, possiamo farlo in `paths.js`:\n\n```js\nmodule.exports = {\n  appBuild: resolveApp('dist'),//resolveApp('build'),\n  ...\n};\n```\n\n- infine modifichiamo il nostro `package.json` in modo che si comporti come una libreria:\n\n```js\n{\n  \"name\": \"react-property-grid\",\n  \"version\": \"0.1.0\",\n  \"main\": \"dist/index.js\",\n  \"scripts\": {\n    \"prepublish\": \"npm run build\",\n    ...\n  },\n  ...\n}\n```\n\nLo script `prepublish` fa un build appena prima di pubblicare il progetto su npm, pertanto fa in modo che non dobbiamo tenerci nel repository la directory `dist`. Possiamo quindi aggiungere questa directory nel `.gitignore` (ma stiamo attenti a non metterla nel `.npmignore`, altrimenti NPM si terrà solo i sorgenti e non la libreria vera e propria).\n\nE questa era la parte facile.\n\nLa parte difficile è stabilire dove tenere lo stato del componente: dato che uno dei punti cardine di redux è la [singola sorgente di verità](http://redux.js.org/docs/introduction/ThreePrinciples.html#single-source-of-truth), verrebbe da tentare di esporre nella libreria un riduttore da agganciare allo store dell'app che la ospita. Tuttavia, oltre che essere un'operazione molto macchinosa, non porta alcun vero vantaggio. Anzi, Lo stato di `react-property-grid` interessa solo a `react-property-grid`, e l'app è solo interessata al suo output finale.\n\nLa soluzione è una violazione al principio di unica sorgente di verità: la root del componente di libreria avrà il suo store personale. Questo comportamento è descritto anche nel sito di redux come [Isolating Redux Sub-Apps](http://redux.js.org/docs/recipes/IsolatingSubapps.html): in circostanze molto specifiche (come la nostra) è concesso di disporre di più di uno store.\n\nIl trucco consiste nell'istanziare lo store nel costruttore del componente, in modo che ce ne sia solo uno per ogni istanza del componente. Aggiungo un pezzo:\n\n```js\nclass SubApp extends Component {\n  constructor(props) {\n    super(props)\n    this.store = createStore(reducer)\n\n    this.store.subscribe(() =\u003e {\n      const state = this.store.getState()\n      props.onChange(state.data)\n    })\n\n    this.store.dispatch(init(props.data))\n  }\n\n  componentWillUpdate(nextProps) {\n    this.store.dispatch(init(nextProps.data))\n  }\n\n  render() {\n    return (\n      \u003cProvider store={this.store}\u003e\n        \u003cApp /\u003e\n      \u003c/Provider\u003e\n    )\n  }\n}\n```\n\nCome si può notare lo stato viene inizializzato nel costruttore grazie a un apposito actionCreator e viene aggiornato a ogni nuova proprietà (ovviamente si possono limitare gli aggiornamenti con il solito metodo `shouldComponentUpdate(nextProps)`). Per comunicare con l'esterno si può aggiungere allo store un listener che chiama una funzione onChange definita altrove.\n\nInfine un'altra cosa che non viene citata nell'articolo è il caso in cui la parent app abbia anch'essa uno store: in questo caso per evitare conflitti suggerisco di aggiungere [`react-redux-custom-store`](https://github.com/emmenko/react-redux-custom-store), che permette di associare un nome univoco a ogni store del sistema.\n\nSe si usa [`redux-devtools-extension`](https://github.com/zalmoxisus/redux-devtools-extension) bisogna tenere presente che ora gli store sono due, e si possono selezionare dal menù a tendina in alto a destra con la dicitura \"Autoselect instances\", che purtroppo al momento mostra due istanze con lo stesso nome anziché usare il nome custom che abbiamo definito:\n\n![store multipli in redux-devtools-extension](/static/images/blog/store-instances.png)\n\nSperiamo che un giorno Facebook cerchi di rendere la vita più semplice non solo agli sviluppatori di app ma anche ai produttori di librerie. Nel frattempo non possiamo far altro che apprezzare l'enorme sforzo che già stanno facendo e magari contribuire, documentando best practice o creare noi stessi una `create-react-lib`!\n\n    # IceOnFire\n"},{"data":{"title":"Migliorare il codice con il currying","description":"La programmazione funzionale sta tornando in auge, e ha i suoi buoni motivi.","author":"Giosk","_entry":"posts/blog/2018-02-08-migliorare-il-codice-con-il-currying.md","page":"post","name":"migliorare-il-codice-con-il-currying","category":"blog","date":"2018-02-08T00:00:00.000Z","url":"/blog/migliorare-il-codice-con-il-currying"},"content":{"type":"root","children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Oggi mi sono trovato davanti a un problema a prima vista molto semplice da realizzare, ma il cui risultato si è rivelato orribile e per niente ottimale.\nIl problema si descrive molto facilmente in linguaggio naturale \"calcolare la differenza tra due liste A e B\".\nFacile no? A prima vista sì, ma scendendo nel tecnico si è rivelato un po' più ostico del previsto, perché le mie due liste erano composte da oggetti, ognuno con più di un parametro e una chiave generata in modo randomico, quindi il problema andrebbe riformulato come \"calcolare la differenza tra due liste di oggetti A e B basandosi su uno dei suoi parametri\"."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Parlando in JavaScript:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-js"]},"children":[{"type":"text","value":"let nodesA = [\n  { a: '1', b: '1' },\n  { a: '2', b: '2' },\n  { a: '3', b: '3' },\n  { a: '4', b: '4' },\n  { a: '5', b: '5' },\n]\nlet nodesB = [\n  { a: '1', b: '6' },\n  { a: '2', b: '7' },\n  { a: '3', b: '8' },\n  { a: '6', b: '9' },\n  { a: '7', b: '10' },\n  { a: '8', b: '11' },\n]\n"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Come fare dunque a ottenere come risultato nodesA / nodesB, basandosi sul parametro a?"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Questa è la prima versione a cui ho pensato:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-js"]},"children":[{"type":"text","value":"let result = []\nnodesB.forEach((nb) =\u003e {\n  let supportArr = []\n  nodesA.forEach((na) =\u003e {\n    supportArr.push(na.a)\n  })\n  const notInNodesA = supportArr.indexOf(nb.a) === -1\n  if (notInNodesA) {\n    result.push(nb)\n  }\n})\n"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"È davvero brutta lo so, è quadratica quindi non ottimale ed è anche un po' scomoda da utilizzare, quindi ho dovuto per forza RIFATTORIZZARE.\nInizialmente mi sono messo in testa di usare il filter e la map, ma non riuscivo a incastrare le cose come volevo (ottenevo o troppi dati o quelli che non mi interessavano) e nella mia ricerca mi sono imbattuto nel concetto di "},{"type":"element","tagName":"a","properties":{"href":"https://en.wikipedia.org/wiki/Currying"},"children":[{"type":"text","value":"currying"}]},{"type":"text","value":" visto all'università, ma mai utilizzato in pratica.\nLa definizione più semplice e immediata l'ho trovata su "},{"type":"element","tagName":"a","properties":{"href":"https://stackoverflow.com/questions/36314/what-is-currying"},"children":[{"type":"text","value":"StackOverflow"}]},{"type":"text","value":" e poi con l'aiuto di un bel post trovato "},{"type":"element","tagName":"a","properties":{"href":"https://medium.com/@kbrainwave/currying-in-javascript-ce6da2d324fe"},"children":[{"type":"text","value":"qua"}]},{"type":"text","value":" sono riuscito dopo un po' di tentativi ed errori a giungere a questo risultato."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Ho definito la funzione "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"nodeCompare"}]},{"type":"text","value":" in questo modo:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-js"]},"children":[{"type":"text","value":"const nodeCompare = (otherArray) =\u003e {\n  return (current) =\u003e {\n    return (\n      otherArray.filter((other) =\u003e {\n        return other.a === current.a\n      }).length === 0\n    )\n  }\n}\n"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"e poi l'ho utilizzata così:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-js"]},"children":[{"type":"text","value":"const difference = nodesB.filter(nodeCompare(nodesA))\n"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Ho quindi applicato all'array "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"nodesB"}]},{"type":"text","value":" un filtro che riceve come callback "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"nodeCompare"}]},{"type":"text","value":".\nLa funzione nodeCompare riceve come parametro l'array "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"nodesA"}]},{"type":"text","value":" che restituisce a sua volta il risultato di un filtro applicato sul "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"nodesB"}]},{"type":"text","value":", e se il risultato è vuoto o pieno mi restituirà "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"true"}]},{"type":"text","value":" o "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"false"}]},{"type":"text","value":" permettendo al primo filter lanciato di decidere se il valore è di mio interesse oppure no.\nUn salto di qualità notevole dopo la prima versione!"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Spero con questo piccolo post di aver aiutato qualcuno o anche semplicemente spronato al REFACTORING, cosa che noi Inglorious Coders diciamo di fare sempre!"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"# Giosk\n"}]}]}],"data":{"quirksMode":false}},"raw":"\nOggi mi sono trovato davanti a un problema a prima vista molto semplice da realizzare, ma il cui risultato si è rivelato orribile e per niente ottimale.\nIl problema si descrive molto facilmente in linguaggio naturale \"calcolare la differenza tra due liste A e B\".\nFacile no? A prima vista sì, ma scendendo nel tecnico si è rivelato un po' più ostico del previsto, perché le mie due liste erano composte da oggetti, ognuno con più di un parametro e una chiave generata in modo randomico, quindi il problema andrebbe riformulato come \"calcolare la differenza tra due liste di oggetti A e B basandosi su uno dei suoi parametri\".\n\nParlando in JavaScript:\n\n```js\nlet nodesA = [\n  { a: '1', b: '1' },\n  { a: '2', b: '2' },\n  { a: '3', b: '3' },\n  { a: '4', b: '4' },\n  { a: '5', b: '5' },\n]\nlet nodesB = [\n  { a: '1', b: '6' },\n  { a: '2', b: '7' },\n  { a: '3', b: '8' },\n  { a: '6', b: '9' },\n  { a: '7', b: '10' },\n  { a: '8', b: '11' },\n]\n```\n\nCome fare dunque a ottenere come risultato nodesA / nodesB, basandosi sul parametro a?\n\nQuesta è la prima versione a cui ho pensato:\n\n```js\nlet result = []\nnodesB.forEach((nb) =\u003e {\n  let supportArr = []\n  nodesA.forEach((na) =\u003e {\n    supportArr.push(na.a)\n  })\n  const notInNodesA = supportArr.indexOf(nb.a) === -1\n  if (notInNodesA) {\n    result.push(nb)\n  }\n})\n```\n\nÈ davvero brutta lo so, è quadratica quindi non ottimale ed è anche un po' scomoda da utilizzare, quindi ho dovuto per forza RIFATTORIZZARE.\nInizialmente mi sono messo in testa di usare il filter e la map, ma non riuscivo a incastrare le cose come volevo (ottenevo o troppi dati o quelli che non mi interessavano) e nella mia ricerca mi sono imbattuto nel concetto di [currying](https://en.wikipedia.org/wiki/Currying) visto all'università, ma mai utilizzato in pratica.\nLa definizione più semplice e immediata l'ho trovata su [StackOverflow](https://stackoverflow.com/questions/36314/what-is-currying) e poi con l'aiuto di un bel post trovato [qua](https://medium.com/@kbrainwave/currying-in-javascript-ce6da2d324fe) sono riuscito dopo un po' di tentativi ed errori a giungere a questo risultato.\n\nHo definito la funzione `nodeCompare` in questo modo:\n\n```js\nconst nodeCompare = (otherArray) =\u003e {\n  return (current) =\u003e {\n    return (\n      otherArray.filter((other) =\u003e {\n        return other.a === current.a\n      }).length === 0\n    )\n  }\n}\n```\n\ne poi l'ho utilizzata così:\n\n```js\nconst difference = nodesB.filter(nodeCompare(nodesA))\n```\n\nHo quindi applicato all'array `nodesB` un filtro che riceve come callback `nodeCompare`.\nLa funzione nodeCompare riceve come parametro l'array `nodesA` che restituisce a sua volta il risultato di un filtro applicato sul `nodesB`, e se il risultato è vuoto o pieno mi restituirà `true` o `false` permettendo al primo filter lanciato di decidere se il valore è di mio interesse oppure no.\nUn salto di qualità notevole dopo la prima versione!\n\nSpero con questo piccolo post di aver aiutato qualcuno o anche semplicemente spronato al REFACTORING, cosa che noi Inglorious Coders diciamo di fare sempre!\n\n```\n# Giosk\n```\n"},{"data":{"title":"Loopback 4 è un porting di Spring Boot","description":"IBM ha rovinato un bellissimo prodotto, è ora di cercare altrove.","author":"IceOnFire","_entry":"posts/blog/2018-10-23-loopback-porting-di-spring-boot.md","page":"post","name":"loopback-porting-di-spring-boot","category":"blog","date":"2018-10-23T00:00:00.000Z","url":"/blog/loopback-porting-di-spring-boot"},"content":{"type":"root","children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Se c'è una cosa buona che il "},{"type":"element","tagName":"a","properties":{"href":"https://medium.com/@ericclemmons/javascript-fatigue-48d4011b6fc4"},"children":[{"type":"text","value":"faticoso ecosistema JavaScript"}]},{"type":"text","value":" ha portato nelle nostre vite è un ritorno alla "},{"type":"element","tagName":"a","properties":{"href":"https://codeburst.io/functional-programming-in-javascript-e57e7e28c0e5"},"children":[{"type":"text","value":"programmazione funzionale"}]},{"type":"text","value":". Dopo anni e anni a scervellarsi su oggetti, classi e design pattern, Facebook con i suoi "},{"type":"element","tagName":"a","properties":{"href":"https://reactjs.org/"},"children":[{"type":"text","value":"React"}]},{"type":"text","value":" e "},{"type":"element","tagName":"a","properties":{"href":"https://redux.js.org/"},"children":[{"type":"text","value":"Redux"}]},{"type":"text","value":" ci ha convinti a fare marcia indietro e riconsiderare le funzioni pure, l'immutabilità e la composizione a scapito dell'ereditarietà, delle annotation e della dependency injection. A un tratto il codice diventa potente, performante, leggibile e testabile come non lo è mai stato, e la programmazione orientata agli oggetti (o meglio, alle classi) pare solo un brutto ricordo."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Questo almeno per quanto riguarda il front end. E sul back end? Personalmente per progetti un po' più complessi la mia scelta è ricaduta su "},{"type":"element","tagName":"a","properties":{"href":"https://loopback.io/"},"children":[{"type":"text","value":"Loopback 3"}]},{"type":"text","value":", framework di "},{"type":"element","tagName":"a","properties":{"href":"https://strongloop.com/"},"children":[{"type":"text","value":"Strongloop"}]},{"type":"text","value":" (poi acquisita da "},{"type":"element","tagName":"a","properties":{"href":"https://www.ibm.com/"},"children":[{"type":"text","value":"IBM"}]},{"type":"text","value":") che, essendo fortemente basato su "},{"type":"element","tagName":"a","properties":{"href":"https://expressjs.com/"},"children":[{"type":"text","value":"Express"}]},{"type":"text","value":", riesce a rendere la creazione di un server Node immediata e la sua personalizzazione perlomeno fattibile. Basta definire un modello in un linguaggio che sostanzialmente è un'estensione di "},{"type":"element","tagName":"a","properties":{"href":"https://json-schema.org/"},"children":[{"type":"text","value":"JSON Schema"}]},{"type":"text","value":" e si ha automaticamente un servizio REST che fa tutte le operazioni CRUD sul database. Se poi si vogliono definire funzioni custom si possono creare degli hook a vari livelli dell'architettura, oppure dei middleware in stile Express."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Non vedevo l'ora, quindi, di mettere le mani sulla "},{"type":"element","tagName":"a","properties":{"href":"http://v4.loopback.io/"},"children":[{"type":"text","value":"versione 4 di Loopback"}]},{"type":"text","value":", uscita ufficialmente il "},{"type":"element","tagName":"a","properties":{"href":"https://strongloop.com/strongblog/loopback-4-ga"},"children":[{"type":"text","value":"10 ottobre 2018"}]},{"type":"text","value":". Mi aspettavo più potenza, una migliore documentazione, magari il supporto nativo a GraphQL. Ma soprattutto che rimanesse semplice ed elegante com'era. E invece proprio quest'ultimo punto è stato uno stravoglimento totale, per me incomprensibile. Loopback 4 fa uso di "},{"type":"element","tagName":"a","properties":{"href":"https://www.typescriptlang.org/"},"children":[{"type":"text","value":"TypeScript"}]},{"type":"text","value":" (e vabbè, se proprio non potete fare a meno della tipizzazione statica), dei decoratori (e vabbè, basta non abusarne), delle classi (taaaante classi) e ha addirittura un suo sistema di dependency injection!"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Da una parte sembra il miglior amico di "},{"type":"element","tagName":"a","properties":{"href":"https://angular.io/"},"children":[{"type":"text","value":"Angular"}]},{"type":"text","value":", framework che non riesco proprio a digerire, dall'altra sembra un porting di "},{"type":"element","tagName":"a","properties":{"href":"http://spring.io/projects/spring-boot"},"children":[{"type":"text","value":"Spring Boot"}]},{"type":"text","value":". Pare come se i Javisti si fossero riversati nel salotto JavaScript e avessero detto: \"Non mi piace qui, dobbiamo riarredare\"."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Un esempio? Questo è il codice necessario a definire una relazione uno-a-molti in Loopback 3:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-json"]},"children":[{"type":"text","value":"{\n  \"name\": \"TodoList\",\n  \"base\": \"PersistedModel\",\n  \"relations\": {\n    \"todos\": {\n      \"type\": \"hasMany\",\n      \"model\": \"Todo\",\n      \"foreignKey\": \"todoListId\"\n    }\n  }\n}\n"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Ecco lo stesso tipo di relazione definito in Loopback 4:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-js"]},"children":[{"type":"text","value":"import {\n  DefaultCrudRepository,\n  HasManyRepositoryFactory,\n  repository,\n} from '@loopback/repository';\nimport {TodoList, Todo} from '../models';\nimport {DbDataSource} from '../datasources';\nimport {inject, Getter} from '@loopback/core';\nimport {TodoRepository} from './todo.repository';\n\nexport class TodoListRepository extends DefaultCrudRepository\u003c\n  TodoList,\n  typeof TodoList.prototype.id\n\u003e {\n  public readonly todos: HasManyRepositoryFactory\u003c\n    Todo,\n    typeof TodoList.prototype.id\n  \u003e;\n\n  constructor(\n    @inject('datasources.db') dataSource: DbDataSource,\n    @repository.getter(TodoRepository)\n    protected todoRepositoryGetter: Getter\u003cTodoRepository\u003e,\n  ) {\n    super(TodoList, dataSource);\n    this.todos = this._createHasManyRepositoryFactoryFor(\n      'todos',\n      todoRepositoryGetter,\n    );\n  }\n}\n"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"L'esempio è preso dal "},{"type":"element","tagName":"a","properties":{"href":"https://loopback.io/doc/en/lb4/todo-list-tutorial-repository.html"},"children":[{"type":"text","value":"tutorial ufficiale"}]},{"type":"text","value":", che al momento in cui scrivo è anche errato (ho dovuto aggiustare guardando il "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/strongloop/loopback-next/blob/master/examples/todo-list/src/repositories/todo-list.repository.ts"},"children":[{"type":"text","value":"sorgente degli esempi"}]},{"type":"text","value":")."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Inoltre per creare un unico endpoint REST è necessario:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Creare una classe di modello"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Creare una classe datasource"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Creare una classe repository"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Creare una classe controller"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"La classe modello descrive le proprietà del modello tramite attributi di istanza e decoratori, mentre prima bastava un po' di JSON."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"La classe datasource serve solo a iniettare la configurazione JSON simile a quella che c'era in Loopback 3."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"La classe repository serve solo a iniettare la classe datasource."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"La classe controller espone tutti i metodi CRUD di base, oportunamente decorati, risultando in circa 130 righe di codice quando in Loopback 3 ne servivano 0."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Parafrasando Bender, mi viene voglia di creare un Loopback tutto mio, con blackjack e squillo di lusso. Anzi, senza blackjack e neanche le squillo, ma almeno più funzionale."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"# IceOnFire\n"}]}]}],"data":{"quirksMode":false}},"raw":"\nSe c'è una cosa buona che il [faticoso ecosistema JavaScript](https://medium.com/@ericclemmons/javascript-fatigue-48d4011b6fc4) ha portato nelle nostre vite è un ritorno alla [programmazione funzionale](https://codeburst.io/functional-programming-in-javascript-e57e7e28c0e5). Dopo anni e anni a scervellarsi su oggetti, classi e design pattern, Facebook con i suoi [React](https://reactjs.org/) e [Redux](https://redux.js.org/) ci ha convinti a fare marcia indietro e riconsiderare le funzioni pure, l'immutabilità e la composizione a scapito dell'ereditarietà, delle annotation e della dependency injection. A un tratto il codice diventa potente, performante, leggibile e testabile come non lo è mai stato, e la programmazione orientata agli oggetti (o meglio, alle classi) pare solo un brutto ricordo.\n\nQuesto almeno per quanto riguarda il front end. E sul back end? Personalmente per progetti un po' più complessi la mia scelta è ricaduta su [Loopback 3](https://loopback.io/), framework di [Strongloop](https://strongloop.com/) (poi acquisita da [IBM](https://www.ibm.com/)) che, essendo fortemente basato su [Express](https://expressjs.com/), riesce a rendere la creazione di un server Node immediata e la sua personalizzazione perlomeno fattibile. Basta definire un modello in un linguaggio che sostanzialmente è un'estensione di [JSON Schema](https://json-schema.org/) e si ha automaticamente un servizio REST che fa tutte le operazioni CRUD sul database. Se poi si vogliono definire funzioni custom si possono creare degli hook a vari livelli dell'architettura, oppure dei middleware in stile Express.\n\nNon vedevo l'ora, quindi, di mettere le mani sulla [versione 4 di Loopback](http://v4.loopback.io/), uscita ufficialmente il [10 ottobre 2018](https://strongloop.com/strongblog/loopback-4-ga). Mi aspettavo più potenza, una migliore documentazione, magari il supporto nativo a GraphQL. Ma soprattutto che rimanesse semplice ed elegante com'era. E invece proprio quest'ultimo punto è stato uno stravoglimento totale, per me incomprensibile. Loopback 4 fa uso di [TypeScript](https://www.typescriptlang.org/) (e vabbè, se proprio non potete fare a meno della tipizzazione statica), dei decoratori (e vabbè, basta non abusarne), delle classi (taaaante classi) e ha addirittura un suo sistema di dependency injection!\n\nDa una parte sembra il miglior amico di [Angular](https://angular.io/), framework che non riesco proprio a digerire, dall'altra sembra un porting di [Spring Boot](http://spring.io/projects/spring-boot). Pare come se i Javisti si fossero riversati nel salotto JavaScript e avessero detto: \"Non mi piace qui, dobbiamo riarredare\".\n\nUn esempio? Questo è il codice necessario a definire una relazione uno-a-molti in Loopback 3:\n\n```json\n{\n  \"name\": \"TodoList\",\n  \"base\": \"PersistedModel\",\n  \"relations\": {\n    \"todos\": {\n      \"type\": \"hasMany\",\n      \"model\": \"Todo\",\n      \"foreignKey\": \"todoListId\"\n    }\n  }\n}\n```\n\nEcco lo stesso tipo di relazione definito in Loopback 4:\n\n```js\nimport {\n  DefaultCrudRepository,\n  HasManyRepositoryFactory,\n  repository,\n} from '@loopback/repository';\nimport {TodoList, Todo} from '../models';\nimport {DbDataSource} from '../datasources';\nimport {inject, Getter} from '@loopback/core';\nimport {TodoRepository} from './todo.repository';\n\nexport class TodoListRepository extends DefaultCrudRepository\u003c\n  TodoList,\n  typeof TodoList.prototype.id\n\u003e {\n  public readonly todos: HasManyRepositoryFactory\u003c\n    Todo,\n    typeof TodoList.prototype.id\n  \u003e;\n\n  constructor(\n    @inject('datasources.db') dataSource: DbDataSource,\n    @repository.getter(TodoRepository)\n    protected todoRepositoryGetter: Getter\u003cTodoRepository\u003e,\n  ) {\n    super(TodoList, dataSource);\n    this.todos = this._createHasManyRepositoryFactoryFor(\n      'todos',\n      todoRepositoryGetter,\n    );\n  }\n}\n```\n\nL'esempio è preso dal [tutorial ufficiale](https://loopback.io/doc/en/lb4/todo-list-tutorial-repository.html), che al momento in cui scrivo è anche errato (ho dovuto aggiustare guardando il [sorgente degli esempi](https://github.com/strongloop/loopback-next/blob/master/examples/todo-list/src/repositories/todo-list.repository.ts)).\n\nInoltre per creare un unico endpoint REST è necessario:\n\n1. Creare una classe di modello\n2. Creare una classe datasource\n3. Creare una classe repository\n4. Creare una classe controller\n\nLa classe modello descrive le proprietà del modello tramite attributi di istanza e decoratori, mentre prima bastava un po' di JSON.\n\nLa classe datasource serve solo a iniettare la configurazione JSON simile a quella che c'era in Loopback 3.\n\nLa classe repository serve solo a iniettare la classe datasource.\n\nLa classe controller espone tutti i metodi CRUD di base, oportunamente decorati, risultando in circa 130 righe di codice quando in Loopback 3 ne servivano 0.\n\nParafrasando Bender, mi viene voglia di creare un Loopback tutto mio, con blackjack e squillo di lusso. Anzi, senza blackjack e neanche le squillo, ma almeno più funzionale.\n\n```\n# IceOnFire\n```\n"},{"data":{"title":"Deutsch Algorithm","description":"Using quantum superposition to guess the kind of a function in sub-exponential time.","author":"IceOnFire","_entry":"posts/blog/2020-04-25-deutsch-algorithm.md","page":"post","name":"deutsch-algorithm","category":"blog","date":"2020-04-25T00:00:00.000Z","url":"/blog/deutsch-algorithm"},"content":{"type":"root","children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"In April 7, 2020 I was introduced to the fundamentals of Quantum Computing, and it was love at first sight. I started studying "},{"type":"element","tagName":"a","properties":{"href":"https://www.python.org/"},"children":[{"type":"text","value":"Python"}]},{"type":"text","value":" and "},{"type":"element","tagName":"a","properties":{"href":"https://qiskit.org/"},"children":[{"type":"text","value":"Qiskit"}]},{"type":"text","value":" and "},{"type":"element","tagName":"a","properties":{"href":"https://jupyter.org/"},"children":[{"type":"text","value":"Jupyter"}]},{"type":"text","value":" notebooks and, after working hard on the basics for a dozen days, I was stuck with the most basic algorithm. But then I worked even harder, and I got it finally. Here is the result of my studies as an exported Jupyter notebook."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"NB: I haven't figured out yet how to use math formulas with "},{"type":"element","tagName":"a","properties":{"href":"https://nextein.now.sh/"},"children":[{"type":"text","value":"Nextein"}]},{"type":"text","value":", sorry for the inconvenience."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-python"]},"children":[{"type":"text","value":"from qiskit import QuantumCircuit, Aer, execute\nfrom qiskit.visualization import plot_histogram, plot_bloch_multivector\nfrom qiskit.quantum_info import Operator\n"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Say we have a function $f$ which takes some zeroes and ones as input and returns 0 or 1 according to some logic. We cannot inspect the function, but we can invoke it as a black box and, based on the output of our experiments, we are able to understand the underlying logic. We call such a function an \"oracle\"."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"A one-bit oracle will only be able to produce the following results:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"$f(0) = 0, f(1) = 0$"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"$f(0) = 1, f(1) = 1$"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"$f(0) = 0, f(1) = 1$"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"$f(0) = 1, f(1) = 0$"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"If the oracle behaves like 1. or 2. it means that whatever input I use I will always obtain the same result: the function is then considered \"constant\" (always zero or always one). If instead it behaves like 3. or 4. it means that sometimes I get 0 and sometimes 1: the function could then be considered \"variable\", although in the more generic algorithm of Deutsch-Josza we use the term \"balanced\" so we are going to use it here too (a balanced function gives 0 for half of the inputs and 1 for the other half, which by the way applies here too)."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Although possibly confusing, we can call these functions for future reference like so:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Zero: always gives 0 (constant)"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"One: always gives 1 (constant)"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Identity: gives the unchanged input (balanced)"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Negation: gives the inverted input (balanced)"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"The Classical Way"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"In order to guess the logic a classical computer would need to call the function twice:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-python"]},"children":[{"type":"text","value":"def guess(f):\n    constant = 0\n    balanced = 1\n\n    if f(0) == 0:\n        if f(1) == 0:\n            return constant # zero\n        elif f(1) == 1:\n            return balanced # identity\n    elif f(0) == 1:\n        if f(1) == 0:\n            return balanced # negation\n        elif f(1) == 1:\n            return constant # one\n\ndef zero(bit):\n    return 0\n\ndef one(bit):\n    return 1\n\ndef identity(bit):\n    return bit\n\ndef negation(bit):\n    return 1 if bit == 0 else 0\n\nprint('Zero is', 'constant' if guess(zero) == 0 else 'balanced')\nprint('One is', 'constant' if guess(one) == 0 else 'balanced')\nprint('Identity is', 'constant' if guess(identity) == 0 else 'balanced')\nprint('Negation is', 'constant' if guess(negation) == 0 else 'balanced')\n"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"Zero is constant\nOne is constant\nIdentity is balanced\nNegation is balanced\n"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The Deutsch algorithm instead guesses if the oracle is constant or balanced with just one call to "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"f"}]},{"type":"text","value":", using the magic of quantum superposition. We will see how, but first we have to redefine the oracle in the quantum world."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"The Oracle"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"We could think that the oracle is a single-qubit gate, with just an input and an output:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"input    +--------+    output\n  |x⟩ ---| oracle |--- |f(x)⟩\n         +--------+\n"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"As "},{"type":"element","tagName":"a","properties":{"href":"https://youtu.be/F_Riqjdh2oM"},"children":[{"type":"text","value":"this YouTube video"}]},{"type":"text","value":" shows, the matrices associated to the four operations we can do on a single qubit are as follows:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Zero (constant): $\\begin{bmatrix}1 \u0026 1\\0 \u0026 0\\end{bmatrix}$"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"One (constant): $\\begin{bmatrix}0 \u0026 0\\1 \u0026 1\\end{bmatrix}$"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Identity (balanced): $\\begin{bmatrix}1 \u0026 0\\0 \u0026 1\\end{bmatrix}$"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Negation (balanced): $\\begin{bmatrix}0 \u0026 1\\1 \u0026 0\\end{bmatrix}$ (equal to the Pauli gate X)"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"However these turn out to be useless, especially the first two since they are not even unitary."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"As any gate in a quantum circuit, the oracle must be reversible (i.e. applying it twice will produce the Identity matrix). That's why we need to convert it into a two-qubits gate: the first qubit is the input value of the function, which isn't supposed to change, and the second qubit usually starts with |0⟩ and will change into the result of the oracle:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":" input    +--------+    input'\n   |x⟩ ---|        |--- |x⟩\n          | oracle |\n   |0⟩ ---|        |--- |f(x)⟩\noutput    +--------+    output'\n"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"Spoiler alert:"}]},{"type":"text","value":" when plugging the oracle in the Deutsch algorithm, "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"output"}]},{"type":"text","value":" will instead be initialized as $|1\\rangle$ and as a side effect "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"input'"}]},{"type":"text","value":" will turn out to be $|0\\rangle$ if the oracle is constant, and $|1\\rangle$ if the oracle is balanced."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-python"]},"children":[{"type":"text","value":"qubits = 2\ninput = 0\noutput = 1\n"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"Defining The Four Operators"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"But how do we implement the four different oracles? One way we could find the unitary matrices instead is by analyzing the expected output. Let's try with Zero:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"$$\nZero \\cdot |00\\rangle = |00\\rangle\\\nZero \\cdot |01\\rangle = |01\\rangle\n$$"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"So the vectors $\\begin{bmatrix}1\\0\\0\\0\\end{bmatrix}$ and $\\begin{bmatrix}0\\1\\0\\0\\end{bmatrix}$ are mapped to themselves. This suggests the following matrix:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"$$\nZero = \\begin{bmatrix}\n1 \u0026 0 \u0026 0 \u0026 0\\\n0 \u0026 1 \u0026 0 \u0026 0\\\n? \u0026 ? \u0026 ? \u0026 ?\\\n? \u0026 ? \u0026 ? \u0026 ?\n\\end{bmatrix}\n$$"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Note that we don't care about the third and fourth rows, so we could just complete the matrix as an Identity."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-python"]},"children":[{"type":"text","value":"zero = Operator([\n    [1, 0, 0, 0],\n    [0, 1, 0, 0],\n    [0, 0, 1, 0],\n    [0, 0, 0, 1]\n])\n"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"This operator corresponds to not doing anthing at all inside the oracle!"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":" input    +------+    input'\n   |x⟩ ---| ---- |--- |x⟩\n          |      |\n   |0⟩ ---| ---- |--- |0⟩\noutput    +------+    output'\n"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Let's try now with One:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"$$\nOne \\cdot |00\\rangle = |10\\rangle\\\nOne \\cdot |01\\rangle = |11\\rangle\n$$"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"So $\\begin{bmatrix}1\\0\\0\\0\\end{bmatrix} \\rightarrow \\begin{bmatrix}0\\0\\1\\0\\end{bmatrix}$ and $\\begin{bmatrix}0\\1\\0\\0\\end{bmatrix} \\rightarrow \\begin{bmatrix}0\\0\\0\\1\\end{bmatrix}$ (first position mapped to third, second position mapped to fourth). This suggests the following matrix:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"$$\nOne = \\begin{bmatrix}\n0 \u0026 0 \u0026 1 \u0026 0\\\n0 \u0026 0 \u0026 0 \u0026 1\\\n1 \u0026 0 \u0026 0 \u0026 0\\\n0 \u0026 1 \u0026 0 \u0026 0\n\\end{bmatrix}\n$$"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-python"]},"children":[{"type":"text","value":"one = Operator([\n    [0, 0, 1, 0],\n    [0, 0, 0, 1],\n    [1, 0, 0, 0],\n    [0, 1, 0, 0]\n])\n"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"This operator corresponds to just putting an X gate on the output!"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":" input    +---------+    input'\n   |x⟩ ---| ------- |--- |x⟩\n          |         |\n   |0⟩ ---| --|X|-- |--- |1⟩\noutput    +---------+    output'\n"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Now for Identity:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"$$\nIdentity \\cdot |00\\rangle = |00\\rangle\\\nIdentity \\cdot |01\\rangle = |11\\rangle\n$$"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"So $\\begin{bmatrix}1\\0\\0\\0\\end{bmatrix} \\rightarrow \\begin{bmatrix}1\\0\\0\\0\\end{bmatrix}$ and $\\begin{bmatrix}0\\1\\0\\0\\end{bmatrix} \\rightarrow \\begin{bmatrix}0\\0\\0\\1\\end{bmatrix}$ (first position mapped to itself, second position mapped to fourth). This suggests the following matrix:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"$$\nIdentity = \\begin{bmatrix}\n1 \u0026 0 \u0026 0 \u0026 0\\\n0 \u0026 0 \u0026 0 \u0026 1\\\n0 \u0026 0 \u0026 1 \u0026 0\\\n0 \u0026 1 \u0026 0 \u0026 0\n\\end{bmatrix}\n$$"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-python"]},"children":[{"type":"text","value":"identity = Operator([\n    [1, 0, 0, 0],\n    [0, 0, 0, 1],\n    [0, 0, 1, 0],\n    [0, 1, 0, 0]\n])\n"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"This operator looks a lot like a CNOT on the output:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":" input    +---------+    input'\n   |x⟩ ---| ---*--- |--- |x⟩\n          |    |    |\n   |0⟩ ---| --|X|-- |--- |0⟩ or |1⟩, depending on |x⟩\noutput    +---------+    output'\n"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"And finally Negation:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"$$\nNegation \\cdot |00\\rangle = |10\\rangle\\\nNegation \\cdot |01\\rangle = |01\\rangle\n$$"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"So $\\begin{bmatrix}1\\0\\0\\0\\end{bmatrix} \\rightarrow \\begin{bmatrix}0\\0\\1\\0\\end{bmatrix}$ and $\\begin{bmatrix}0\\1\\0\\0\\end{bmatrix} \\rightarrow \\begin{bmatrix}0\\0\\0\\1\\end{bmatrix}$ (first position mapped to third, second position mapped to itself). This suggests the following matrix:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"$$\nNegation = \\begin{bmatrix}\n0 \u0026 0 \u0026 1 \u0026 0\\\n0 \u0026 1 \u0026 0 \u0026 0\\\n1 \u0026 0 \u0026 0 \u0026 0\\\n0 \u0026 0 \u0026 0 \u0026 1\n\\end{bmatrix}\n$$"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-python"]},"children":[{"type":"text","value":"negation = Operator([\n    [0, 0, 1, 0],\n    [0, 1, 0, 0],\n    [1, 0, 0, 0],\n    [0, 0, 0, 1]\n])\n"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"This operator could be interpreted as a CNOT on the output, sandwiched by two negations on the input:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":" input    +---------------+    input'\n   |x⟩ ---| --|X|-*-|X|-- |--- |x⟩\n          |       |       |\n   |0⟩ ---| -----|X|----- |--- |1⟩ or |0⟩, depending on |x⟩\noutput    +---------------+    output'\n"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Why is that? Well, if we look at the truth table:"}]},{"type":"text","value":"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n"},{"type":"element","tagName":"table","properties":{},"children":[{"type":"element","tagName":"thead","properties":{},"children":[{"type":"element","tagName":"tr","properties":{},"children":[{"type":"element","tagName":"th","properties":{},"children":[{"type":"text","value":"output"}]},{"type":"element","tagName":"th","properties":{},"children":[{"type":"text","value":"input"}]},{"type":"element","tagName":"th","properties":{},"children":[{"type":"text","value":"output'"}]},{"type":"element","tagName":"th","properties":{},"children":[{"type":"text","value":"input'"}]}]}]},{"type":"element","tagName":"tbody","properties":{},"children":[{"type":"element","tagName":"tr","properties":{},"children":[{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"0"}]},{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"0"}]},{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"1"}]},{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"0"}]}]},{"type":"element","tagName":"tr","properties":{},"children":[{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"0"}]},{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"1"}]},{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"0"}]},{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"1"}]}]},{"type":"element","tagName":"tr","properties":{},"children":[{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"1"}]},{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"0"}]},{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"0"}]},{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"0"}]}]},{"type":"element","tagName":"tr","properties":{},"children":[{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"1"}]},{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"1"}]},{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"1"}]},{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"1"}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"We can see it as a CNOT from "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"input"}]},{"type":"text","value":" to "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"output"}]},{"type":"text","value":", but:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"output'"}]},{"type":"text","value":" is flipped when input is 0 instead of 1 so we need to negate "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"input"}]},{"type":"text","value":" before applying the CNOT; and"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"input"}]},{"type":"text","value":" must be negated again afterwards to turn back to its original state."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"It's easy to prove that $(I \\otimes X) \\cdot CX \\cdot (I \\otimes X)$ gives that same exact matrix."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Or, as the YouTube video shows, we can even see it as a CNOT with a subsequent negation on "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"output"}]},{"type":"text","value":", which makes even more sense!"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":" input    +-------------+    input'\n   |x⟩ ---| ---*------- |--- |x⟩\n          |    |        |\n   |0⟩ ---| --|X|-|X|-- |--- |1⟩ or |0⟩, depending on |x⟩\noutput    +-------------+    output'\n"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"Implementing The Oracle"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"We can finally define our oracle as a circuit that can make use of one of these four operators."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-python"]},"children":[{"type":"text","value":"def oracle(type):\n    oracle = QuantumCircuit(qubits, name='oracle')\n    oracle.append(type, range(qubits))\n    return oracle\n"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"We can verify that the operators are well defined by invoking the following test function using all possible combinations."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-python"]},"children":[{"type":"text","value":"def test_oracle(type, q1=0, q0=0):\n    circuit = QuantumCircuit(2, 1)\n    if (q0 == 1):\n        circuit.x(input)\n    if (q1 == 1):\n        circuit.x(output)\n    circuit.append(oracle(type), range(qubits))\n    circuit.measure(output, 0)\n    backend = Aer.get_backend('qasm_simulator')\n    return execute(circuit, backend, shots=1, memory=True).result().get_memory()[0]\n\nprint('Zero(0):', test_oracle(zero, q0=0), '\\tZero(1):', test_oracle(zero, q0=1))\nprint('One(0):', test_oracle(one, q0=0), '\\tOne(1):', test_oracle(one, q0=1))\nprint('Identity(0):', test_oracle(identity, q0=0), '\\tIdentity(1):', test_oracle(identity, q0=1))\nprint('Negation(0):', test_oracle(negation, q0=0), '\\tNegation(1):', test_oracle(negation, q0=1))\n"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"Zero(0): 0  Zero(1): 0\nOne(0): 1   One(1): 1\nIdentity(0): 0  Identity(1): 1\nNegation(0): 1  Negation(1): 0\n"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"The Algorithm"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The Deutsch algorithm is pretty straightforward. It just does the following:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Negates the "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"output"}]},{"type":"text","value":" qubit so it starts with $|1\\rangle$"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Applies Hadamard gates to both input and output to turn them into a superposition"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Applies the oracle, whichever it is"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Converts back the input with a Hadamard gate and measures it, since it now holds the answer to the question: \"is the function balanced?\""}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Note that we don't measure the output, since it's irrelevant and yields the wrong result anyway."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-python"]},"children":[{"type":"text","value":"def deutsch(oracle):\n    cbits = 1\n    circuit = QuantumCircuit(qubits, cbits, name='deutsch')\n    circuit.x(output)\n    circuit.barrier()\n    circuit.h(input)\n    circuit.h(output)\n    circuit.append(oracle.to_instruction(), range(qubits))\n    circuit.h(input)\n    circuit.barrier()\n    circuit.measure(input, 0)\n    return circuit\n\ncircuit = deutsch(oracle(zero))\ncircuit.draw(output='mpl')\n"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"img","properties":{"src":"/static/images/blog/deutsch.png","alt":"png"},"children":[]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-python"]},"children":[{"type":"text","value":"def test_deutsch(name, type):\n    circuit = deutsch(oracle(type))\n    backend = Aer.get_backend('qasm_simulator')\n    guess = execute(circuit, backend, shots=1, memory=True).result().get_memory()[0]\n    print(name, 'is', 'constant' if guess == '0' else 'balanced')\n\ntest_deutsch('Zero', zero)\ntest_deutsch('One', one)\ntest_deutsch('Identity', identity)\ntest_deutsch('Negation', negation)\n"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"Zero is constant\nOne is constant\nIdentity is balanced\nNegation is balanced\n"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"We came up with the same results as the classical algorithm, but with just one call to the function $f$. QED"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"# IceOnFire\n"}]}]}],"data":{"quirksMode":false}},"raw":"\nIn April 7, 2020 I was introduced to the fundamentals of Quantum Computing, and it was love at first sight. I started studying [Python](https://www.python.org/) and [Qiskit](https://qiskit.org/) and [Jupyter](https://jupyter.org/) notebooks and, after working hard on the basics for a dozen days, I was stuck with the most basic algorithm. But then I worked even harder, and I got it finally. Here is the result of my studies as an exported Jupyter notebook.\n\nNB: I haven't figured out yet how to use math formulas with [Nextein](https://nextein.now.sh/), sorry for the inconvenience.\n\n```python\nfrom qiskit import QuantumCircuit, Aer, execute\nfrom qiskit.visualization import plot_histogram, plot_bloch_multivector\nfrom qiskit.quantum_info import Operator\n```\n\nSay we have a function $f$ which takes some zeroes and ones as input and returns 0 or 1 according to some logic. We cannot inspect the function, but we can invoke it as a black box and, based on the output of our experiments, we are able to understand the underlying logic. We call such a function an \"oracle\".\n\nA one-bit oracle will only be able to produce the following results:\n\n1. $f(0) = 0, f(1) = 0$\n2. $f(0) = 1, f(1) = 1$\n3. $f(0) = 0, f(1) = 1$\n4. $f(0) = 1, f(1) = 0$\n\nIf the oracle behaves like 1. or 2. it means that whatever input I use I will always obtain the same result: the function is then considered \"constant\" (always zero or always one). If instead it behaves like 3. or 4. it means that sometimes I get 0 and sometimes 1: the function could then be considered \"variable\", although in the more generic algorithm of Deutsch-Josza we use the term \"balanced\" so we are going to use it here too (a balanced function gives 0 for half of the inputs and 1 for the other half, which by the way applies here too).\n\nAlthough possibly confusing, we can call these functions for future reference like so:\n\n1. Zero: always gives 0 (constant)\n2. One: always gives 1 (constant)\n3. Identity: gives the unchanged input (balanced)\n4. Negation: gives the inverted input (balanced)\n\n## The Classical Way\n\nIn order to guess the logic a classical computer would need to call the function twice:\n\n```python\ndef guess(f):\n    constant = 0\n    balanced = 1\n\n    if f(0) == 0:\n        if f(1) == 0:\n            return constant # zero\n        elif f(1) == 1:\n            return balanced # identity\n    elif f(0) == 1:\n        if f(1) == 0:\n            return balanced # negation\n        elif f(1) == 1:\n            return constant # one\n\ndef zero(bit):\n    return 0\n\ndef one(bit):\n    return 1\n\ndef identity(bit):\n    return bit\n\ndef negation(bit):\n    return 1 if bit == 0 else 0\n\nprint('Zero is', 'constant' if guess(zero) == 0 else 'balanced')\nprint('One is', 'constant' if guess(one) == 0 else 'balanced')\nprint('Identity is', 'constant' if guess(identity) == 0 else 'balanced')\nprint('Negation is', 'constant' if guess(negation) == 0 else 'balanced')\n```\n\n    Zero is constant\n    One is constant\n    Identity is balanced\n    Negation is balanced\n\nThe Deutsch algorithm instead guesses if the oracle is constant or balanced with just one call to `f`, using the magic of quantum superposition. We will see how, but first we have to redefine the oracle in the quantum world.\n\n## The Oracle\n\nWe could think that the oracle is a single-qubit gate, with just an input and an output:\n\n```\ninput    +--------+    output\n  |x⟩ ---| oracle |--- |f(x)⟩\n         +--------+\n```\n\nAs [this YouTube video](https://youtu.be/F_Riqjdh2oM) shows, the matrices associated to the four operations we can do on a single qubit are as follows:\n\n1. Zero (constant): $\\begin{bmatrix}1 \u0026 1\\\\0 \u0026 0\\end{bmatrix}$\n2. One (constant): $\\begin{bmatrix}0 \u0026 0\\\\1 \u0026 1\\end{bmatrix}$\n3. Identity (balanced): $\\begin{bmatrix}1 \u0026 0\\\\0 \u0026 1\\end{bmatrix}$\n4. Negation (balanced): $\\begin{bmatrix}0 \u0026 1\\\\1 \u0026 0\\end{bmatrix}$ (equal to the Pauli gate X)\n\nHowever these turn out to be useless, especially the first two since they are not even unitary.\n\nAs any gate in a quantum circuit, the oracle must be reversible (i.e. applying it twice will produce the Identity matrix). That's why we need to convert it into a two-qubits gate: the first qubit is the input value of the function, which isn't supposed to change, and the second qubit usually starts with |0⟩ and will change into the result of the oracle:\n\n```\n input    +--------+    input'\n   |x⟩ ---|        |--- |x⟩\n          | oracle |\n   |0⟩ ---|        |--- |f(x)⟩\noutput    +--------+    output'\n```\n\n_Spoiler alert:_ when plugging the oracle in the Deutsch algorithm, `output` will instead be initialized as $|1\\rangle$ and as a side effect `input'` will turn out to be $|0\\rangle$ if the oracle is constant, and $|1\\rangle$ if the oracle is balanced.\n\n```python\nqubits = 2\ninput = 0\noutput = 1\n```\n\n### Defining The Four Operators\n\nBut how do we implement the four different oracles? One way we could find the unitary matrices instead is by analyzing the expected output. Let's try with Zero:\n\n$$\nZero \\cdot |00\\rangle = |00\\rangle\\\\\nZero \\cdot |01\\rangle = |01\\rangle\n$$\n\nSo the vectors $\\begin{bmatrix}1\\\\0\\\\0\\\\0\\end{bmatrix}$ and $\\begin{bmatrix}0\\\\1\\\\0\\\\0\\end{bmatrix}$ are mapped to themselves. This suggests the following matrix:\n\n$$\nZero = \\begin{bmatrix}\n1 \u0026 0 \u0026 0 \u0026 0\\\\\n0 \u0026 1 \u0026 0 \u0026 0\\\\\n? \u0026 ? \u0026 ? \u0026 ?\\\\\n? \u0026 ? \u0026 ? \u0026 ?\n\\end{bmatrix}\n$$\n\nNote that we don't care about the third and fourth rows, so we could just complete the matrix as an Identity.\n\n```python\nzero = Operator([\n    [1, 0, 0, 0],\n    [0, 1, 0, 0],\n    [0, 0, 1, 0],\n    [0, 0, 0, 1]\n])\n```\n\nThis operator corresponds to not doing anthing at all inside the oracle!\n\n```\n input    +------+    input'\n   |x⟩ ---| ---- |--- |x⟩\n          |      |\n   |0⟩ ---| ---- |--- |0⟩\noutput    +------+    output'\n```\n\nLet's try now with One:\n\n$$\nOne \\cdot |00\\rangle = |10\\rangle\\\\\nOne \\cdot |01\\rangle = |11\\rangle\n$$\n\nSo $\\begin{bmatrix}1\\\\0\\\\0\\\\0\\end{bmatrix} \\rightarrow \\begin{bmatrix}0\\\\0\\\\1\\\\0\\end{bmatrix}$ and $\\begin{bmatrix}0\\\\1\\\\0\\\\0\\end{bmatrix} \\rightarrow \\begin{bmatrix}0\\\\0\\\\0\\\\1\\end{bmatrix}$ (first position mapped to third, second position mapped to fourth). This suggests the following matrix:\n\n$$\nOne = \\begin{bmatrix}\n0 \u0026 0 \u0026 1 \u0026 0\\\\\n0 \u0026 0 \u0026 0 \u0026 1\\\\\n1 \u0026 0 \u0026 0 \u0026 0\\\\\n0 \u0026 1 \u0026 0 \u0026 0\n\\end{bmatrix}\n$$\n\n```python\none = Operator([\n    [0, 0, 1, 0],\n    [0, 0, 0, 1],\n    [1, 0, 0, 0],\n    [0, 1, 0, 0]\n])\n```\n\nThis operator corresponds to just putting an X gate on the output!\n\n```\n input    +---------+    input'\n   |x⟩ ---| ------- |--- |x⟩\n          |         |\n   |0⟩ ---| --|X|-- |--- |1⟩\noutput    +---------+    output'\n```\n\nNow for Identity:\n\n$$\nIdentity \\cdot |00\\rangle = |00\\rangle\\\\\nIdentity \\cdot |01\\rangle = |11\\rangle\n$$\n\nSo $\\begin{bmatrix}1\\\\0\\\\0\\\\0\\end{bmatrix} \\rightarrow \\begin{bmatrix}1\\\\0\\\\0\\\\0\\end{bmatrix}$ and $\\begin{bmatrix}0\\\\1\\\\0\\\\0\\end{bmatrix} \\rightarrow \\begin{bmatrix}0\\\\0\\\\0\\\\1\\end{bmatrix}$ (first position mapped to itself, second position mapped to fourth). This suggests the following matrix:\n\n$$\nIdentity = \\begin{bmatrix}\n1 \u0026 0 \u0026 0 \u0026 0\\\\\n0 \u0026 0 \u0026 0 \u0026 1\\\\\n0 \u0026 0 \u0026 1 \u0026 0\\\\\n0 \u0026 1 \u0026 0 \u0026 0\n\\end{bmatrix}\n$$\n\n```python\nidentity = Operator([\n    [1, 0, 0, 0],\n    [0, 0, 0, 1],\n    [0, 0, 1, 0],\n    [0, 1, 0, 0]\n])\n```\n\nThis operator looks a lot like a CNOT on the output:\n\n```\n input    +---------+    input'\n   |x⟩ ---| ---*--- |--- |x⟩\n          |    |    |\n   |0⟩ ---| --|X|-- |--- |0⟩ or |1⟩, depending on |x⟩\noutput    +---------+    output'\n```\n\nAnd finally Negation:\n\n$$\nNegation \\cdot |00\\rangle = |10\\rangle\\\\\nNegation \\cdot |01\\rangle = |01\\rangle\n$$\n\nSo $\\begin{bmatrix}1\\\\0\\\\0\\\\0\\end{bmatrix} \\rightarrow \\begin{bmatrix}0\\\\0\\\\1\\\\0\\end{bmatrix}$ and $\\begin{bmatrix}0\\\\1\\\\0\\\\0\\end{bmatrix} \\rightarrow \\begin{bmatrix}0\\\\0\\\\0\\\\1\\end{bmatrix}$ (first position mapped to third, second position mapped to itself). This suggests the following matrix:\n\n$$\nNegation = \\begin{bmatrix}\n0 \u0026 0 \u0026 1 \u0026 0\\\\\n0 \u0026 1 \u0026 0 \u0026 0\\\\\n1 \u0026 0 \u0026 0 \u0026 0\\\\\n0 \u0026 0 \u0026 0 \u0026 1\n\\end{bmatrix}\n$$\n\n```python\nnegation = Operator([\n    [0, 0, 1, 0],\n    [0, 1, 0, 0],\n    [1, 0, 0, 0],\n    [0, 0, 0, 1]\n])\n```\n\nThis operator could be interpreted as a CNOT on the output, sandwiched by two negations on the input:\n\n```\n input    +---------------+    input'\n   |x⟩ ---| --|X|-*-|X|-- |--- |x⟩\n          |       |       |\n   |0⟩ ---| -----|X|----- |--- |1⟩ or |0⟩, depending on |x⟩\noutput    +---------------+    output'\n```\n\nWhy is that? Well, if we look at the truth table:\n\n| output | input | output' | input' |\n| ------ | ----- | ------- | ------ |\n| 0      | 0     | 1       | 0      |\n| 0      | 1     | 0       | 1      |\n| 1      | 0     | 0       | 0      |\n| 1      | 1     | 1       | 1      |\n\nWe can see it as a CNOT from `input` to `output`, but:\n\n- `output'` is flipped when input is 0 instead of 1 so we need to negate `input` before applying the CNOT; and\n- `input` must be negated again afterwards to turn back to its original state.\n\nIt's easy to prove that $(I \\otimes X) \\cdot CX \\cdot (I \\otimes X)$ gives that same exact matrix.\n\nOr, as the YouTube video shows, we can even see it as a CNOT with a subsequent negation on `output`, which makes even more sense!\n\n```\n input    +-------------+    input'\n   |x⟩ ---| ---*------- |--- |x⟩\n          |    |        |\n   |0⟩ ---| --|X|-|X|-- |--- |1⟩ or |0⟩, depending on |x⟩\noutput    +-------------+    output'\n```\n\n### Implementing The Oracle\n\nWe can finally define our oracle as a circuit that can make use of one of these four operators.\n\n```python\ndef oracle(type):\n    oracle = QuantumCircuit(qubits, name='oracle')\n    oracle.append(type, range(qubits))\n    return oracle\n```\n\nWe can verify that the operators are well defined by invoking the following test function using all possible combinations.\n\n```python\ndef test_oracle(type, q1=0, q0=0):\n    circuit = QuantumCircuit(2, 1)\n    if (q0 == 1):\n        circuit.x(input)\n    if (q1 == 1):\n        circuit.x(output)\n    circuit.append(oracle(type), range(qubits))\n    circuit.measure(output, 0)\n    backend = Aer.get_backend('qasm_simulator')\n    return execute(circuit, backend, shots=1, memory=True).result().get_memory()[0]\n\nprint('Zero(0):', test_oracle(zero, q0=0), '\\tZero(1):', test_oracle(zero, q0=1))\nprint('One(0):', test_oracle(one, q0=0), '\\tOne(1):', test_oracle(one, q0=1))\nprint('Identity(0):', test_oracle(identity, q0=0), '\\tIdentity(1):', test_oracle(identity, q0=1))\nprint('Negation(0):', test_oracle(negation, q0=0), '\\tNegation(1):', test_oracle(negation, q0=1))\n```\n\n    Zero(0): 0 \tZero(1): 0\n    One(0): 1 \tOne(1): 1\n    Identity(0): 0 \tIdentity(1): 1\n    Negation(0): 1 \tNegation(1): 0\n\n## The Algorithm\n\nThe Deutsch algorithm is pretty straightforward. It just does the following:\n\n1. Negates the `output` qubit so it starts with $|1\\rangle$\n2. Applies Hadamard gates to both input and output to turn them into a superposition\n3. Applies the oracle, whichever it is\n4. Converts back the input with a Hadamard gate and measures it, since it now holds the answer to the question: \"is the function balanced?\"\n\nNote that we don't measure the output, since it's irrelevant and yields the wrong result anyway.\n\n```python\ndef deutsch(oracle):\n    cbits = 1\n    circuit = QuantumCircuit(qubits, cbits, name='deutsch')\n    circuit.x(output)\n    circuit.barrier()\n    circuit.h(input)\n    circuit.h(output)\n    circuit.append(oracle.to_instruction(), range(qubits))\n    circuit.h(input)\n    circuit.barrier()\n    circuit.measure(input, 0)\n    return circuit\n\ncircuit = deutsch(oracle(zero))\ncircuit.draw(output='mpl')\n```\n\n![png](/static/images/blog/deutsch.png)\n\n```python\ndef test_deutsch(name, type):\n    circuit = deutsch(oracle(type))\n    backend = Aer.get_backend('qasm_simulator')\n    guess = execute(circuit, backend, shots=1, memory=True).result().get_memory()[0]\n    print(name, 'is', 'constant' if guess == '0' else 'balanced')\n\ntest_deutsch('Zero', zero)\ntest_deutsch('One', one)\ntest_deutsch('Identity', identity)\ntest_deutsch('Negation', negation)\n```\n\n    Zero is constant\n    One is constant\n    Identity is balanced\n    Negation is balanced\n\nWe came up with the same results as the classical algorithm, but with just one call to the function $f$. QED\n\n```\n# IceOnFire\n```\n"}],"_entriesMap":{"/":{"pathname":"/index"},"/blog/hello-world":{"pathname":"/post","query":{"_entry":"posts/blog/2016-02-21-hello-world.md"}},"/blog/il-vaso-di-piva":{"pathname":"/post","query":{"_entry":"posts/blog/2016-05-11-il-vaso-di-piva.md"}},"/blog/resistere-alla-tentazione-del-procedurale-in-redux":{"pathname":"/post","query":{"_entry":"posts/blog/2016-07-21-resistere-alla-tentazione-del-procedurale-in-redux.md"}},"/blog/pokemon-go-e-la-teoria-degli-effetti-collaterali":{"pathname":"/post","query":{"_entry":"posts/blog/2016-07-22-pokemon-go-e-la-teoria-degli-effetti-collaterali.md"}},"/blog/componenti-react-redux-come-librerie":{"pathname":"/post","query":{"_entry":"posts/blog/2016-11-16-componenti-react-redux-come-librerie.md"}},"/blog/migliorare-il-codice-con-il-currying":{"pathname":"/post","query":{"_entry":"posts/blog/2018-02-08-migliorare-il-codice-con-il-currying.md"}},"/blog/loopback-porting-di-spring-boot":{"pathname":"/post","query":{"_entry":"posts/blog/2018-10-23-loopback-porting-di-spring-boot.md"}},"/blog/deutsch-algorithm":{"pathname":"/post","query":{"_entry":"posts/blog/2020-04-25-deutsch-algorithm.md"}},"/why":{"pathname":"/why"},"/who":{"pathname":"/who"},"/who/consultant":{"pathname":"/who/consultant"},"/who/tech-lead":{"pathname":"/who/tech-lead"},"/who/mentor":{"pathname":"/who/mentor"},"/who/teacher":{"pathname":"/who/teacher"},"/what":{"pathname":"/what"},"/what/code":{"pathname":"/what/code"},"/what/speak":{"pathname":"/what/speak"},"/what/speak/conferences":{"pathname":"/what/speak/conferences"},"/what/volunteer":{"pathname":"/what/volunteer"},"/what/community":{"pathname":"/what/community"},"/how":{"pathname":"/how"},"/when":{"pathname":"/when"},"/where":{"pathname":"/where"},"/how-much":{"pathname":"/how-much"},"/icy":{"pathname":"/icy"},"/blog":{"pathname":"/blog"},"/privacy-policy":{"pathname":"/privacy-policy"}}}},"page":"/post","query":{"_entry":"posts/blog/2016-07-21-resistere-alla-tentazione-del-procedurale-in-redux.md"},"buildId":"YSv1CL~PH91TiYR88ZznB","nextExport":true};__NEXT_LOADED_PAGES__=[];__NEXT_REGISTER_PAGE=function(r,f){__NEXT_LOADED_PAGES__.push([r, f])}</script><script async="" id="__NEXT_PAGE__/post" src="/_next/static/YSv1CL~PH91TiYR88ZznB/pages/post.js"></script><script async="" id="__NEXT_PAGE__/_app" src="/_next/static/YSv1CL~PH91TiYR88ZznB/pages/_app.js"></script><script async="" id="__NEXT_PAGE__/_error" src="/_next/static/YSv1CL~PH91TiYR88ZznB/pages/_error.js"></script><script src="/_next/static/runtime/webpack-ee26f9a1faa4b683cb3b.js" async=""></script><script src="/_next/static/chunks/commons.dc7beb26727ddc746607.js" async=""></script><script src="/_next/static/chunks/styles.303c31ef574394add10b.js" async=""></script><script src="/_next/static/runtime/main-a06af596bb1ebd76eb1e.js" async=""></script></body></html>